# Документация по кибербезопасности SleepCore

**Версия документа:** 1.0
**Дата:** Январь 2026
**Соответствие:** Приказ Минздрава №181н от 11.04.2025

---

## 1. Общие сведения

### 1.1 Назначение документа

Настоящий документ описывает меры кибербезопасности, реализованные в программном обеспечении медицинского изделия SleepCore в соответствии с требованиями:

- Приказ Минздрава России №181н от 11.04.2025
- ГОСТ Р 56939-2024 "Защита информации. Разработка безопасного ПО"
- ГОСТ МЭК 62304-2022 "Изделия медицинские. Программное обеспечение"
- Федеральный закон №152-ФЗ "О персональных данных"

### 1.2 Описание изделия

| Параметр | Значение |
|----------|----------|
| Наименование | SleepCore |
| Тип | Программное обеспечение как медицинское изделие (SaMD) |
| Назначение | Цифровая терапия хронической бессонницы (КПТ-И) |
| Класс риска | IIa (по ГОСТ Р 51609-2000) |
| AI-технология | POMDP-персонализация, PLRNN-прогнозирование |

---

## 2. Идентификация и аутентификация пользователей

### 2.1 Методы верификации личности

```
┌─────────────────────────────────────────────────────────────────────┐
│  МНОГОФАКТОРНАЯ АУТЕНТИФИКАЦИЯ                                      │
├─────────────────────────────────────────────────────────────────────┤
│  Фактор 1: Знание (Knowledge)                                       │
│  - Пароль пользователя                                              │
│  - PIN-код для мобильного доступа                                   │
│                                                                     │
│  Фактор 2: Владение (Possession)                                    │
│  - Telegram ID (верификация через бот)                              │
│  - Device fingerprint                                               │
│                                                                     │
│  Фактор 3: Биометрия (опционально)                                  │
│  - Интеграция с биометрией устройства                               │
└─────────────────────────────────────────────────────────────────────┘
```

### 2.2 Реализованные механизмы

| Механизм | Описание | Реализация |
|----------|----------|------------|
| Telegram OAuth | Верификация через Telegram Bot API | `StartCommand.ts` |
| Session tokens | JWT с ограниченным сроком действия | `AuthService.ts` |
| Rate limiting | Защита от brute-force атак | `RateLimiter.ts` |
| Account lockout | Блокировка после 5 неудачных попыток | `UserRepository.ts` |

---

## 3. Ролевое разграничение доступа (RBAC)

### 3.1 Определённые роли

```typescript
enum UserRole {
  PATIENT = 'patient',           // Пациент - базовый доступ
  CLINICIAN = 'clinician',       // Клиницист - просмотр данных пациентов
  RESEARCHER = 'researcher',     // Исследователь - анонимизированные данные
  ADMIN = 'admin',               // Администратор - полный доступ
  AUDITOR = 'auditor',           // Аудитор - только чтение логов
}
```

### 3.2 Матрица доступа

| Ресурс | Patient | Clinician | Researcher | Admin | Auditor |
|--------|---------|-----------|------------|-------|---------|
| Собственные данные | CRUD | - | - | CRUD | R |
| Данные пациентов | - | R | - | CRUD | R |
| Анонимизированные данные | - | R | R | CRUD | R |
| Системные настройки | - | - | - | CRUD | R |
| Логи аудита | - | - | - | R | R |
| Резервные копии | - | - | - | CRUD | R |

### 3.3 Реализация

Файл: `src/infrastructure/database/security/RBACService.ts`

```typescript
interface Permission {
  resource: string;
  actions: ('create' | 'read' | 'update' | 'delete')[];
}

class RBACService {
  checkPermission(userId: string, resource: string, action: string): boolean;
  assignRole(userId: string, role: UserRole): void;
  revokeRole(userId: string, role: UserRole): void;
}
```

---

## 4. Управление учётными записями

### 4.1 Жизненный цикл учётной записи

```
Создание → Активация → Использование → Деактивация → Удаление
    │           │            │              │            │
    ▼           ▼            ▼              ▼            ▼
Регистрация  Верификация  Мониторинг    Блокировка   Анонимизация
через бот    Telegram ID   активности   неактивных   по запросу
```

### 4.2 Процедуры управления

| Процедура | Описание | Автоматизация |
|-----------|----------|---------------|
| Создание | Через Telegram Bot `/start` | Автоматически |
| Активация | После информированного согласия | Автоматически |
| Деактивация | По неактивности >90 дней | Автоматически |
| Удаление | По запросу пользователя (GDPR) | Ручное |
| Восстановление | Через администратора | Ручное |

### 4.3 Обработка неактивных аккаунтов

```typescript
// AutomatedCleanupService.ts
const INACTIVITY_THRESHOLD_DAYS = 90;
const WARNING_BEFORE_DEACTIVATION_DAYS = 14;

async function processInactiveAccounts(): Promise<void> {
  // 1. Отправить предупреждение за 14 дней
  // 2. Деактивировать после 90 дней неактивности
  // 3. Анонимизировать данные после 365 дней
}
```

---

## 5. Политика паролей

### 5.1 Требования к сложности

| Параметр | Требование |
|----------|------------|
| Минимальная длина | 12 символов |
| Заглавные буквы | Минимум 1 |
| Строчные буквы | Минимум 1 |
| Цифры | Минимум 1 |
| Специальные символы | Минимум 1 |
| Запрещённые паттерны | Последовательности, словарные слова |
| История паролей | Запрет последних 12 паролей |

### 5.2 Политика обновления

```
┌─────────────────────────────────────────────────────────────────────┐
│  ОБНОВЛЕНИЕ ПАРОЛЕЙ                                                 │
├─────────────────────────────────────────────────────────────────────┤
│  Обычные пользователи:     90 дней                                  │
│  Администраторы:           60 дней                                  │
│  Сервисные аккаунты:       Ротация ключей каждые 30 дней            │
│                                                                     │
│  Принудительная смена при:                                          │
│  - Первом входе                                                     │
│  - Подозрении на компрометацию                                      │
│  - Сбросе администратором                                           │
└─────────────────────────────────────────────────────────────────────┘
```

### 5.3 Хранение паролей

- Алгоритм: Argon2id (OWASP рекомендация 2024)
- Memory cost: 64 MB
- Time cost: 3 iterations
- Parallelism: 4

---

## 6. Шифрование информации

### 6.1 Шифрование при хранении (At Rest)

| Данные | Алгоритм | Длина ключа |
|--------|----------|-------------|
| PHI (Protected Health Information) | AES-256-GCM | 256 бит |
| Ключи шифрования | RSA-OAEP | 4096 бит |
| Резервные копии | AES-256-GCM | 256 бит |
| Логи аудита | AES-256-GCM | 256 бит |

Реализация: `src/infrastructure/database/security/PHIEncryptionManager.ts`

### 6.2 Шифрование при передаче (In Transit)

| Канал | Протокол | Версия |
|-------|----------|--------|
| HTTPS | TLS | 1.3 |
| WebSocket | WSS | TLS 1.3 |
| Database | TLS | 1.2+ |
| Telegram API | HTTPS | TLS 1.3 |

### 6.3 Управление ключами

```typescript
// KeyManagementService.ts
interface KeyRotationPolicy {
  dataEncryptionKey: '90 days',      // DEK
  keyEncryptionKey: '365 days',      // KEK
  signingKey: '365 days',
  tlsCertificate: '90 days',
}
```

---

## 7. Резервное копирование

### 7.1 Стратегия резервного копирования

```
┌─────────────────────────────────────────────────────────────────────┐
│  BACKUP STRATEGY (3-2-1 RULE)                                       │
├─────────────────────────────────────────────────────────────────────┤
│  3 копии данных:                                                    │
│    - Основная база данных                                           │
│    - Локальная резервная копия                                      │
│    - Удалённая резервная копия (geo-redundant)                      │
│                                                                     │
│  2 типа носителей:                                                  │
│    - SSD (оперативный доступ)                                       │
│    - Object Storage (архив)                                         │
│                                                                     │
│  1 копия offsite:                                                   │
│    - Географически удалённый дата-центр                             │
└─────────────────────────────────────────────────────────────────────┘
```

### 7.2 Расписание

| Тип | Частота | Retention | Шифрование |
|-----|---------|-----------|------------|
| Full backup | Еженедельно | 90 дней | AES-256-GCM |
| Incremental | Ежедневно | 30 дней | AES-256-GCM |
| Transaction log | Каждые 15 мин | 7 дней | AES-256-GCM |
| Point-in-time | Continuous | 7 дней | AES-256-GCM |

### 7.3 Тестирование восстановления

- Частота: Ежемесячно
- Процедура: Полное восстановление в изолированную среду
- Документирование: Отчёт о каждом тесте
- RTO (Recovery Time Objective): 4 часа
- RPO (Recovery Point Objective): 15 минут

Реализация: `src/infrastructure/database/security/BackupService.ts`

---

## 8. Защита от несанкционированного доступа

### 8.1 Сетевая безопасность

| Мера | Реализация |
|------|------------|
| Firewall | Whitelist IP для admin доступа |
| WAF | Защита от OWASP Top 10 |
| DDoS protection | Rate limiting + CDN |
| Network segmentation | Отдельные VLAN для DB/App/Web |

### 8.2 Защита приложения

```typescript
// SecurityMiddleware.ts
const securityMeasures = {
  // Input validation
  inputSanitization: true,
  parameterizedQueries: true,  // Защита от SQL injection

  // Output encoding
  htmlEncoding: true,          // Защита от XSS
  contentSecurityPolicy: true,

  // Session security
  httpOnlyCookies: true,
  secureCookies: true,
  sameSiteCookies: 'strict',

  // Request validation
  csrfProtection: true,
  requestSizeLimit: '10mb',
};
```

### 8.3 Защита данных

| Угроза | Мера защиты |
|--------|-------------|
| SQL Injection | Parameterized queries (TypeORM) |
| XSS | Content Security Policy + output encoding |
| CSRF | SameSite cookies + CSRF tokens |
| Data exposure | Field-level encryption (PHI) |
| Privilege escalation | RBAC + least privilege |

---

## 9. Мониторинг и обнаружение инцидентов

### 9.1 Система мониторинга

```
┌─────────────────────────────────────────────────────────────────────┐
│  SECURITY MONITORING STACK                                          │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐              │
│  │   Audit     │───▶│   SIEM      │───▶│  Alerting   │              │
│  │   Logs      │    │  Analysis   │    │  System     │              │
│  └─────────────┘    └─────────────┘    └─────────────┘              │
│         │                  │                  │                     │
│         ▼                  ▼                  ▼                     │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐              │
│  │  Long-term  │    │  Anomaly    │    │  Incident   │              │
│  │  Storage    │    │  Detection  │    │  Response   │              │
│  └─────────────┘    └─────────────┘    └─────────────┘              │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

### 9.2 Отслеживаемые события

| Категория | События | Уровень |
|-----------|---------|---------|
| Authentication | Login/logout, failed attempts | INFO/WARN |
| Authorization | Permission denied, role changes | WARN |
| Data access | PHI read/write, export | INFO |
| Configuration | Settings changes, key rotation | WARN |
| Security | Attacks detected, anomalies | ERROR/CRITICAL |

### 9.3 Реагирование на инциденты

```typescript
// IncidentResponseProcedure
enum IncidentSeverity {
  LOW = 'low',           // Расследование в течение 72 часов
  MEDIUM = 'medium',     // Расследование в течение 24 часов
  HIGH = 'high',         // Немедленная эскалация
  CRITICAL = 'critical', // Немедленная эскалация + уведомление регулятора
}

interface IncidentResponse {
  detection: 'automated' | 'manual';
  containment: string[];       // Шаги по локализации
  eradication: string[];       // Шаги по устранению
  recovery: string[];          // Шаги по восстановлению
  lessonsLearned: string;      // Анализ после инцидента
}
```

Реализация: `src/infrastructure/database/security/AuditService.ts`

---

## 10. Соответствие ГОСТ Р 56939-2024

### 10.1 Процессы безопасной разработки

| Этап | Мера | Статус |
|------|------|--------|
| Планирование | Threat modeling | Выполнено |
| Разработка | Secure coding guidelines | Выполнено |
| Тестирование | SAST/DAST анализ | Выполнено |
| Развёртывание | Security review | Выполнено |
| Эксплуатация | Vulnerability management | Активно |

### 10.2 Анализ кода

```
┌─────────────────────────────────────────────────────────────────────┐
│  CODE ANALYSIS PIPELINE                                             │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  Source Code ──▶ SAST ──▶ Dependency Check ──▶ Build ──▶ DAST      │
│       │           │              │              │          │        │
│       │     SonarQube      npm audit      TypeScript   OWASP ZAP   │
│       │     ESLint         Snyk           Compiler                  │
│       │                                                             │
│       └─────────────────────────────────────────────────────────────│
│                                                                     │
│  Блокирующие условия:                                               │
│  - Critical/High vulnerabilities                                    │
│  - Known CVEs without patches                                       │
│  - Hardcoded secrets                                                │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

### 10.3 Управление уязвимостями

| Severity | SLA для исправления |
|----------|---------------------|
| Critical | 24 часа |
| High | 7 дней |
| Medium | 30 дней |
| Low | 90 дней |

---

## 11. Контактная информация

### 11.1 Ответственные лица

| Роль | Ответственность |
|------|-----------------|
| Security Officer | Общая координация кибербезопасности |
| DPO (Data Protection Officer) | Защита персональных данных |
| Incident Response Team | Реагирование на инциденты |

### 11.2 Каналы связи для инцидентов

- Email: security@sleepcore.ru
- Telegram: @sleepcore_security
- Экстренная линия: +7 (XXX) XXX-XX-XX

---

## Приложения

### Приложение А: Чек-лист соответствия Приказу №181н

- [x] Методы верификации личности пользователей
- [x] Системы ролевого разграничения доступа
- [x] Процедуры управления учётными записями
- [x] Требования к сложности и обновлению паролей
- [x] Методы шифрования информации
- [x] Процедуры резервного копирования
- [x] Механизмы защиты от несанкционированного доступа
- [x] Системы мониторинга и обнаружения инцидентов

### Приложение Б: История изменений

| Версия | Дата | Изменения |
|--------|------|-----------|
| 1.0 | Январь 2026 | Первоначальная версия |

---

*Документ подготовлен в соответствии с требованиями Приказа Минздрава России №181н от 11.04.2025*
