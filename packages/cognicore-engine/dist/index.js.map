{"version":3,"sources":["../src/state/interfaces/IEmotionalState.ts","../src/state/interfaces/ICognitiveState.ts","../src/state/interfaces/IStateVector.ts","../src/belief/BeliefStateAdapter.ts","../src/temporal/interfaces/IPLRNNEngine.ts","../src/temporal/interfaces/IKalmanFormer.ts","../src/temporal/engines/KalmanFormerEngine.ts","../src/temporal/engines/PLRNNEngine.ts","../src/voice/interfaces/IVoiceAdapter.ts","../src/voice/VoiceInputAdapter.ts","../src/crisis/CrisisDetector.ts","../src/index.ts"],"names":["_","rowMax","STATE_DIMENSIONS","Av","DISTORTION_PATTERNS"],"mappings":"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","file":"index.js","sourcesContent":["/**\n *  EMOTIONAL STATE INTERFACE\n * ============================\n * World-class emotion representation using VAD (Valence-Arousal-Dominance) model\n * Combined with discrete emotion taxonomy for comprehensive state tracking\n *\n * Scientific Foundation:\n * - Russell's Circumplex Model (1980)\n * - Mehrabian & Russell VAD Model (1974)\n * - Plutchik's Wheel of Emotions (1980)\n * - Barrett's Theory of Constructed Emotion (2017)\n *\n * Integration Points:\n * - Compatible with existing EnhancedEmotionalRecognitionService (40+ emotions)\n * - Crisis detection compatible (CrisisPipeline integration)\n * - Age-adaptive recommendations support\n *\n *  \" \" |  Cognitive Core v1.0\n */\n\n/**\n * Discrete emotion taxonomy (aligned with existing system)\n * Extended from Plutchik's 8 basic emotions + compound emotions\n */\nexport type EmotionType =\n  // Primary emotions (Plutchik's wheel)\n  | 'joy'\n  | 'sadness'\n  | 'anger'\n  | 'fear'\n  | 'surprise'\n  | 'disgust'\n  | 'trust'\n  | 'anticipation'\n  // Secondary/compound emotions\n  | 'love'           // joy + trust\n  | 'guilt'          // fear + sadness\n  | 'shame'          // fear + disgust\n  | 'anxiety'        // fear + anticipation\n  | 'stress'         // anger + fear\n  | 'frustration'    // anger + sadness\n  | 'hope'           // anticipation + trust\n  | 'confusion'      // surprise + fear\n  | 'loneliness'     // sadness + trust deficit\n  | 'boredom'        // low arousal neutral\n  | 'excitement'     // high arousal joy\n  | 'calm'           // low arousal trust\n  | 'irritation'     // mild anger\n  | 'despair'        // intense sadness\n  | 'contentment'    // mild joy + calm\n  | 'pride'          // joy + trust in self\n  | 'gratitude'      // joy + trust in others\n  | 'envy'           // sadness + anger at others\n  | 'jealousy'       // fear + anger\n  | 'overwhelm'      // multiple intense emotions\n  | 'numbness'       // emotional suppression\n  | 'curiosity'      // anticipation + surprise\n  | 'awe'            // surprise + trust\n  // Crisis-related emotions\n  | 'hopelessness'   // extreme despair, crisis indicator\n  | 'relief'         // tension release after stress\n  | 'apathy'         // lack of interest/motivation\n  | 'resentment'     // bitterness, perceived unfairness\n  | 'neutral';       // baseline state\n\n/**\n * Emotion trend direction\n */\nexport type EmotionTrend =\n  | 'improving'    // Moving toward positive valence\n  | 'stable'       // Consistent state\n  | 'declining'    // Moving toward negative valence\n  | 'volatile';    // Rapid fluctuations\n\n/**\n * VAD (Valence-Arousal-Dominance) dimensional representation\n * Each dimension: -1.0 to +1.0\n */\nexport interface VADDimensions {\n  /**\n   * Valence: pleasure-displeasure dimension\n   * -1.0 = extreme displeasure (despair)\n   * +1.0 = extreme pleasure (ecstasy)\n   */\n  readonly valence: number;\n\n  /**\n   * Arousal: activation-deactivation dimension\n   * -1.0 = very calm, sleepy\n   * +1.0 = very excited, alert\n   */\n  readonly arousal: number;\n\n  /**\n   * Dominance: control-submission dimension\n   * -1.0 = feeling controlled, helpless\n   * +1.0 = feeling in control, empowered\n   */\n  readonly dominance: number;\n}\n\n/**\n * Emotion with confidence score\n */\nexport interface ScoredEmotion {\n  readonly emotion: EmotionType;\n  readonly confidence: number;  // 0.0 - 1.0\n  readonly intensity: number;   // 0.0 - 1.0\n}\n\n/**\n * Temporal emotion pattern\n */\nexport interface EmotionPattern {\n  readonly patternId: string;\n  readonly name: string;\n  readonly description: string;\n  readonly emotions: EmotionType[];\n  readonly typicalDuration: {\n    readonly min: number;  // minutes\n    readonly max: number;  // minutes\n  };\n  readonly triggers: string[];\n  readonly therapeuticImplications: string[];\n}\n\n/**\n * Emotion regulation strategy effectiveness\n */\nexport interface RegulationEffectiveness {\n  readonly strategyId: string;\n  readonly strategyName: string;\n  readonly usageCount: number;\n  readonly averageEffectiveness: number;  // 0.0 - 1.0\n  readonly bestForEmotions: EmotionType[];\n  readonly lastUsed?: Date;\n}\n\n/**\n *  Main Emotional State Interface\n * Core component of State Vector S_t\n */\nexport interface IEmotionalState {\n  /**\n   * Primary detected emotion\n   */\n  readonly primary: ScoredEmotion;\n\n  /**\n   * Secondary emotions present (up to 3)\n   */\n  readonly secondary: ScoredEmotion[];\n\n  /**\n   * Overall emotional intensity (0.0 - 1.0)\n   * Aggregated from primary + secondary\n   */\n  readonly intensity: number;\n\n  /**\n   * VAD dimensional representation\n   * Provides continuous emotion space mapping\n   */\n  readonly vad: VADDimensions;\n\n  /**\n   * Emotional trend over recent period (24h)\n   */\n  readonly trend: EmotionTrend;\n\n  /**\n   * Volatility score (0.0 - 1.0)\n   * High = frequent emotional changes\n   * Low = stable emotional state\n   */\n  readonly volatility: number;\n\n  /**\n   * Detected emotion patterns\n   * E.g., \"morning anxiety\", \"evening stress\"\n   */\n  readonly patterns: EmotionPattern[];\n\n  /**\n   * Effective regulation strategies for this user\n   */\n  readonly effectiveStrategies: RegulationEffectiveness[];\n\n  /**\n   * Timestamp of this emotional state\n   */\n  readonly timestamp: Date;\n\n  /**\n   * Confidence in the overall assessment (0.0 - 1.0)\n   */\n  readonly confidence: number;\n\n  /**\n   * Source of the emotion detection\n   */\n  readonly source: 'text_analysis' | 'self_report' | 'behavioral_inference' | 'combined';\n\n  /**\n   * Data quality score (0.0 - 1.0)\n   * Based on message length, clarity, context availability\n   */\n  readonly dataQuality: number;\n}\n\n/**\n * Emotional State Builder (for immutable construction)\n */\nexport interface IEmotionalStateBuilder {\n  setPrimary(emotion: EmotionType, confidence: number, intensity: number): this;\n  addSecondary(emotion: EmotionType, confidence: number, intensity: number): this;\n  setVAD(valence: number, arousal: number, dominance: number): this;\n  setTrend(trend: EmotionTrend): this;\n  setVolatility(volatility: number): this;\n  addPattern(pattern: EmotionPattern): this;\n  addEffectiveStrategy(strategy: RegulationEffectiveness): this;\n  setSource(source: IEmotionalState['source']): this;\n  setDataQuality(quality: number): this;\n  build(): IEmotionalState;\n}\n\n/**\n * Emotional State Factory Interface\n */\nexport interface IEmotionalStateFactory {\n  /**\n   * Create from text analysis\n   */\n  fromTextAnalysis(\n    text: string,\n    previousState?: IEmotionalState\n  ): Promise<IEmotionalState>;\n\n  /**\n   * Create from self-reported emotion\n   */\n  fromSelfReport(\n    reportedEmotion: EmotionType,\n    intensity: number,\n    previousState?: IEmotionalState\n  ): Promise<IEmotionalState>;\n\n  /**\n   * Create from legacy system format\n   * (compatibility with EnhancedEmotionalRecognitionService)\n   */\n  fromLegacyAnalysis(legacyResult: {\n    primaryEmotion: string;\n    emotionIntensity: number;\n    riskLevel: string;\n    recommendations: unknown[];\n  }): IEmotionalState;\n\n  /**\n   * Create neutral baseline state\n   */\n  createNeutral(): IEmotionalState;\n\n  /**\n   * Merge multiple emotional states (e.g., from different sources)\n   */\n  merge(states: IEmotionalState[]): IEmotionalState;\n}\n\n/**\n * VAD Mapping utilities\n * Maps discrete emotions to VAD space and vice versa\n */\nexport interface IVADMapper {\n  /**\n   * Convert discrete emotion to VAD coordinates\n   */\n  emotionToVAD(emotion: EmotionType, intensity?: number): VADDimensions;\n\n  /**\n   * Find closest discrete emotion from VAD coordinates\n   */\n  vadToEmotion(vad: VADDimensions): ScoredEmotion;\n\n  /**\n   * Calculate emotional distance in VAD space\n   */\n  calculateDistance(vad1: VADDimensions, vad2: VADDimensions): number;\n\n  /**\n   * Interpolate between two VAD states\n   */\n  interpolate(from: VADDimensions, to: VADDimensions, t: number): VADDimensions;\n}\n\n/**\n * Default VAD mappings for common emotions\n * Based on Mehrabian & Russell research + ANEW database\n */\nexport const DEFAULT_EMOTION_VAD: Record<EmotionType, VADDimensions> = {\n  // High valence, varied arousal\n  joy:          { valence: 0.8, arousal: 0.6, dominance: 0.6 },\n  excitement:   { valence: 0.8, arousal: 0.9, dominance: 0.7 },\n  contentment:  { valence: 0.7, arousal: 0.2, dominance: 0.6 },\n  calm:         { valence: 0.5, arousal: -0.3, dominance: 0.5 },\n  hope:         { valence: 0.6, arousal: 0.3, dominance: 0.5 },\n  pride:        { valence: 0.7, arousal: 0.4, dominance: 0.8 },\n  gratitude:    { valence: 0.8, arousal: 0.3, dominance: 0.5 },\n  love:         { valence: 0.9, arousal: 0.5, dominance: 0.5 },\n  trust:        { valence: 0.6, arousal: 0.1, dominance: 0.5 },\n  curiosity:    { valence: 0.5, arousal: 0.6, dominance: 0.5 },\n  awe:          { valence: 0.7, arousal: 0.5, dominance: 0.3 },\n  anticipation: { valence: 0.5, arousal: 0.5, dominance: 0.5 },\n  surprise:     { valence: 0.3, arousal: 0.8, dominance: 0.3 },\n\n  // Neutral\n  neutral:      { valence: 0.0, arousal: 0.0, dominance: 0.5 },\n  boredom:      { valence: -0.2, arousal: -0.5, dominance: 0.3 },\n  confusion:    { valence: -0.2, arousal: 0.4, dominance: 0.2 },\n\n  // Low valence, varied arousal\n  sadness:      { valence: -0.7, arousal: -0.3, dominance: 0.2 },\n  loneliness:   { valence: -0.6, arousal: -0.2, dominance: 0.2 },\n  despair:      { valence: -0.9, arousal: -0.1, dominance: 0.1 },\n  guilt:        { valence: -0.6, arousal: 0.2, dominance: 0.2 },\n  shame:        { valence: -0.7, arousal: 0.3, dominance: 0.1 },\n  numbness:     { valence: -0.3, arousal: -0.6, dominance: 0.2 },\n\n  // Negative + high arousal\n  anger:        { valence: -0.6, arousal: 0.8, dominance: 0.7 },\n  irritation:   { valence: -0.4, arousal: 0.5, dominance: 0.5 },\n  frustration:  { valence: -0.5, arousal: 0.6, dominance: 0.3 },\n  fear:         { valence: -0.7, arousal: 0.7, dominance: 0.1 },\n  anxiety:      { valence: -0.5, arousal: 0.6, dominance: 0.2 },\n  stress:       { valence: -0.5, arousal: 0.7, dominance: 0.3 },\n  overwhelm:    { valence: -0.6, arousal: 0.8, dominance: 0.1 },\n  disgust:      { valence: -0.6, arousal: 0.4, dominance: 0.5 },\n  envy:         { valence: -0.5, arousal: 0.4, dominance: 0.3 },\n  jealousy:     { valence: -0.6, arousal: 0.6, dominance: 0.3 },\n\n  // Crisis-related emotions (Phase 6.2)\n  hopelessness: { valence: -0.95, arousal: -0.2, dominance: 0.05 },  // extreme despair, crisis indicator\n  relief:       { valence: 0.6, arousal: -0.2, dominance: 0.6 },     // tension release\n  apathy:       { valence: -0.2, arousal: -0.7, dominance: 0.2 },    // low energy, low interest\n  resentment:   { valence: -0.5, arousal: 0.3, dominance: 0.3 },     // bitterness, unfairness\n};\n\n/**\n * Emotion to therapy approach mapping\n * Used for intervention selection\n */\nexport const EMOTION_THERAPY_MAPPING: Record<EmotionType, string[]> = {\n  anxiety:      ['breathing', 'grounding', 'cognitive_restructuring'],\n  stress:       ['relaxation', 'time_management', 'mindfulness'],\n  sadness:      ['behavioral_activation', 'gratitude', 'social_connection'],\n  anger:        ['anger_management', 'assertiveness', 'physical_release'],\n  fear:         ['exposure_gradual', 'safety_planning', 'cognitive_defusion'],\n  frustration:  ['problem_solving', 'acceptance', 'reframing'],\n  loneliness:   ['social_skills', 'connection_activities', 'self_compassion'],\n  overwhelm:    ['prioritization', 'breaking_down', 'support_seeking'],\n  guilt:        ['values_clarification', 'amends', 'self_forgiveness'],\n  shame:        ['self_compassion', 'normalization', 'vulnerability_work'],\n  despair:      ['crisis_hotline', 'safety_planning', 'hope_building'],\n  numbness:     ['sensory_grounding', 'emotion_identification', 'gentle_activation'],\n  boredom:      ['engagement_activities', 'value_exploration', 'novelty_seeking'],\n  confusion:    ['clarification', 'journaling', 'external_perspective'],\n  joy:          ['savoring', 'gratitude', 'sharing'],\n  excitement:   ['channeling', 'grounding', 'planning'],\n  contentment:  ['mindfulness', 'appreciation', 'maintenance'],\n  calm:         ['awareness', 'body_scan', 'present_moment'],\n  hope:         ['goal_setting', 'visualization', 'small_steps'],\n  pride:        ['celebration', 'sharing', 'building'],\n  gratitude:    ['expression', 'journaling', 'paying_forward'],\n  love:         ['expression', 'quality_time', 'appreciation'],\n  trust:        ['vulnerability', 'reciprocity', 'boundaries'],\n  curiosity:    ['exploration', 'learning', 'questioning'],\n  awe:          ['nature', 'art', 'reflection'],\n  anticipation: ['planning', 'grounding', 'patience'],\n  surprise:     ['processing', 'integration', 'adaptation'],\n  irritation:   ['pause', 'perspective', 'communication'],\n  envy:         ['gratitude', 'self_focus', 'inspiration'],\n  jealousy:     ['security_building', 'communication', 'self_worth'],\n  disgust:      ['values_clarification', 'boundaries', 'processing'],\n  neutral:      ['check_in', 'awareness', 'exploration'],\n\n  // Crisis-related emotions (Phase 6.2)\n  hopelessness: ['crisis_hotline', 'safety_planning', 'immediate_support', 'professional_referral'],\n  relief:       ['integration', 'gratitude', 'prevention_planning', 'self_care'],\n  apathy:       ['behavioral_activation', 'gentle_engagement', 'meaning_exploration', 'professional_assessment'],\n  resentment:   ['anger_processing', 'forgiveness_work', 'boundary_setting', 'perspective_taking'],\n};\n","/**\n *  COGNITIVE STATE INTERFACE\n * ============================\n * Beck's Cognitive Model + Bayesian Belief Tracking\n * Deep Cognitive Mirror -     \n *\n * Scientific Foundation:\n * - Beck's Cognitive Triad (1967, 1979)\n * - Cognitive Distortion Theory (Burns, 1980)\n * - Bayesian Cognitive Modeling (Tenenbaum, 2011)\n * - Predictive Processing Framework (Clark, 2013)\n *\n * Unique Innovation:\n * - Real-time cognitive distortion detection\n * - Bayesian belief update tracking\n * - Core belief trajectory prediction\n *\n *  \" \" |  Cognitive Core v1.0\n */\n\nimport type { EmotionType } from './IEmotionalState';\n\n/**\n * Beck's Cognitive Triad dimensions\n * Core beliefs about self, world, and future\n * Scale: -1.0 (extremely negative) to +1.0 (extremely positive)\n */\nexport interface CognitiveTriad {\n  /**\n   * Self-view: How the person perceives themselves\n   * -1.0 = \"I am worthless, incompetent, unlovable\"\n   * +1.0 = \"I am valuable, capable, lovable\"\n   */\n  readonly selfView: number;\n\n  /**\n   * World-view: How the person perceives the world/others\n   * -1.0 = \"The world is hostile, unfair, dangerous\"\n   * +1.0 = \"The world is supportive, fair, safe\"\n   */\n  readonly worldView: number;\n\n  /**\n   * Future-view: How the person perceives the future\n   * -1.0 = \"The future is hopeless, nothing will change\"\n   * +1.0 = \"The future is hopeful, things will improve\"\n   */\n  readonly futureView: number;\n\n  /**\n   * Confidence in each belief (0.0 - 1.0)\n   */\n  readonly confidence: {\n    readonly self: number;\n    readonly world: number;\n    readonly future: number;\n  };\n}\n\n/**\n * Cognitive distortion types (Burns, 1980 + extensions)\n */\nexport type CognitiveDistortionType =\n  // Classic Burns distortions\n  | 'all_or_nothing'          // Black-and-white thinking\n  | 'black_and_white'         // Alias for all_or_nothing\n  | 'overgeneralization'      // One event = always\n  | 'mental_filter'           // Focus only on negative\n  | 'disqualifying_positive'  // Positive doesn't count\n  | 'jumping_to_conclusions'  // Mind reading / fortune telling\n  | 'magnification'           // Catastrophizing (alias: catastrophizing)\n  | 'catastrophizing'         // Alias for magnification\n  | 'minimization'            // Downplaying positives\n  | 'emotional_reasoning'     // I feel it, so it's true\n  | 'should_statements'       // Rigid expectations\n  | 'labeling'                // Global negative labels\n  | 'personalization'         // Everything is my fault\n  | 'blame'                   // Everything is others' fault\n  // Extended distortions for digital context\n  | 'comparison'              // Social media comparison\n  | 'fomo'                    // Fear of missing out\n  | 'imposter_syndrome'       // Feeling like a fraud\n  | 'perfectionism'           // Nothing is good enough\n  | 'mind_reading'            // Assuming others' thoughts\n  | 'fortune_telling'         // Predicting negative outcomes\n  | 'filtering'               // Selective attention\n  | 'splitting'               // Idealizing or devaluing\n  | 'control_fallacy';        // Over/under control beliefs\n\n/**\n * Detected cognitive distortion\n */\nexport interface CognitiveDistortion {\n  readonly type: CognitiveDistortionType;\n  readonly confidence: number;        // 0.0 - 1.0\n  readonly intensity: number;         // 0.0 - 1.0\n  readonly triggeredBy: string;       // What text triggered detection\n  readonly associatedEmotion?: EmotionType;\n  readonly correctionSuggestion?: string;\n  readonly detectedAt: Date;\n}\n\n/**\n * Attentional bias patterns\n * Where attention is primarily directed\n */\nexport type AttentionalBias =\n  | 'threat'     // Focus on potential dangers\n  | 'reward'     // Focus on potential gains\n  | 'neutral'    // Balanced attention\n  | 'avoidant'   // Actively avoiding certain stimuli\n  | 'rumination' // Stuck on past events\n  | 'worry';     // Focused on future problems\n\n/**\n * Thinking style assessment\n */\nexport interface ThinkingStyle {\n  /**\n   * Analytical vs Intuitive (0 = intuitive, 1 = analytical)\n   */\n  readonly analyticalVsIntuitive: number;\n\n  /**\n   * Abstract vs Concrete (0 = concrete, 1 = abstract)\n   */\n  readonly abstractVsConcrete: number;\n\n  /**\n   * Internal vs External locus of control\n   */\n  readonly locusOfControl: 'internal' | 'external' | 'balanced';\n\n  /**\n   * Flexibility of thinking (0 = rigid, 1 = flexible)\n   */\n  readonly flexibility: number;\n}\n\n/**\n * Bayesian belief update record\n * Tracks how beliefs change over time\n */\nexport interface BeliefUpdate {\n  readonly beliefType: 'self' | 'world' | 'future';\n  readonly priorValue: number;\n  readonly posteriorValue: number;\n  readonly evidenceStrength: number;   // 0.0 - 1.0\n  readonly evidenceType: 'message' | 'behavior' | 'self_report' | 'inference';\n  readonly updatedAt: Date;\n}\n\n/**\n * Core belief pattern (intermediate beliefs)\n */\nexport interface CoreBeliefPattern {\n  readonly id: string;\n  readonly category: 'unlovability' | 'worthlessness' | 'helplessness' | 'defectiveness' | 'vulnerability' | 'incompetence';\n  readonly strength: number;          // 0.0 - 1.0\n  readonly evidence: string[];        // Supporting evidence from messages\n  readonly counterEvidence: string[]; // Contradicting evidence\n  readonly associatedRules: string[]; // \"If-then\" rules (e.g., \"If I fail, I'm worthless\")\n  readonly formationContext?: string; // Inferred origin\n}\n\n/**\n * Cognitive load indicator\n */\nexport interface CognitiveLoad {\n  /**\n   * Current mental load (0.0 - 1.0)\n   * High = reduced capacity for processing\n   */\n  readonly current: number;\n\n  /**\n   * Factors contributing to load\n   */\n  readonly factors: Array<{\n    readonly factor: 'stress' | 'fatigue' | 'multitasking' | 'emotional' | 'decision_fatigue' | 'information_overload';\n    readonly contribution: number;  // 0.0 - 1.0\n  }>;\n\n  /**\n   * Available cognitive resources (0.0 - 1.0)\n   */\n  readonly availableResources: number;\n}\n\n/**\n * Metacognition assessment\n * Thinking about thinking\n */\nexport interface Metacognition {\n  /**\n   * Awareness of own cognitive patterns\n   */\n  readonly selfAwareness: number;   // 0.0 - 1.0\n\n  /**\n   * Ability to step back and observe thoughts\n   */\n  readonly defusion: number;        // 0.0 - 1.0\n\n  /**\n   * Belief in ability to change thought patterns\n   */\n  readonly changeBeliefs: number;   // 0.0 - 1.0\n\n  /**\n   * Worry about worry (meta-worry)\n   */\n  readonly metaWorry: number;       // 0.0 - 1.0\n}\n\n/**\n *  Main Cognitive State Interface\n * Core component of State Vector S_t (c_t)\n */\nexport interface ICognitiveState {\n  /**\n   * Beck's Cognitive Triad assessment\n   */\n  readonly coreBeliefs: CognitiveTriad;\n\n  /**\n   * Active cognitive distortions\n   * Sorted by intensity (highest first)\n   */\n  readonly activeDistortions: CognitiveDistortion[];\n\n  /**\n   * Overall distortion intensity (0.0 - 1.0)\n   * Aggregate of all active distortions\n   */\n  readonly distortionIntensity: number;\n\n  /**\n   * Uncertainty in belief assessments\n   * High = beliefs may not be accurate\n   */\n  readonly beliefUncertainty: number;\n\n  /**\n   * Current attentional bias\n   */\n  readonly attentionalBias: AttentionalBias;\n\n  /**\n   * Thinking style characteristics\n   */\n  readonly thinkingStyle: ThinkingStyle;\n\n  /**\n   * Identified core belief patterns\n   */\n  readonly coreBeliefPatterns: CoreBeliefPattern[];\n\n  /**\n   * Current cognitive load\n   */\n  readonly cognitiveLoad: CognitiveLoad;\n\n  /**\n   * Metacognitive abilities\n   */\n  readonly metacognition: Metacognition;\n\n  /**\n   * Recent belief updates (for trajectory tracking)\n   */\n  readonly recentUpdates: BeliefUpdate[];\n\n  /**\n   * Timestamp of this cognitive state\n   */\n  readonly timestamp: Date;\n\n  /**\n   * Confidence in overall assessment\n   */\n  readonly confidence: number;\n\n  /**\n   * Data quality (0.0 - 1.0)\n   */\n  readonly dataQuality: number;\n}\n\n/**\n * Cognitive State Builder\n */\nexport interface ICognitiveStateBuilder {\n  setCoreBeliefs(selfView: number, worldView: number, futureView: number): this;\n  setBeliefConfidence(self: number, world: number, future: number): this;\n  addDistortion(distortion: CognitiveDistortion): this;\n  setAttentionalBias(bias: AttentionalBias): this;\n  setThinkingStyle(style: ThinkingStyle): this;\n  addCoreBeliefPattern(pattern: CoreBeliefPattern): this;\n  setCognitiveLoad(load: CognitiveLoad): this;\n  setMetacognition(meta: Metacognition): this;\n  addBeliefUpdate(update: BeliefUpdate): this;\n  build(): ICognitiveState;\n}\n\n/**\n * Cognitive State Factory\n */\nexport interface ICognitiveStateFactory {\n  /**\n   * Analyze text for cognitive patterns\n   */\n  fromTextAnalysis(\n    text: string,\n    previousState?: ICognitiveState\n  ): Promise<ICognitiveState>;\n\n  /**\n   * Create from structured assessment\n   */\n  fromAssessment(\n    triad: Partial<CognitiveTriad>,\n    distortions: CognitiveDistortionType[]\n  ): ICognitiveState;\n\n  /**\n   * Apply Bayesian update to existing state\n   */\n  applyBayesianUpdate(\n    currentState: ICognitiveState,\n    newEvidence: {\n      text: string;\n      emotionalContext?: EmotionType;\n    }\n  ): ICognitiveState;\n\n  /**\n   * Create neutral/baseline state\n   */\n  createNeutral(): ICognitiveState;\n}\n\n/**\n * Cognitive Distortion Detector Interface\n */\nexport interface ICognitiveDistortionDetector {\n  /**\n   * Detect distortions in text\n   */\n  detect(text: string): Promise<CognitiveDistortion[]>;\n\n  /**\n   * Get correction suggestion for distortion\n   */\n  suggestCorrection(\n    distortion: CognitiveDistortion,\n    context: string\n  ): string;\n\n  /**\n   * Get therapeutic intervention for distortion pattern\n   */\n  getIntervention(\n    distortionType: CognitiveDistortionType\n  ): {\n    name: string;\n    technique: string;\n    steps: string[];\n    duration: number;\n  };\n}\n\n/**\n * Distortion patterns for detection (Russian language)\n */\nexport const DISTORTION_PATTERNS: Record<CognitiveDistortionType, {\n  keywords: string[];\n  phrases: string[];\n  description: string;\n  correction: string;\n}> = {\n  all_or_nothing: {\n    keywords: ['', '', '', '', '', '  '],\n    phrases: [' ', '  ', '  '],\n    description: '-   ',\n    correction: '   .   \"\"  \"\"?'\n  },\n  overgeneralization: {\n    keywords: ['', '', '', ' '],\n    phrases: ['   ', '  ', '  '],\n    description: '  =  ',\n    correction: '     ?  ?'\n  },\n  mental_filter: {\n    keywords: [' ', '', ''],\n    phrases: ['  ', '  '],\n    description: '   ',\n    correction: '   ?  .'\n  },\n  disqualifying_positive: {\n    keywords: [' ', ' ', '', ''],\n    phrases: ['   ', ' ', '  '],\n    description: '  ',\n    correction: '  \" \"?    ?'\n  },\n  jumping_to_conclusions: {\n    keywords: ['', '', ' '],\n    phrases: ['  ', '  ', ' '],\n    description: '   ',\n    correction: '    ?   ?'\n  },\n  magnification: {\n    keywords: ['', '', '', ''],\n    phrases: [' ', ' ', ' '],\n    description: ' ',\n    correction: '     ?  5 ?'\n  },\n  minimization: {\n    keywords: [' ', '', ''],\n    phrases: [' ', '  '],\n    description: ' ',\n    correction: ',    .      ?'\n  },\n  emotional_reasoning: {\n    keywords: ['', '', ' '],\n    phrases: ['   -   ', '  -   '],\n    description: ' = ',\n    correction: ' ,      .  ?'\n  },\n  should_statements: {\n    keywords: ['', '', '', ''],\n    phrases: [' ', ' ', ' '],\n    description: '   /',\n    correction: '   \"\"?  ,  -?'\n  },\n  labeling: {\n    keywords: ['', '', '', ''],\n    phrases: [' - ', ' ', ' '],\n    description: '  ',\n    correction: ' =  ?   ,   ?'\n  },\n  personalization: {\n    keywords: ['- ', ' ', ' '],\n    phrases: ['  - ', '  ', ' '],\n    description: ' -  ',\n    correction: '     ?     ?'\n  },\n  blame: {\n    keywords: ['- ', ' ', ' '],\n    phrases: ['  - ', '  '],\n    description: ' -  ',\n    correction: '      ?'\n  },\n  comparison: {\n    keywords: [' ', ' ', '  '],\n    phrases: ['  ', '  ', '  '],\n    description: '   ',\n    correction: '   \"\" .       ?'\n  },\n  fomo: {\n    keywords: ['', '', ' '],\n    phrases: ['   ', ' - '],\n    description: '  - ',\n    correction: '        ?'\n  },\n  imposter_syndrome: {\n    keywords: [' ', '', ''],\n    phrases: ['   ', ' ', ''],\n    description: '  ',\n    correction: '     ?'\n  },\n  perfectionism: {\n    keywords: ['', '', ' '],\n    phrases: ['  ', '', '  '],\n    description: '   ',\n    correction: '  \" \"?   ?'\n  },\n  mind_reading: {\n    keywords: [' ', ' ', ' '],\n    phrases: ['  ', '  '],\n    description: '   ',\n    correction: '    ?  ?'\n  },\n  fortune_telling: {\n    keywords: [' ', ' ', ' '],\n    phrases: ['  ', '  '],\n    description: '  ',\n    correction: '   \"\" ?   ?'\n  },\n  filtering: {\n    keywords: [' ', ' '],\n    phrases: [' ', ' '],\n    description: ' ',\n    correction: '     ?    ?'\n  },\n  splitting: {\n    keywords: ['', '', '', ''],\n    phrases: [' ', ' ', ' '],\n    description: '   ',\n    correction: ' =  .     ?'\n  },\n  control_fallacy: {\n    keywords: ['', '  ', '   '],\n    phrases: ['    ', '   '],\n    description: '   ',\n    correction: '    ?  ?'\n  },\n  // Aliases (Phase 6 - type compatibility)\n  black_and_white: {\n    keywords: ['', '', '', '', '', '  '],\n    phrases: [' ', '  ', '  '],\n    description: '-    ( all_or_nothing)',\n    correction: '   .   \"\"  \"\"?'\n  },\n  catastrophizing: {\n    keywords: ['', '', '', ''],\n    phrases: [' ', ' ', ' '],\n    description: '  ( magnification)',\n    correction: '     ?  5 ?'\n  }\n};\n\n/**\n * Therapeutic interventions for each distortion\n */\nexport const DISTORTION_INTERVENTIONS: Record<CognitiveDistortionType, {\n  technique: string;\n  description: string;\n  steps: string[];\n  durationMinutes: number;\n}> = {\n  all_or_nothing: {\n    technique: ' ',\n    description: '   ',\n    steps: [\n      '   (0%  100%)',\n      '   (50%)',\n      ',    ',\n      ' ,    '\n    ],\n    durationMinutes: 5\n  },\n  overgeneralization: {\n    technique: ' ',\n    description: ' ,   -',\n    steps: [\n      '  ',\n      '   3 ',\n      '   ',\n      ',   '\n    ],\n    durationMinutes: 5\n  },\n  mental_filter: {\n    technique: ' ',\n    description: '  ',\n    steps: [\n      ' ,   ',\n      '  3  ',\n      '   1  ',\n      '   '\n    ],\n    durationMinutes: 5\n  },\n  disqualifying_positive: {\n    technique: ' ',\n    description: '  ',\n    steps: [\n      ' ,  ',\n      ',    ',\n      '     ?',\n      '     '\n    ],\n    durationMinutes: 5\n  },\n  jumping_to_conclusions: {\n    technique: ' ',\n    description: ' ',\n    steps: [\n      '  ',\n      '    ?',\n      '  ?',\n      '   ?'\n    ],\n    durationMinutes: 7\n  },\n  magnification: {\n    technique: '',\n    description: '  ',\n    steps: [\n      '    1-10 ',\n      '   ?',\n      ' ?',\n      ' ?',\n      '  ?'\n    ],\n    durationMinutes: 5\n  },\n  minimization: {\n    technique: ' ',\n    description: '  ',\n    steps: [\n      ' ,  ',\n      '  ?',\n      '   ?',\n      '    ?'\n    ],\n    durationMinutes: 5\n  },\n  emotional_reasoning: {\n    technique: '   ',\n    description: '   ',\n    steps: [\n      ': \" ...\"',\n      ': \" ...\"',\n      '   ',\n      '    ?'\n    ],\n    durationMinutes: 5\n  },\n  should_statements: {\n    technique: ' ',\n    description: ' \"\"  \" \"',\n    steps: [\n      '  \"\"',\n      '  \"  , ...\"',\n      '  \"  ...\"',\n      '  ?'\n    ],\n    durationMinutes: 3\n  },\n  labeling: {\n    technique: '  ',\n    description: '  ',\n    steps: [\n      ' ,  ',\n      '    ',\n      ' =   ,  ',\n      '   ?'\n    ],\n    durationMinutes: 5\n  },\n  personalization: {\n    technique: ' ',\n    description: '  ',\n    steps: [\n      ' ',\n      '  ,  ',\n      ' %   ?',\n      '    ?'\n    ],\n    durationMinutes: 5\n  },\n  blame: {\n    technique: ' ',\n    description: '  ,   ',\n    steps: [\n      '     ?',\n      '   ?',\n      '    ',\n      '   ?'\n    ],\n    durationMinutes: 5\n  },\n  comparison: {\n    technique: '  ',\n    description: '   ',\n    steps: [\n      '      ',\n      '   ?',\n      '   ,   ',\n      '    ?'\n    ],\n    durationMinutes: 5\n  },\n  fomo: {\n    technique: 'JOMO - Joy of Missing Out',\n    description: '  ,  ',\n    steps: [\n      '     ?',\n      '  ,  ?',\n      ', , ?',\n      '     ?'\n    ],\n    durationMinutes: 5\n  },\n  imposter_syndrome: {\n    technique: ' ',\n    description: '  ',\n    steps: [\n      ' 5  ',\n      '   ?',\n      '    ?',\n      '    '\n    ],\n    durationMinutes: 10\n  },\n  perfectionism: {\n    technique: ' ',\n    description: '  ',\n    steps: [\n      '  \"\"  ?',\n      '  \" \"?',\n      '  ?',\n      ' \" \"  '\n    ],\n    durationMinutes: 5\n  },\n  mind_reading: {\n    technique: ' ',\n    description: '  ',\n    steps: [\n      '     ?',\n      '   ?',\n      '    ?',\n      '   ?'\n    ],\n    durationMinutes: 5\n  },\n  fortune_telling: {\n    technique: ' ',\n    description: '  \"\"',\n    steps: [\n      '  ',\n      ' 3 ,   ',\n      ' %  ?',\n      '   ?'\n    ],\n    durationMinutes: 5\n  },\n  filtering: {\n    technique: ' ',\n    description: '   ',\n    steps: [\n      '   ?',\n      '  ?',\n      '  ?',\n      '   ?'\n    ],\n    durationMinutes: 5\n  },\n  splitting: {\n    technique: '',\n    description: '  ',\n    steps: [\n      '3   ',\n      '3  ',\n      ' =  ',\n      '    ?'\n    ],\n    durationMinutes: 5\n  },\n  control_fallacy: {\n    technique: ' ',\n    description: '  ',\n    steps: [\n      ' 3 : , ,  ',\n      '    ',\n      '   ',\n      ' ,    '\n    ],\n    durationMinutes: 7\n  },\n  // Aliases (Phase 6 - type compatibility)\n  black_and_white: {\n    technique: ' ',\n    description: '    ( all_or_nothing)',\n    steps: [\n      '   (0%  100%)',\n      '   (50%)',\n      ',    ',\n      ' ,    '\n    ],\n    durationMinutes: 5\n  },\n  catastrophizing: {\n    technique: '',\n    description: '   ( magnification)',\n    steps: [\n      '    1-10 ',\n      '   ?',\n      ' ?',\n      ' ?',\n      '  ?'\n    ],\n    durationMinutes: 5\n  }\n};\n","/**\n *  STATE VECTOR INTERFACE\n * =========================\n * Master Interface - POMDP State Vector S_t\n * World-First Complete Human Wellbeing State Representation\n *\n * Mathematical Foundation:\n * S_t = (e_t, c_t, n_t, r_t, b_t)\n *\n * Where:\n * - e_t: Emotional State (VAD + discrete emotions)\n * - c_t: Cognitive State (Beck's triad + distortions)\n * - n_t: Narrative State (Story arc + change stage)\n * - r_t: Risk State (Multi-layer risk assessment)\n * - b_t: Resource State (PERMA + coping resources)\n *\n * Scientific Foundation:\n * - POMDP Framework (Kaelbling et al., 1998)\n * - Integrated Theory of Wellbeing\n * - Dynamic Systems Theory of Change\n * - Computational Psychiatry (Huys et al., 2016)\n *\n *  \" \" |  Cognitive Core v1.0\n */\n\nimport type { IEmotionalState } from './IEmotionalState';\nimport type { ICognitiveState } from './ICognitiveState';\nimport type { INarrativeState } from './INarrativeState';\nimport type { IRiskState } from './IRiskState';\nimport type { IResourceState } from './IResourceState';\n\n/**\n * Observation source\n */\nexport type ObservationSource =\n  | 'message'           // Direct text message\n  | 'self_report'       // User-provided assessment\n  | 'behavioral'        // Behavioral inference\n  | 'contextual'        // Time, pattern-based\n  | 'scheduled'         // Proactive check-in\n  | 'inference';        // AI-derived\n\n/**\n * State quality metrics\n */\nexport interface StateQuality {\n  /**\n   * Overall data quality (0.0 - 1.0)\n   */\n  readonly overall: number;\n\n  /**\n   * Per-component quality\n   */\n  readonly components: {\n    readonly emotional: number;\n    readonly cognitive: number;\n    readonly narrative: number;\n    readonly risk: number;\n    readonly resources: number;\n  };\n\n  /**\n   * Time since last reliable update\n   */\n  readonly staleness: {\n    readonly emotional: number;   // seconds\n    readonly cognitive: number;\n    readonly narrative: number;\n    readonly risk: number;\n    readonly resources: number;\n  };\n\n  /**\n   * Sufficient data for reliable inference\n   */\n  readonly sufficient: boolean;\n}\n\n/**\n * POMDP Belief state (uncertainty representation)\n */\nexport interface BeliefState {\n  /**\n   * Probability distribution over possible states\n   * (simplified as confidence intervals)\n   */\n  readonly confidence: number;       // 0.0 - 1.0\n\n  /**\n   * Entropy of belief (uncertainty measure)\n   */\n  readonly entropy: number;          // 0.0 - 1.0 (0 = certain, 1 = max uncertainty)\n\n  /**\n   * Last observation that updated belief\n   */\n  readonly lastObservation: {\n    readonly source: ObservationSource;\n    readonly timestamp: Date;\n    readonly informationGain: number;  // How much this observation helped\n  };\n\n  /**\n   * Observation history (for Bayesian updates)\n   */\n  readonly observationCount: number;\n}\n\n/**\n * State transition tracking\n */\nexport interface StateTransition {\n  readonly from: Partial<IStateVector>;\n  readonly to: Partial<IStateVector>;\n  readonly timestamp: Date;\n  readonly trigger: ObservationSource;\n  readonly significance: 'minor' | 'moderate' | 'major';\n  readonly components: ('emotional' | 'cognitive' | 'narrative' | 'risk' | 'resources')[];\n}\n\n/**\n * Temporal prediction\n */\nexport interface TemporalPrediction {\n  readonly timeframe: '6h' | '12h' | '24h' | '72h' | '1w';\n  readonly predictedState: Partial<IStateVector>;\n  readonly confidence: number;\n  readonly keyFactors: string[];\n  readonly preventiveActions: string[];\n  readonly calculatedAt: Date;\n}\n\n/**\n * State summary (human-readable)\n */\nexport interface StateSummary {\n  /**\n   * One-line summary\n   */\n  readonly brief: string;\n\n  /**\n   * Key insights\n   */\n  readonly insights: string[];\n\n  /**\n   * Immediate concerns (if any)\n   */\n  readonly concerns: string[];\n\n  /**\n   * Positive aspects\n   */\n  readonly positives: string[];\n\n  /**\n   * Recommended focus areas\n   */\n  readonly focusAreas: string[];\n\n  /**\n   * Overall wellbeing score (0-100)\n   */\n  readonly wellbeingScore: number;\n}\n\n/**\n * Intervention recommendation based on state\n */\nexport interface StateBasedRecommendation {\n  readonly id: string;\n  readonly type: 'intervention' | 'resource' | 'activity' | 'connection' | 'check_in';\n  readonly title: string;\n  readonly description: string;\n  readonly priority: 'immediate' | 'high' | 'medium' | 'low';\n  readonly confidence: number;\n  readonly targetedComponents: ('emotional' | 'cognitive' | 'narrative' | 'risk' | 'resources')[];\n  readonly expectedImpact: {\n    readonly component: string;\n    readonly improvement: number;  // 0.0 - 1.0\n  }[];\n  readonly contraindications?: string[];\n}\n\n/**\n *  MAIN STATE VECTOR INTERFACE\n * Complete representation of human psychological state\n */\nexport interface IStateVector {\n  /**\n   * Unique identifier for this state snapshot\n   */\n  readonly id: string;\n\n  /**\n   * User this state belongs to\n   */\n  readonly userId: string | number;\n\n  /**\n   * Timestamp of this state\n   */\n  readonly timestamp: Date;\n\n  // ===== CORE COMPONENTS (S_t = e_t, c_t, n_t, r_t, b_t) =====\n\n  /**\n   * Emotional State (e_t)\n   * VAD dimensions + discrete emotions\n   */\n  readonly emotional: IEmotionalState;\n\n  /**\n   * Cognitive State (c_t)\n   * Beck's triad + cognitive distortions\n   */\n  readonly cognitive: ICognitiveState;\n\n  /**\n   * Narrative State (n_t)\n   * Story arc + change stage + role\n   */\n  readonly narrative: INarrativeState;\n\n  /**\n   * Risk State (r_t)\n   * Multi-layer risk assessment\n   */\n  readonly risk: IRiskState;\n\n  /**\n   * Resource State (b_t)\n   * PERMA + coping + support\n   */\n  readonly resources: IResourceState;\n\n  // ===== META INFORMATION =====\n\n  /**\n   * Belief state (POMDP uncertainty)\n   */\n  readonly belief: BeliefState;\n\n  /**\n   * Data quality metrics\n   */\n  readonly quality: StateQuality;\n\n  /**\n   * Recent transitions\n   */\n  readonly recentTransitions: StateTransition[];\n\n  /**\n   * Temporal predictions\n   */\n  readonly predictions: TemporalPrediction[];\n\n  /**\n   * Human-readable summary\n   */\n  readonly summary: StateSummary;\n\n  /**\n   * Recommended interventions based on state\n   */\n  readonly recommendations: StateBasedRecommendation[];\n\n  // ===== COMPUTED AGGREGATES =====\n\n  /**\n   * Overall wellbeing index (0-100)\n   * Weighted combination of all components\n   */\n  readonly wellbeingIndex: number;\n\n  /**\n   * Stability index (0-100)\n   * How stable is the overall state\n   */\n  readonly stabilityIndex: number;\n\n  /**\n   * Resilience index (0-100)\n   * Capacity to recover from challenges\n   */\n  readonly resilienceIndex: number;\n\n  /**\n   * Intervention urgency (0-100)\n   * How urgently intervention is needed\n   */\n  readonly interventionUrgency: number;\n}\n\n/**\n * State Vector Builder\n */\nexport interface IStateVectorBuilder {\n  setUserId(userId: string | number): this;\n  setEmotionalState(state: IEmotionalState): this;\n  setCognitiveState(state: ICognitiveState): this;\n  setNarrativeState(state: INarrativeState): this;\n  setRiskState(state: IRiskState): this;\n  setResourceState(state: IResourceState): this;\n  setBelief(belief: BeliefState): this;\n  addTransition(transition: StateTransition): this;\n  addPrediction(prediction: TemporalPrediction): this;\n  addRecommendation(recommendation: StateBasedRecommendation): this;\n  build(): IStateVector;\n}\n\n/**\n * State Vector Factory\n */\nexport interface IStateVectorFactory {\n  /**\n   * Create from single message\n   */\n  fromMessage(\n    userId: string | number,\n    message: string,\n    previousState?: IStateVector\n  ): Promise<IStateVector>;\n\n  /**\n   * Create from conversation history\n   */\n  fromConversation(\n    userId: string | number,\n    messages: Array<{ text: string; timestamp: Date; isUser: boolean }>,\n    previousState?: IStateVector\n  ): Promise<IStateVector>;\n\n  /**\n   * Create from self-report assessment\n   */\n  fromAssessment(\n    userId: string | number,\n    assessment: Record<string, number | string>,\n    previousState?: IStateVector\n  ): Promise<IStateVector>;\n\n  /**\n   * Create initial state for new user\n   */\n  createInitial(userId: string | number): IStateVector;\n\n  /**\n   * Merge partial updates into existing state\n   */\n  merge(\n    currentState: IStateVector,\n    updates: Partial<{\n      emotional: Partial<IEmotionalState>;\n      cognitive: Partial<ICognitiveState>;\n      narrative: Partial<INarrativeState>;\n      risk: Partial<IRiskState>;\n      resources: Partial<IResourceState>;\n    }>\n  ): IStateVector;\n\n  /**\n   * Apply Bayesian update based on new observation\n   */\n  applyObservation(\n    currentState: IStateVector,\n    observation: {\n      source: ObservationSource;\n      data: string | Record<string, unknown>;\n    }\n  ): Promise<IStateVector>;\n}\n\n/**\n * State Vector Service\n */\nexport interface IStateVectorService {\n  /**\n   * Get current state for user\n   */\n  getCurrentState(userId: string | number): Promise<IStateVector | null>;\n\n  /**\n   * Update state with new observation\n   */\n  updateState(\n    userId: string | number,\n    observation: {\n      source: ObservationSource;\n      data: string | Record<string, unknown>;\n    }\n  ): Promise<IStateVector>;\n\n  /**\n   * Get state history\n   */\n  getStateHistory(\n    userId: string | number,\n    timeframe: { start: Date; end: Date }\n  ): Promise<IStateVector[]>;\n\n  /**\n   * Get state trajectory\n   */\n  getTrajectory(\n    userId: string | number,\n    component: 'emotional' | 'cognitive' | 'narrative' | 'risk' | 'resources'\n  ): Promise<{\n    trend: 'improving' | 'stable' | 'declining' | 'volatile';\n    dataPoints: Array<{ timestamp: Date; value: number }>;\n    prediction: { value: number; confidence: number };\n  }>;\n\n  /**\n   * Get intervention recommendations\n   */\n  getRecommendations(\n    userId: string | number\n  ): Promise<StateBasedRecommendation[]>;\n\n  /**\n   * Generate state summary\n   */\n  generateSummary(state: IStateVector): StateSummary;\n\n  /**\n   * Predict future state\n   */\n  predictState(\n    currentState: IStateVector,\n    timeframe: '6h' | '12h' | '24h' | '72h' | '1w'\n  ): Promise<TemporalPrediction>;\n}\n\n/**\n * State Vector Repository (persistence)\n */\nexport interface IStateVectorRepository {\n  /**\n   * Save state snapshot\n   */\n  save(state: IStateVector): Promise<void>;\n\n  /**\n   * Get latest state\n   */\n  getLatest(userId: string | number): Promise<IStateVector | null>;\n\n  /**\n   * Get states in time range\n   */\n  getByTimeRange(\n    userId: string | number,\n    start: Date,\n    end: Date\n  ): Promise<IStateVector[]>;\n\n  /**\n   * Get state count for user\n   */\n  getCount(userId: string | number): Promise<number>;\n\n  /**\n   * Delete old states (retention policy)\n   */\n  deleteOlderThan(userId: string | number, date: Date): Promise<number>;\n}\n\n/**\n * Wellbeing index calculation weights\n */\nexport const WELLBEING_WEIGHTS = {\n  emotional: {\n    valence: 0.25,\n    arousal: 0.1,\n    dominance: 0.15\n  },\n  cognitive: {\n    coreBeliefs: 0.15,\n    distortionAbsence: 0.1\n  },\n  narrative: {\n    stageProgress: 0.05,\n    roleGrowth: 0.05\n  },\n  risk: {\n    safetyInverse: 0.05  // Higher safety = higher wellbeing\n  },\n  resources: {\n    perma: 0.1\n  }\n} as const;\n\n/**\n * Index calculation thresholds\n */\nexport const INDEX_THRESHOLDS = {\n  wellbeing: {\n    critical: 20,\n    low: 40,\n    moderate: 60,\n    good: 80,\n    excellent: 95\n  },\n  stability: {\n    volatile: 20,\n    unstable: 40,\n    moderate: 60,\n    stable: 80,\n    veryStable: 95\n  },\n  urgency: {\n    none: 20,\n    low: 40,\n    moderate: 60,\n    high: 80,\n    critical: 95\n  }\n} as const;\n\n/**\n * Component status for display\n */\nexport type ComponentStatus = 'excellent' | 'good' | 'moderate' | 'concerning' | 'critical';\n\n/**\n * Calculate component status from score\n */\nexport function getComponentStatus(score: number): ComponentStatus {\n  if (score >= 0.8) return 'excellent';\n  if (score >= 0.6) return 'good';\n  if (score >= 0.4) return 'moderate';\n  if (score >= 0.2) return 'concerning';\n  return 'critical';\n}\n\n/**\n * Age group for age-adaptive recommendations\n */\nexport type AgeGroup = 'child' | 'teen' | 'adult';\n","/**\n * BELIEF STATE ADAPTER\n * ====================\n * Bridge between BeliefUpdateEngine (linear Bayesian) and Phase 1 engines\n * (PLRNN nonlinear dynamics, KalmanFormer hybrid)\n *\n * Scientific Foundation:\n * - ROADMAP task 1.1.3: \"BeliefUpdateEngine.predictHybrid()\"\n * - Converts BeliefState <-> IPLRNNState <-> IKalmanFormerState\n * - Enables nonlinear prediction while maintaining Bayesian uncertainty\n *\n * (c) BF \"Drugoi Put\", 2025\n */\n\nimport type { BeliefState } from './IBeliefUpdate';\nimport type {\n  IPLRNNState,\n  IPLRNNPrediction,\n  IEarlyWarningSignal,\n  ICausalNetwork,\n  IInterventionSimulation,\n} from '../temporal/interfaces/IPLRNNEngine';\nimport type {\n  IKalmanFormerState,\n  IKalmanFormerPrediction,\n  IAttentionWeights,\n} from '../temporal/interfaces/IKalmanFormer';\nimport type { IKalmanFilterState } from '../twin/interfaces/IDigitalTwin';\n\n/**\n * Dimension mapping from BeliefState to 5D state vector\n * S_t = (valence, arousal, dominance, risk, resources)\n */\nexport const DIMENSION_MAPPING = {\n  0: 'valence',\n  1: 'arousal',\n  2: 'dominance',\n  3: 'risk',\n  4: 'resources',\n} as const;\n\nexport const DIMENSION_INDEX: Record<string, number> = {\n  valence: 0,\n  arousal: 1,\n  dominance: 2,\n  risk: 3,\n  resources: 4,\n};\n\n/**\n * Hybrid prediction result combining Bayesian uncertainty with nonlinear dynamics\n */\nexport interface IHybridPrediction {\n  /** PLRNN prediction for nonlinear dynamics */\n  plrnnPrediction?: IPLRNNPrediction;\n\n  /** KalmanFormer prediction for short-term accuracy */\n  kalmanFormerPrediction?: IKalmanFormerPrediction;\n\n  /** Blended prediction with uncertainty */\n  blendedPrediction: {\n    /** Mean prediction at each horizon step */\n    trajectory: number[][];\n    /** Bayesian credible intervals */\n    credibleIntervals: Array<{\n      lower: number[];\n      upper: number[];\n      level: number;\n    }>;\n    /** Final prediction */\n    finalPrediction: number[];\n  };\n\n  /** Early warning signals from PLRNN */\n  earlyWarningSignals: IEarlyWarningSignal[];\n\n  /** Attention explanation from KalmanFormer */\n  attention?: IAttentionWeights;\n\n  /** Prediction horizon used */\n  horizon: 'short' | 'medium' | 'long';\n\n  /** Hours ahead */\n  hoursAhead: number;\n\n  /** Confidence in prediction */\n  confidence: number;\n\n  /** Which engine contributed most */\n  primaryEngine: 'plrnn' | 'kalmanformer' | 'bayesian';\n}\n\n/**\n * Convert BeliefState to 5D observation vector\n * Maps complex belief structure to simple [V, A, D, risk, resources] vector\n */\nexport function beliefStateToObservation(belief: BeliefState): number[] {\n  // Extract posterior means from belief dimensions\n  const valence = belief.emotional.valence.posterior.mean;\n  const arousal = belief.emotional.arousal.posterior.mean;\n  const dominance = belief.emotional.dominance.posterior.mean;\n  const risk = belief.risk.overallRisk.posterior.mean;\n\n  // Aggregate resources into single value\n  const resources = (\n    belief.resources.energy.posterior.mean +\n    belief.resources.copingCapacity.posterior.mean +\n    belief.resources.socialSupport.posterior.mean\n  ) / 3;\n\n  return [valence, arousal, dominance, risk, resources];\n}\n\n/**\n * Extract uncertainty vector from BeliefState\n */\nexport function beliefStateToUncertainty(belief: BeliefState): number[] {\n  return [\n    belief.emotional.valence.posterior.variance,\n    belief.emotional.arousal.posterior.variance,\n    belief.emotional.dominance.posterior.variance,\n    belief.risk.overallRisk.posterior.variance,\n    (belief.resources.energy.posterior.variance +\n     belief.resources.copingCapacity.posterior.variance +\n     belief.resources.socialSupport.posterior.variance) / 3,\n  ];\n}\n\n/**\n * Convert BeliefState to IPLRNNState\n */\nexport function beliefStateToPLRNNState(\n  belief: BeliefState,\n  hiddenUnits: number = 16\n): IPLRNNState {\n  const observation = beliefStateToObservation(belief);\n  const uncertainty = beliefStateToUncertainty(belief);\n\n  return {\n    latentState: observation, // Use observation as initial latent state\n    hiddenActivations: new Array(hiddenUnits).fill(0).map(() => Math.random() * 0.1),\n    observedState: observation,\n    uncertainty,\n    timestamp: belief.timestamp,\n    timestep: 0,\n  };\n}\n\n/**\n * Convert IPLRNNState back to partial BeliefState update\n * Returns the dimensions that should be updated\n */\nexport function plrnnStateToBeliefUpdate(\n  plrnnState: IPLRNNState\n): Record<string, { mean: number; variance: number }> {\n  const obs = plrnnState.observedState;\n  const unc = plrnnState.uncertainty;\n\n  return {\n    valence: { mean: obs[0] ?? 0, variance: unc[0] ?? 0.1 },\n    arousal: { mean: obs[1] ?? 0, variance: unc[1] ?? 0.1 },\n    dominance: { mean: obs[2] ?? 0.5, variance: unc[2] ?? 0.1 },\n    risk: { mean: obs[3] ?? 0.1, variance: unc[3] ?? 0.1 },\n    resources: { mean: obs[4] ?? 0.5, variance: unc[4] ?? 0.1 },\n  };\n}\n\n/**\n * Convert BeliefState to IKalmanFormerState\n */\nexport function beliefStateToKalmanFormerState(\n  belief: BeliefState,\n  _contextWindow: number = 24\n): IKalmanFormerState {\n  const observation = beliefStateToObservation(belief);\n  const uncertainty = beliefStateToUncertainty(belief);\n  const dim = observation.length;\n\n  // Create covariance matrix from uncertainty vector\n  const covariance = uncertainty.map((v, i) =>\n    uncertainty.map((_, j) => (i === j ? v : 0))\n  );\n\n  // Create Kalman filter state with all required fields\n  const kalmanState: IKalmanFilterState = {\n    // Current estimates\n    stateEstimate: observation,\n    errorCovariance: covariance,\n\n    // Predicted values (same as current for initial state)\n    predictedState: observation,\n    predictedCovariance: covariance,\n\n    // Innovation (zero for initial state)\n    innovation: new Array(dim).fill(0),\n    innovationCovariance: covariance,\n\n    // Kalman gain (identity-like for initial)\n    kalmanGain: new Array(dim).fill(0).map((_, i) =>\n      new Array(dim).fill(0).map((_, j) => (i === j ? 0.5 : 0))\n    ),\n\n    // 2025 Diagnostics\n    normalized_innovation_squared: 0,\n    isOutlier: false,\n    adaptedQ: null,\n    adaptedR: null,\n\n    // Metadata\n    timestep: 0,\n    timestamp: belief.timestamp,\n  };\n\n  return {\n    kalmanState,\n    transformerHidden: [new Array(64).fill(0)], // Placeholder for transformer hidden\n    observationHistory: [{\n      observation,\n      timestamp: belief.timestamp,\n    }],\n    currentBlendRatio: 0.5,\n    confidence: belief.meta.overallConfidence,\n    timestamp: belief.timestamp,\n  };\n}\n\n/**\n * Convert IKalmanFormerState back to partial BeliefState update\n */\nexport function kalmanFormerStateToBeliefUpdate(\n  kfState: IKalmanFormerState\n): Record<string, { mean: number; variance: number }> {\n  const state = kfState.kalmanState.stateEstimate;\n  const cov = kfState.kalmanState.errorCovariance;\n\n  return {\n    valence: { mean: state[0] ?? 0, variance: cov[0]?.[0] ?? 0.1 },\n    arousal: { mean: state[1] ?? 0, variance: cov[1]?.[1] ?? 0.1 },\n    dominance: { mean: state[2] ?? 0.5, variance: cov[2]?.[2] ?? 0.1 },\n    risk: { mean: state[3] ?? 0.1, variance: cov[3]?.[3] ?? 0.1 },\n    resources: { mean: state[4] ?? 0.5, variance: cov[4]?.[4] ?? 0.1 },\n  };\n}\n\n/**\n * Merge prediction results from multiple engines\n */\nexport function mergeHybridPredictions(\n  plrnnPred?: IPLRNNPrediction,\n  kfPred?: IKalmanFormerPrediction,\n  horizon: 'short' | 'medium' | 'long' = 'medium',\n  confidence: number = 0.5\n): IHybridPrediction {\n  // Determine weights based on horizon\n  // Short-term: favor KalmanFormer (better for noisy observations)\n  // Long-term: favor PLRNN (better for nonlinear dynamics)\n  let plrnnWeight: number;\n  let kfWeight: number;\n  let hoursAhead: number;\n\n  switch (horizon) {\n    case 'short':\n      plrnnWeight = 0.3;\n      kfWeight = 0.7;\n      hoursAhead = 4;\n      break;\n    case 'long':\n      plrnnWeight = 0.8;\n      kfWeight = 0.2;\n      hoursAhead = 48;\n      break;\n    case 'medium':\n    default:\n      plrnnWeight = 0.5;\n      kfWeight = 0.5;\n      hoursAhead = 12;\n  }\n\n  // Get trajectory from available predictions\n  let trajectory: number[][] = [];\n  let finalPrediction: number[] = [];\n\n  if (plrnnPred && kfPred) {\n    // Blend both predictions\n    const plrnnFinal = plrnnPred.meanPrediction;\n    const kfFinal = kfPred.blendedPrediction;\n\n    finalPrediction = plrnnFinal.map((p, i) =>\n      p * plrnnWeight + (kfFinal[i] ?? 0) * kfWeight\n    );\n\n    trajectory = plrnnPred.trajectory.map((state, idx) => {\n      const plrnnObs = state.observedState;\n      const kfObs = kfPred.trajectory?.[idx]?.kalmanState.stateEstimate ?? plrnnObs;\n      return plrnnObs.map((p, i) => p * plrnnWeight + (kfObs[i] ?? 0) * kfWeight);\n    });\n  } else if (plrnnPred) {\n    finalPrediction = plrnnPred.meanPrediction;\n    trajectory = plrnnPred.trajectory.map(s => s.observedState);\n  } else if (kfPred) {\n    finalPrediction = kfPred.blendedPrediction;\n    trajectory = kfPred.trajectory?.map(s => s.kalmanState.stateEstimate) ?? [finalPrediction];\n  }\n\n  // Build credible intervals\n  const credibleIntervals = [{\n    lower: plrnnPred?.confidenceInterval.lower ?? finalPrediction.map(v => v - 0.2),\n    upper: plrnnPred?.confidenceInterval.upper ?? finalPrediction.map(v => v + 0.2),\n    level: 0.95,\n  }];\n\n  // Determine primary engine\n  let primaryEngine: 'plrnn' | 'kalmanformer' | 'bayesian';\n  if (horizon === 'long' || (!kfPred && plrnnPred)) {\n    primaryEngine = 'plrnn';\n  } else if (horizon === 'short' || (!plrnnPred && kfPred)) {\n    primaryEngine = 'kalmanformer';\n  } else {\n    primaryEngine = 'plrnn';\n  }\n\n  return {\n    plrnnPrediction: plrnnPred,\n    kalmanFormerPrediction: kfPred,\n    blendedPrediction: {\n      trajectory,\n      credibleIntervals,\n      finalPrediction,\n    },\n    earlyWarningSignals: plrnnPred?.earlyWarningSignals ?? [],\n    attention: kfPred?.attention,\n    horizon,\n    hoursAhead,\n    confidence,\n    primaryEngine,\n  };\n}\n\n/**\n * BeliefStateAdapter class\n * Bridges BeliefUpdateEngine with Phase 1 nonlinear engines\n */\nexport class BeliefStateAdapter {\n  private plrnnEngine?: {\n    forward: (state: IPLRNNState, input?: number[]) => IPLRNNState;\n    predict: (state: IPLRNNState, horizon: number) => IPLRNNPrediction;\n    extractCausalNetwork: () => ICausalNetwork;\n    simulateIntervention: (\n      state: IPLRNNState,\n      target: string,\n      intervention: 'increase' | 'decrease' | 'stabilize',\n      magnitude: number\n    ) => IInterventionSimulation;\n  };\n\n  private kalmanFormerEngine?: {\n    update: (state: IKalmanFormerState, observation: number[], timestamp: Date) => IKalmanFormerState;\n    predict: (state: IKalmanFormerState, horizon: number) => IKalmanFormerPrediction;\n    explain: (state: IKalmanFormerState) => IAttentionWeights;\n  };\n\n  constructor(engines?: IBeliefAdapterEngines) {\n    this.plrnnEngine = engines?.plrnn;\n    this.kalmanFormerEngine = engines?.kalmanFormer;\n  }\n\n  /**\n   * Set PLRNN engine\n   */\n  setPLRNNEngine(engine: IBeliefAdapterEngines['plrnn']): void {\n    this.plrnnEngine = engine;\n  }\n\n  /**\n   * Set KalmanFormer engine\n   */\n  setKalmanFormerEngine(engine: IBeliefAdapterEngines['kalmanFormer']): void {\n    this.kalmanFormerEngine = engine;\n  }\n\n  /**\n   * Hybrid prediction using Phase 1 engines\n   * ROADMAP task 1.1.3 deliverable\n   */\n  predictHybrid(\n    belief: BeliefState,\n    horizon: 'short' | 'medium' | 'long' = 'medium'\n  ): IHybridPrediction {\n    // Convert belief to engine states\n    const plrnnState = beliefStateToPLRNNState(belief);\n    const kfState = beliefStateToKalmanFormerState(belief);\n\n    // Get hours for horizon\n    const hoursMap = { short: 4, medium: 12, long: 48 };\n    const hours = hoursMap[horizon];\n\n    // Get predictions from available engines\n    let plrnnPred: IPLRNNPrediction | undefined;\n    let kfPred: IKalmanFormerPrediction | undefined;\n\n    if (this.plrnnEngine) {\n      plrnnPred = this.plrnnEngine.predict(plrnnState, hours);\n    }\n\n    if (this.kalmanFormerEngine) {\n      kfPred = this.kalmanFormerEngine.predict(kfState, hours);\n    }\n\n    // Merge predictions\n    return mergeHybridPredictions(\n      plrnnPred,\n      kfPred,\n      horizon,\n      belief.meta.overallConfidence\n    );\n  }\n\n  /**\n   * Extract causal network from current belief and PLRNN weights\n   */\n  extractCausalNetwork(_belief: BeliefState): ICausalNetwork | null {\n    if (!this.plrnnEngine) {\n      return null;\n    }\n\n    return this.plrnnEngine.extractCausalNetwork();\n  }\n\n  /**\n   * Simulate intervention effect on belief state\n   */\n  simulateIntervention(\n    belief: BeliefState,\n    target: string,\n    intervention: 'increase' | 'decrease' | 'stabilize',\n    magnitude: number\n  ): IInterventionSimulation | null {\n    if (!this.plrnnEngine) {\n      return null;\n    }\n\n    const plrnnState = beliefStateToPLRNNState(belief);\n    return this.plrnnEngine.simulateIntervention(\n      plrnnState,\n      target,\n      intervention,\n      magnitude\n    );\n  }\n\n  /**\n   * Get attention explanation for current state\n   */\n  explainPrediction(belief: BeliefState): IAttentionWeights | null {\n    if (!this.kalmanFormerEngine) {\n      return null;\n    }\n\n    const kfState = beliefStateToKalmanFormerState(belief);\n    return this.kalmanFormerEngine.explain(kfState);\n  }\n\n  /**\n   * Convert belief to observation vector\n   */\n  toObservation(belief: BeliefState): number[] {\n    return beliefStateToObservation(belief);\n  }\n\n  /**\n   * Convert belief to PLRNN state\n   */\n  toPLRNNState(belief: BeliefState, hiddenUnits?: number): IPLRNNState {\n    return beliefStateToPLRNNState(belief, hiddenUnits);\n  }\n\n  /**\n   * Convert belief to KalmanFormer state\n   */\n  toKalmanFormerState(belief: BeliefState, contextWindow?: number): IKalmanFormerState {\n    return beliefStateToKalmanFormerState(belief, contextWindow);\n  }\n}\n\n/**\n * Engine types for factory function\n */\nexport interface IBeliefAdapterEngines {\n  plrnn?: {\n    forward: (state: IPLRNNState, input?: number[]) => IPLRNNState;\n    predict: (state: IPLRNNState, horizon: number) => IPLRNNPrediction;\n    extractCausalNetwork: () => ICausalNetwork;\n    simulateIntervention: (\n      state: IPLRNNState,\n      target: string,\n      intervention: 'increase' | 'decrease' | 'stabilize',\n      magnitude: number\n    ) => IInterventionSimulation;\n  };\n  kalmanFormer?: {\n    update: (state: IKalmanFormerState, observation: number[], timestamp: Date) => IKalmanFormerState;\n    predict: (state: IKalmanFormerState, horizon: number) => IKalmanFormerPrediction;\n    explain: (state: IKalmanFormerState) => IAttentionWeights;\n  };\n}\n\n/**\n * Factory function\n */\nexport function createBeliefStateAdapter(engines?: IBeliefAdapterEngines): BeliefStateAdapter {\n  return new BeliefStateAdapter(engines);\n}\n\n/**\n * Export types\n */\nexport type {\n  IPLRNNState,\n  IPLRNNPrediction,\n  IEarlyWarningSignal,\n  ICausalNetwork,\n  IInterventionSimulation,\n  IKalmanFormerState,\n  IKalmanFormerPrediction,\n  IAttentionWeights,\n};\n","/**\n *  PLRNN ENGINE INTERFACES\n * ==========================\n * Piecewise Linear Recurrent Neural Network for Mental Health Dynamics\n *\n * Scientific Foundation (2025 Research):\n * - PLRNN outperforms Transformers for EMA forecasting (medRxiv 2025)\n * - dendPLRNN for interpretable nonlinear dynamics (Durstewitz Lab)\n * - State-space approach for computational psychiatry\n *\n * Key Advantages over Linear Kalman:\n * - Captures nonlinear psychological dynamics (mood swings, tipping points)\n * - Interpretable latent network structure\n * - Predicts intervention effects through causal network analysis\n *\n *   \" \", 2025\n */\n\n/**\n * PLRNN Configuration\n */\nexport interface IPLRNNConfig {\n  /** Dimensionality of latent state space (default: 5 for VAD + risk + resources) */\n  latentDim: number;\n\n  /** Number of hidden units in piecewise-linear layer */\n  hiddenUnits: number;\n\n  /** Connectivity pattern */\n  connectivity: 'sparse' | 'full' | 'dendritic';\n\n  /** Dendritic basis expansion (for dendPLRNN) */\n  dendriticBases?: number;\n\n  /** Learning rate for online adaptation */\n  learningRate: number;\n\n  /** Teacher forcing ratio (0-1) for training stability */\n  teacherForcingRatio: number;\n\n  /** Regularization strength for sparse connectivity */\n  l1Regularization: number;\n\n  /** Gradient clipping threshold */\n  gradientClip: number;\n\n  /** Number of steps for multi-step prediction */\n  predictionHorizon: number;\n\n  /** Time delta for continuous-time dynamics (hours) */\n  dt: number;\n}\n\n/**\n * Default PLRNN Configuration\n * Tuned for mental health EMA dynamics based on 2025 research\n */\nexport const DEFAULT_PLRNN_CONFIG: IPLRNNConfig = {\n  latentDim: 5, // VAD (3) + risk (1) + resources (1)\n  hiddenUnits: 16,\n  connectivity: 'dendritic',\n  dendriticBases: 8,\n  learningRate: 0.001,\n  teacherForcingRatio: 0.5,\n  l1Regularization: 0.01,\n  gradientClip: 1.0,\n  predictionHorizon: 12, // 12 hours ahead\n  dt: 1.0, // 1 hour time steps\n};\n\n/**\n * PLRNN State\n * Latent state representation with uncertainty\n */\nexport interface IPLRNNState {\n  /** Current latent state vector z_t */\n  latentState: number[];\n\n  /** Hidden layer activations h_t */\n  hiddenActivations: number[];\n\n  /** Observation-space state estimate x_t */\n  observedState: number[];\n\n  /** State uncertainty (variance) */\n  uncertainty: number[];\n\n  /** Timestamp of this state */\n  timestamp: Date;\n\n  /** Time step index */\n  timestep: number;\n}\n\n/**\n * PLRNN Prediction Result\n */\nexport interface IPLRNNPrediction {\n  /** Predicted states over horizon */\n  trajectory: IPLRNNState[];\n\n  /** Mean prediction at horizon */\n  meanPrediction: number[];\n\n  /** Prediction confidence intervals */\n  confidenceInterval: {\n    lower: number[];\n    upper: number[];\n    level: number; // e.g., 0.95 for 95% CI\n  };\n\n  /** Prediction variance at each step */\n  variance: number[][];\n\n  /** Early warning signals detected */\n  earlyWarningSignals: IEarlyWarningSignal[];\n\n  /** Prediction horizon (hours) */\n  horizon: number;\n}\n\n/**\n * Early Warning Signal (Critical Slowing Down)\n * Based on 2025 research on critical transitions in mental health\n */\nexport interface IEarlyWarningSignal {\n  /** Type of EWS */\n  type: 'autocorrelation' | 'variance' | 'connectivity' | 'flickering';\n\n  /** Which dimension is affected */\n  dimension: string;\n\n  /** Signal strength (0-1) */\n  strength: number;\n\n  /** Estimated time to transition (hours, null if unknown) */\n  estimatedTimeToTransition: number | null;\n\n  /** Confidence in the signal */\n  confidence: number;\n\n  /** Recommended action */\n  recommendation: string;\n}\n\n/**\n * Causal Network extracted from PLRNN\n * Interpretable psychological dynamics\n */\nexport interface ICausalNetwork {\n  /** Nodes represent psychological dimensions */\n  nodes: ICausalNode[];\n\n  /** Edges represent causal influence strengths */\n  edges: ICausalEdge[];\n\n  /** Network-level metrics */\n  metrics: {\n    /** Average connectivity */\n    density: number;\n    /** Central node (most influential) */\n    centralNode: string;\n    /** Identified feedback loops */\n    feedbackLoops: string[][];\n  };\n}\n\nexport interface ICausalNode {\n  id: string;\n  label: string;\n  /** Self-connection strength (autoregression) */\n  selfWeight: number;\n  /** Centrality in the network */\n  centrality: number;\n  /** Current value */\n  value: number;\n}\n\nexport interface ICausalEdge {\n  source: string;\n  target: string;\n  /** Influence weight (positive = excitatory, negative = inhibitory) */\n  weight: number;\n  /** Time lag of influence (hours) */\n  lag: number;\n  /** Statistical significance */\n  significance: number;\n}\n\n/**\n * Intervention Simulation Result\n * Simulates effect of changing a node in the causal network\n */\nexport interface IInterventionSimulation {\n  /** Intervention target */\n  target: {\n    dimension: string;\n    intervention: 'increase' | 'decrease' | 'stabilize';\n    magnitude: number;\n  };\n\n  /** Predicted system response */\n  response: {\n    /** Affected dimensions with effect sizes */\n    effects: Map<string, number>;\n    /** Time to peak effect (hours) */\n    timeToPeak: number;\n    /** Duration of effect (hours) */\n    duration: number;\n    /** Side effects (unintended changes) */\n    sideEffects: Array<{ dimension: string; effect: number }>;\n  };\n\n  /** Confidence in simulation */\n  confidence: number;\n}\n\n/**\n * PLRNN Model Weights\n * Serializable for persistence\n */\nexport interface IPLRNNWeights {\n  /** Diagonal autoregression matrix A */\n  A: number[];\n\n  /** Off-diagonal connection matrix W */\n  W: number[][];\n\n  /** Input matrix C (for dendritic bases) */\n  C?: number[][];\n\n  /** Observation matrix B */\n  B: number[][];\n\n  /** Bias vectors */\n  biasLatent: number[];\n  biasObserved: number[];\n\n  /** Dendritic weights (if dendPLRNN) */\n  dendriticWeights?: number[][];\n\n  /** Metadata */\n  meta: {\n    trainedAt: Date;\n    trainingSamples: number;\n    validationLoss: number;\n    config: IPLRNNConfig;\n  };\n}\n\n/**\n * PLRNN Training Sample\n */\nexport interface IPLRNNTrainingSample {\n  /** Observation sequence */\n  observations: number[][];\n\n  /** Timestamps */\n  timestamps: Date[];\n\n  /** User ID for personalization */\n  userId: string | number;\n\n  /** Optional ground truth latent states (for supervised training) */\n  groundTruth?: number[][];\n}\n\n/**\n * PLRNN Training Result\n */\nexport interface IPLRNNTrainingResult {\n  /** Final training loss */\n  loss: number;\n\n  /** Validation loss */\n  validationLoss: number;\n\n  /** Number of epochs */\n  epochs: number;\n\n  /** Training time (ms) */\n  trainingTime: number;\n\n  /** Convergence achieved */\n  converged: boolean;\n\n  /** Updated weights */\n  weights: IPLRNNWeights;\n}\n\n/**\n * PLRNN Engine Interface\n * Core nonlinear dynamics engine for cognitive state modeling\n */\nexport interface IPLRNNEngine {\n  /**\n   * Initialize engine with configuration\n   */\n  initialize(config: Partial<IPLRNNConfig>): void;\n\n  /**\n   * Load pretrained weights\n   */\n  loadWeights(weights: IPLRNNWeights): void;\n\n  /**\n   * Get current weights\n   */\n  getWeights(): IPLRNNWeights;\n\n  /**\n   * Forward pass: compute next state\n   * z_{t+1} = A * z_t + W * (z_t) + C * s_t + bias\n   * where  is ReLU (piecewise-linear)\n   */\n  forward(state: IPLRNNState, input?: number[]): IPLRNNState;\n\n  /**\n   * Multi-step prediction\n   */\n  predict(\n    currentState: IPLRNNState,\n    horizon: number,\n    input?: number[][]\n  ): IPLRNNPrediction;\n\n  /**\n   * Hybrid prediction: PLRNN for long-term, Kalman for short-term\n   */\n  hybridPredict(\n    currentState: IPLRNNState,\n    horizon: 'short' | 'medium' | 'long'\n  ): IPLRNNPrediction;\n\n  /**\n   * Extract interpretable causal network from learned weights\n   * Key advantage of PLRNN over black-box models\n   */\n  extractCausalNetwork(): ICausalNetwork;\n\n  /**\n   * Simulate intervention on psychological dimension\n   */\n  simulateIntervention(\n    currentState: IPLRNNState,\n    target: string,\n    intervention: 'increase' | 'decrease' | 'stabilize',\n    magnitude: number\n  ): IInterventionSimulation;\n\n  /**\n   * Detect early warning signals of critical transition\n   * Based on critical slowing down theory\n   */\n  detectEarlyWarnings(\n    stateHistory: IPLRNNState[],\n    windowSize: number\n  ): IEarlyWarningSignal[];\n\n  /**\n   * Online training update\n   */\n  trainOnline(sample: IPLRNNTrainingSample): IPLRNNTrainingResult;\n\n  /**\n   * Batch training\n   */\n  trainBatch(samples: IPLRNNTrainingSample[]): IPLRNNTrainingResult;\n\n  /**\n   * Calculate reconstruction loss\n   */\n  calculateLoss(\n    predicted: number[][],\n    actual: number[][]\n  ): number;\n\n  /**\n   * Get model complexity metrics\n   */\n  getComplexityMetrics(): {\n    effectiveDimensionality: number;\n    sparsity: number;\n    lyapunovExponent: number;\n  };\n}\n\n/**\n * Factory function type for PLRNN Engine\n */\nexport type PLRNNEngineFactory = (config?: Partial<IPLRNNConfig>) => IPLRNNEngine;\n","/**\n *  KALMANFORMER INTERFACES\n * ==========================\n * Hybrid Kalman Filter + Transformer Architecture\n *\n * Scientific Foundation (2025 Research):\n * - Nature Comm. 2024: \"KalmanFormer: using Transformer to model Kalman Gain\"\n * - arXiv 2024: \"Transformer-Based Approaches for Sensor Fusion in Autonomous Systems\"\n * - ICLR 2025: \"State Space Models with Attention\"\n *\n * Architecture:\n * - Kalman Filter: Short-term dynamics, optimal for noisy observations\n * - Transformer: Long-range dependencies, context modeling\n * - Learned Kalman Gain: Adaptive trust between prediction and observation\n *\n * Key Innovation:\n * Use Transformer attention to learn optimal Kalman Gain matrix\n * based on observation context and historical patterns.\n *\n *   \" \", 2025\n */\n\nimport type { IKalmanFilterState } from '../../twin/interfaces/IDigitalTwin';\nimport type { IPLRNNState } from './IPLRNNEngine';\n\n/**\n * KalmanFormer Configuration\n */\nexport interface IKalmanFormerConfig {\n  /** State dimensionality */\n  stateDim: number;\n\n  /** Observation dimensionality */\n  obsDim: number;\n\n  /** Transformer embedding dimension */\n  embedDim: number;\n\n  /** Number of attention heads */\n  numHeads: number;\n\n  /** Number of transformer layers */\n  numLayers: number;\n\n  /** Context window size (historical observations) */\n  contextWindow: number;\n\n  /** Dropout rate for regularization */\n  dropout: number;\n\n  /** Kalman-Transformer blend ratio (0 = pure Kalman, 1 = pure Transformer) */\n  blendRatio: number;\n\n  /** Enable learned Kalman Gain */\n  learnedGain: boolean;\n\n  /** Temperature for attention softmax */\n  temperature: number;\n\n  /** Time embedding type */\n  timeEmbedding: 'sinusoidal' | 'learned' | 'none';\n\n  /** Maximum time gap for interpolation (hours) */\n  maxTimeGap: number;\n}\n\n/**\n * Default KalmanFormer Configuration\n */\nexport const DEFAULT_KALMANFORMER_CONFIG: IKalmanFormerConfig = {\n  stateDim: 5, // VAD + risk + resources\n  obsDim: 5,\n  embedDim: 64,\n  numHeads: 4,\n  numLayers: 2,\n  contextWindow: 24, // 24 historical observations\n  dropout: 0.1,\n  blendRatio: 0.5, // Equal weight initially\n  learnedGain: true,\n  temperature: 1.0,\n  timeEmbedding: 'sinusoidal',\n  maxTimeGap: 48, // 48 hours max interpolation\n};\n\n/**\n * Attention Weights for interpretability\n */\nexport interface IAttentionWeights {\n  /** Self-attention weights [numHeads, seqLen, seqLen] */\n  selfAttention: number[][][];\n\n  /** Cross-attention weights (if applicable) */\n  crossAttention?: number[][][];\n\n  /** Which historical observations influenced prediction most */\n  topInfluentialObservations: Array<{\n    index: number;\n    timestamp: Date;\n    weight: number;\n    dimension: string;\n  }>;\n\n  /** Temporal attention pattern (recency vs. relevance) */\n  temporalPattern: 'recency_bias' | 'pattern_matching' | 'uniform';\n}\n\n/**\n * KalmanFormer State\n * Extended Kalman state with Transformer context\n */\nexport interface IKalmanFormerState {\n  /** Standard Kalman state */\n  kalmanState: IKalmanFilterState;\n\n  /** Transformer hidden state (context encoding) */\n  transformerHidden: number[][];\n\n  /** Historical observation buffer */\n  observationHistory: Array<{\n    observation: number[];\n    timestamp: Date;\n    embedding?: number[];\n  }>;\n\n  /** Learned Kalman Gain (if enabled) */\n  learnedGain?: number[][];\n\n  /** Current blend ratio (may adapt) */\n  currentBlendRatio: number;\n\n  /** Confidence in prediction */\n  confidence: number;\n\n  /** Timestamp */\n  timestamp: Date;\n}\n\n/**\n * KalmanFormer Prediction Result\n */\nexport interface IKalmanFormerPrediction {\n  /** State estimate */\n  stateEstimate: number[];\n\n  /** Covariance estimate */\n  covariance: number[][];\n\n  /** Kalman contribution to prediction */\n  kalmanContribution: number[];\n\n  /** Transformer contribution to prediction */\n  transformerContribution: number[];\n\n  /** Final blended prediction */\n  blendedPrediction: number[];\n\n  /** Confidence intervals */\n  confidenceInterval: {\n    lower: number[];\n    upper: number[];\n    level: number;\n  };\n\n  /** Attention weights for interpretability */\n  attention: IAttentionWeights;\n\n  /** Prediction horizon */\n  horizon: number;\n\n  /** Trajectory for multi-step prediction */\n  trajectory?: IKalmanFormerState[];\n}\n\n/**\n * KalmanFormer Model Weights\n */\nexport interface IKalmanFormerWeights {\n  /** Kalman matrices */\n  kalman: {\n    stateTransition: number[][];\n    observationMatrix: number[][];\n    processNoise: number[][];\n    measurementNoise: number[][];\n  };\n\n  /** Transformer weights */\n  transformer: {\n    queryWeights: number[][][]; // [layer, head, dim]\n    keyWeights: number[][][];\n    valueWeights: number[][][];\n    outputProjection: number[][];\n    feedforward: {\n      linear1: number[][];\n      linear2: number[][];\n      bias1: number[];\n      bias2: number[];\n    }[];\n    layerNorm: {\n      gamma: number[];\n      beta: number[];\n    }[];\n  };\n\n  /** Gain predictor (if learned gain enabled) */\n  gainPredictor?: {\n    weights: number[][];\n    bias: number[];\n  };\n\n  /** Embedding layers */\n  embedding: {\n    observation: number[][];\n    time?: number[][];\n    position?: number[][];\n  };\n\n  /** Output projection */\n  outputProjection: number[][];\n\n  /** Blend ratio predictor */\n  blendPredictor?: {\n    weights: number[];\n    bias: number;\n  };\n\n  /** Metadata */\n  meta: {\n    trainedAt: Date;\n    trainingSamples: number;\n    validationLoss: number;\n    config: IKalmanFormerConfig;\n  };\n}\n\n/**\n * Training sample for KalmanFormer\n */\nexport interface IKalmanFormerTrainingSample {\n  /** Observation sequence */\n  observations: number[][];\n\n  /** Timestamps */\n  timestamps: Date[];\n\n  /** Optional ground truth states */\n  groundTruth?: number[][];\n\n  /** User ID for personalization */\n  userId: string | number;\n\n  /** Context information (external factors) */\n  context?: Array<{\n    timeOfDay: number; // 0-23\n    dayOfWeek: number; // 0-6\n    eventType?: string;\n  }>;\n}\n\n/**\n * KalmanFormer Engine Interface\n */\nexport interface IKalmanFormerEngine {\n  /**\n   * Initialize engine\n   */\n  initialize(config?: Partial<IKalmanFormerConfig>): void;\n\n  /**\n   * Load pretrained weights\n   */\n  loadWeights(weights: IKalmanFormerWeights): void;\n\n  /**\n   * Get current weights\n   */\n  getWeights(): IKalmanFormerWeights;\n\n  /**\n   * Process single observation\n   * Updates state using hybrid Kalman-Transformer approach\n   */\n  update(\n    state: IKalmanFormerState,\n    observation: number[],\n    timestamp: Date\n  ): IKalmanFormerState;\n\n  /**\n   * Predict next state(s)\n   */\n  predict(\n    state: IKalmanFormerState,\n    horizon: number\n  ): IKalmanFormerPrediction;\n\n  /**\n   * Get attention-based explanation\n   * Which historical observations influenced the prediction\n   */\n  explain(state: IKalmanFormerState): IAttentionWeights;\n\n  /**\n   * Adapt blend ratio based on prediction errors\n   */\n  adaptBlendRatio(\n    predictions: number[][],\n    actuals: number[][]\n  ): number;\n\n  /**\n   * Train on batch of samples\n   */\n  train(samples: IKalmanFormerTrainingSample[]): {\n    loss: number;\n    kalmanLoss: number;\n    transformerLoss: number;\n    epochs: number;\n  };\n\n  /**\n   * Convert to/from PLRNN state for interoperability\n   */\n  toPLRNNState(state: IKalmanFormerState): IPLRNNState;\n  fromPLRNNState(plrnnState: IPLRNNState): IKalmanFormerState;\n\n  /**\n   * Get model complexity metrics\n   */\n  getComplexityMetrics(): {\n    totalParameters: number;\n    kalmanParameters: number;\n    transformerParameters: number;\n    effectiveContextLength: number;\n  };\n}\n\n/**\n * Factory type\n */\nexport type KalmanFormerEngineFactory = (\n  config?: Partial<IKalmanFormerConfig>\n) => IKalmanFormerEngine;\n","/**\n *  KALMANFORMER ENGINE IMPLEMENTATION\n * =====================================\n * Hybrid Kalman Filter + Transformer Architecture\n *\n * Scientific Foundation (2025 Research):\n * - \"KalmanFormer: using Transformer to model Kalman Gain in Visual Inertial Odometry\"\n * - State Space Models + Attention mechanisms\n *\n * Key Innovation:\n * - Kalman Filter: Optimal for short-term, handles noise\n * - Transformer: Captures long-range dependencies in mood patterns\n * - Learned Kalman Gain: Context-aware trust adaptation\n *\n * Architecture:\n * 1. Encode observation history with positional + time embeddings\n * 2. Apply multi-head self-attention to capture patterns\n * 3. Predict optimal Kalman Gain based on context\n * 4. Blend Kalman prediction with Transformer prediction\n *\n *   \" \", 2025\n */\n\nimport {\n  type IKalmanFormerEngine,\n  type IKalmanFormerConfig,\n  type IKalmanFormerState,\n  type IKalmanFormerPrediction,\n  type IKalmanFormerWeights,\n  type IKalmanFormerTrainingSample,\n  type IAttentionWeights,\n  DEFAULT_KALMANFORMER_CONFIG,\n} from '../interfaces/IKalmanFormer';\nimport type { IPLRNNState } from '../interfaces/IPLRNNEngine';\nimport type { IKalmanFilterState } from '../../twin/interfaces/IDigitalTwin';\n\n/**\n * State dimension labels\n */\nconst STATE_DIMENSIONS = ['valence', 'arousal', 'dominance', 'risk', 'resources'];\n\n/**\n * KalmanFormer Engine Implementation\n */\nexport class KalmanFormerEngine implements IKalmanFormerEngine {\n  private config: IKalmanFormerConfig;\n  private weights: IKalmanFormerWeights | null = null;\n  private initialized = false;\n\n  constructor(config?: Partial<IKalmanFormerConfig>) {\n    this.config = { ...DEFAULT_KALMANFORMER_CONFIG, ...config };\n  }\n\n  // ============================================================================\n  // INITIALIZATION\n  // ============================================================================\n\n  initialize(config?: Partial<IKalmanFormerConfig>): void {\n    if (config) {\n      this.config = { ...this.config, ...config };\n    }\n\n    const { stateDim, obsDim, embedDim, numHeads, numLayers } = this.config;\n\n    // Initialize Kalman matrices\n    const kalman = {\n      stateTransition: this.initIdentityMatrix(stateDim),\n      observationMatrix: this.initIdentityMatrix(obsDim),\n      processNoise: this.initDiagonalMatrix(stateDim, 0.01),\n      measurementNoise: this.initDiagonalMatrix(obsDim, 0.1),\n    };\n\n    // Initialize Transformer weights\n    const headDim = embedDim / numHeads;\n    const transformer = {\n      queryWeights: this.initTransformerWeights(numLayers, numHeads, embedDim, headDim),\n      keyWeights: this.initTransformerWeights(numLayers, numHeads, embedDim, headDim),\n      valueWeights: this.initTransformerWeights(numLayers, numHeads, embedDim, headDim),\n      outputProjection: this.initRandomMatrix(embedDim, embedDim),\n      feedforward: Array(numLayers).fill(null).map(() => ({\n        linear1: this.initRandomMatrix(embedDim, embedDim * 4),\n        linear2: this.initRandomMatrix(embedDim * 4, embedDim),\n        bias1: new Array(embedDim * 4).fill(0),\n        bias2: new Array(embedDim).fill(0),\n      })),\n      layerNorm: Array(numLayers * 2).fill(null).map(() => ({\n        gamma: new Array(embedDim).fill(1),\n        beta: new Array(embedDim).fill(0),\n      })),\n    };\n\n    // Embedding layers\n    const embedding = {\n      observation: this.initRandomMatrix(obsDim, embedDim),\n      time: this.config.timeEmbedding === 'learned'\n        ? this.initRandomMatrix(1, embedDim)\n        : undefined,\n      position: this.initPositionalEmbedding(this.config.contextWindow, embedDim),\n    };\n\n    // Gain predictor (learned Kalman Gain)\n    const gainPredictor = this.config.learnedGain ? {\n      weights: this.initRandomMatrix(embedDim, stateDim * obsDim),\n      bias: new Array(stateDim * obsDim).fill(0),\n    } : undefined;\n\n    // Blend ratio predictor\n    const blendPredictor = {\n      weights: new Array(embedDim).fill(0).map(() => Math.random() * 0.1),\n      bias: 0.5, // Start with equal blend\n    };\n\n    this.weights = {\n      kalman,\n      transformer,\n      embedding,\n      gainPredictor,\n      blendPredictor,\n      outputProjection: this.initRandomMatrix(embedDim, stateDim),\n      meta: {\n        trainedAt: new Date(),\n        trainingSamples: 0,\n        validationLoss: Infinity,\n        config: this.config,\n      },\n    };\n\n    this.initialized = true;\n  }\n\n  loadWeights(weights: IKalmanFormerWeights): void {\n    this.weights = weights;\n    this.config = weights.meta.config;\n    this.initialized = true;\n  }\n\n  getWeights(): IKalmanFormerWeights {\n    if (!this.weights) {\n      throw new Error('KalmanFormer not initialized');\n    }\n    return this.weights;\n  }\n\n  // ============================================================================\n  // UPDATE (FILTER STEP)\n  // ============================================================================\n\n  update(\n    state: IKalmanFormerState,\n    observation: number[],\n    timestamp: Date\n  ): IKalmanFormerState {\n    if (!this.weights || !this.initialized) {\n      throw new Error('KalmanFormer not initialized');\n    }\n\n    // 1. Update observation history\n    const newHistory = [...state.observationHistory];\n    newHistory.push({\n      observation: [...observation],\n      timestamp,\n      embedding: this.embedObservation(observation, timestamp, newHistory.length),\n    });\n\n    // Keep only contextWindow observations\n    while (newHistory.length > this.config.contextWindow) {\n      newHistory.shift();\n    }\n\n    // 2. Standard Kalman predict step\n    const kalmanPredicted = this.kalmanPredict(state.kalmanState);\n\n    // 3. Compute Transformer context encoding\n    const contextEncoding = this.encodeContext(newHistory);\n\n    // 4. Learn optimal Kalman Gain from context (if enabled)\n    let kalmanGain: number[][];\n    if (this.config.learnedGain && this.weights.gainPredictor) {\n      kalmanGain = this.predictKalmanGain(contextEncoding);\n    } else {\n      kalmanGain = this.computeStandardKalmanGain(kalmanPredicted);\n    }\n\n    // 5. Kalman update step with learned gain\n    const kalmanUpdated = this.kalmanUpdate(\n      kalmanPredicted,\n      observation,\n      kalmanGain\n    );\n\n    // 6. Transformer prediction\n    const transformerPrediction = this.transformerPredict(newHistory, contextEncoding);\n\n    // 7. Compute adaptive blend ratio\n    const blendRatio = this.computeBlendRatio(\n      contextEncoding,\n      state.kalmanState,\n      observation\n    );\n\n    // 8. Blend predictions\n    const blendedState = this.blendPredictions(\n      kalmanUpdated.stateEstimate,\n      transformerPrediction,\n      blendRatio\n    );\n\n    // Update Kalman state with blended estimate\n    const newKalmanState: IKalmanFilterState = {\n      ...kalmanUpdated,\n      stateEstimate: blendedState,\n    };\n\n    return {\n      kalmanState: newKalmanState,\n      transformerHidden: contextEncoding,\n      observationHistory: newHistory,\n      learnedGain: kalmanGain,\n      currentBlendRatio: blendRatio,\n      confidence: this.computeConfidence(kalmanUpdated, transformerPrediction, observation),\n      timestamp,\n    };\n  }\n\n  // ============================================================================\n  // PREDICTION\n  // ============================================================================\n\n  predict(\n    state: IKalmanFormerState,\n    horizon: number\n  ): IKalmanFormerPrediction {\n    if (!this.weights || !this.initialized) {\n      throw new Error('KalmanFormer not initialized');\n    }\n\n    // Multi-step prediction\n    const trajectory: IKalmanFormerState[] = [state];\n    let currentState = state;\n\n    for (let t = 0; t < horizon; t++) {\n      // Kalman prediction\n      const kalmanPred = this.kalmanPredict(currentState.kalmanState);\n\n      // Transformer prediction using context\n      const contextEncoding = this.encodeContext(currentState.observationHistory);\n      const transformerPred = this.transformerPredict(\n        currentState.observationHistory,\n        contextEncoding\n      );\n\n      // Blend\n      const blendedPred = this.blendPredictions(\n        kalmanPred.stateEstimate,\n        transformerPred,\n        currentState.currentBlendRatio\n      );\n\n      // Create pseudo-observation for next step\n      const nextTimestamp = new Date(\n        currentState.timestamp.getTime() + this.config.maxTimeGap / horizon * 3600000\n      );\n\n      const nextState: IKalmanFormerState = {\n        kalmanState: {\n          ...kalmanPred,\n          stateEstimate: blendedPred,\n        },\n        transformerHidden: contextEncoding,\n        observationHistory: [\n          ...currentState.observationHistory.slice(-this.config.contextWindow + 1),\n          {\n            observation: blendedPred,\n            timestamp: nextTimestamp,\n            embedding: this.embedObservation(blendedPred, nextTimestamp, currentState.observationHistory.length),\n          },\n        ],\n        learnedGain: currentState.learnedGain,\n        currentBlendRatio: currentState.currentBlendRatio,\n        confidence: currentState.confidence * 0.95, // Decay confidence\n        timestamp: nextTimestamp,\n      };\n\n      trajectory.push(nextState);\n      currentState = nextState;\n    }\n\n    const finalState = trajectory[trajectory.length - 1]!;\n\n    // Compute confidence intervals\n    const uncertainty = finalState.kalmanState.errorCovariance.map(row =>\n      Math.sqrt(row.reduce((max, v) => Math.max(max, v), 0))\n    );\n\n    const lower = finalState.kalmanState.stateEstimate.map((v, i) =>\n      v - 1.96 * (uncertainty[i] ?? 0.1)\n    );\n    const upper = finalState.kalmanState.stateEstimate.map((v, i) =>\n      v + 1.96 * (uncertainty[i] ?? 0.1)\n    );\n\n    // Get attention weights\n    const attention = this.explain(finalState);\n\n    return {\n      stateEstimate: finalState.kalmanState.stateEstimate,\n      covariance: finalState.kalmanState.errorCovariance,\n      kalmanContribution: this.kalmanPredict(state.kalmanState).stateEstimate,\n      transformerContribution: this.transformerPredict(\n        state.observationHistory,\n        this.encodeContext(state.observationHistory)\n      ),\n      blendedPrediction: finalState.kalmanState.stateEstimate,\n      confidenceInterval: { lower, upper, level: 0.95 },\n      attention,\n      horizon,\n      trajectory,\n    };\n  }\n\n  // ============================================================================\n  // ATTENTION & EXPLAINABILITY\n  // ============================================================================\n\n  explain(state: IKalmanFormerState): IAttentionWeights {\n    if (!this.weights) {\n      throw new Error('KalmanFormer not initialized');\n    }\n\n    const history = state.observationHistory;\n    if (history.length === 0) {\n      return {\n        selfAttention: [],\n        topInfluentialObservations: [],\n        temporalPattern: 'uniform',\n      };\n    }\n\n    // Compute attention weights\n    const embeddings = history.map(h => h.embedding || this.embedObservation(\n      h.observation, h.timestamp, 0\n    ));\n\n    const attentionWeights = this.computeAttentionWeights(embeddings);\n\n    // Find top influential observations\n    const influenceScores = history.map((h, i) => {\n      const totalWeight = attentionWeights[attentionWeights.length - 1]?.[i] || 0;\n      return { index: i, timestamp: h.timestamp, weight: totalWeight };\n    });\n\n    const topInfluential = influenceScores\n      .sort((a, b) => b.weight - a.weight)\n      .slice(0, 5)\n      .map(obs => ({\n        ...obs,\n        dimension: this.findMostInfluentialDimension(history[obs.index]?.observation ?? []),\n      }));\n\n    // Determine temporal pattern\n    const recentWeights = influenceScores.slice(-5);\n    const earlyWeights = influenceScores.slice(0, 5);\n    const recentAvg = recentWeights.reduce((s, w) => s + w.weight, 0) / recentWeights.length;\n    const earlyAvg = earlyWeights.reduce((s, w) => s + w.weight, 0) / (earlyWeights.length || 1);\n\n    let temporalPattern: 'recency_bias' | 'pattern_matching' | 'uniform';\n    if (recentAvg > earlyAvg * 1.5) {\n      temporalPattern = 'recency_bias';\n    } else if (this.detectPatternMatching(attentionWeights)) {\n      temporalPattern = 'pattern_matching';\n    } else {\n      temporalPattern = 'uniform';\n    }\n\n    return {\n      selfAttention: [attentionWeights],\n      topInfluentialObservations: topInfluential,\n      temporalPattern,\n    };\n  }\n\n  // ============================================================================\n  // BLEND RATIO ADAPTATION\n  // ============================================================================\n\n  adaptBlendRatio(predictions: number[][], actuals: number[][]): number {\n    if (predictions.length !== actuals.length || predictions.length === 0) {\n      return this.config.blendRatio;\n    }\n\n    // Compare Kalman vs Transformer contributions\n    // This is a simplified version - in practice would track both contributions\n\n    let totalError = 0;\n    for (let t = 0; t < predictions.length; t++) {\n      const predRow = predictions[t];\n      const actualRow = actuals[t];\n      if (!predRow || !actualRow) continue;\n      for (let i = 0; i < predRow.length; i++) {\n        totalError += Math.pow((predRow[i] ?? 0) - (actualRow[i] ?? 0), 2);\n      }\n    }\n\n    const firstPred = predictions[0];\n    const avgError = Math.sqrt(totalError / (predictions.length * (firstPred?.length ?? 1)));\n\n    // Adjust blend ratio based on error\n    // Higher error -> more Transformer (captures complex patterns)\n    // Lower error -> more Kalman (simpler is better)\n    const errorThreshold = 0.5;\n    let newRatio = this.config.blendRatio;\n\n    if (avgError > errorThreshold) {\n      newRatio = Math.min(0.8, newRatio + 0.1);\n    } else if (avgError < errorThreshold * 0.5) {\n      newRatio = Math.max(0.2, newRatio - 0.1);\n    }\n\n    return newRatio;\n  }\n\n  // ============================================================================\n  // TRAINING\n  // ============================================================================\n\n  train(samples: IKalmanFormerTrainingSample[]): {\n    loss: number;\n    kalmanLoss: number;\n    transformerLoss: number;\n    epochs: number;\n  } {\n    if (!this.weights) {\n      this.initialize();\n    }\n\n    let totalLoss = 0;\n    let kalmanLoss = 0;\n    let transformerLoss = 0;\n\n    for (const sample of samples) {\n      // Initialize state\n      const firstObs = sample.observations[0];\n      const firstTimestamp = sample.timestamps[0];\n      if (!firstObs || !firstTimestamp) continue;\n      let state = this.initializeState(firstObs, firstTimestamp);\n\n      for (let t = 1; t < sample.observations.length; t++) {\n        // Update with observation\n        const obs = sample.observations[t];\n        const ts = sample.timestamps[t];\n        if (!obs || !ts) continue;\n        state = this.update(state, obs, ts);\n\n        // Compute losses if ground truth available\n        const target = sample.groundTruth?.[t];\n        if (target) {\n          const kalmanPred = state.kalmanState.stateEstimate;\n          const transformerPred = this.transformerPredict(\n            state.observationHistory,\n            state.transformerHidden\n          );\n\n          // MSE losses\n          const kLoss = kalmanPred.reduce((sum, p, i) => sum + Math.pow(p - (target[i] ?? 0), 2), 0);\n          const tLoss = transformerPred.reduce((sum, p, i) => sum + Math.pow(p - (target[i] ?? 0), 2), 0);\n\n          kalmanLoss += kLoss;\n          transformerLoss += tLoss;\n          totalLoss += kLoss * (1 - state.currentBlendRatio) + tLoss * state.currentBlendRatio;\n        }\n      }\n    }\n\n    const count = samples.reduce((sum, s) => sum + s.observations.length - 1, 0);\n\n    // Update metadata\n    this.weights!.meta.trainingSamples += samples.length;\n    this.weights!.meta.trainedAt = new Date();\n    this.weights!.meta.validationLoss = totalLoss / count;\n\n    return {\n      loss: totalLoss / count,\n      kalmanLoss: kalmanLoss / count,\n      transformerLoss: transformerLoss / count,\n      epochs: 1,\n    };\n  }\n\n  // ============================================================================\n  // INTEROPERABILITY\n  // ============================================================================\n\n  toPLRNNState(state: IKalmanFormerState): IPLRNNState {\n    return {\n      latentState: [...state.kalmanState.stateEstimate],\n      hiddenActivations: state.transformerHidden[0] || [],\n      observedState: [...state.kalmanState.stateEstimate],\n      uncertainty: state.kalmanState.errorCovariance.map(row =>\n        Math.sqrt(row.reduce((max, v) => Math.max(max, Math.abs(v)), 0))\n      ),\n      timestamp: state.timestamp,\n      timestep: state.observationHistory.length,\n    };\n  }\n\n  fromPLRNNState(plrnnState: IPLRNNState): IKalmanFormerState {\n    const n = plrnnState.latentState.length;\n\n    return {\n      kalmanState: {\n        stateEstimate: [...plrnnState.observedState],\n        errorCovariance: this.initDiagonalMatrix(n, 0.1),\n        predictedState: [...plrnnState.latentState],\n        predictedCovariance: this.initDiagonalMatrix(n, 0.1),\n        innovation: new Array(n).fill(0),\n        innovationCovariance: this.initDiagonalMatrix(n, 0.1),\n        kalmanGain: this.initIdentityMatrix(n),\n        normalized_innovation_squared: 0,\n        isOutlier: false,\n        adaptedQ: null,\n        adaptedR: null,\n        timestep: plrnnState.timestep,\n        timestamp: plrnnState.timestamp,\n      },\n      transformerHidden: [plrnnState.hiddenActivations],\n      observationHistory: [{\n        observation: [...plrnnState.observedState],\n        timestamp: plrnnState.timestamp,\n      }],\n      currentBlendRatio: this.config.blendRatio,\n      confidence: 1 - plrnnState.uncertainty.reduce((a, b) => a + b, 0) / n,\n      timestamp: plrnnState.timestamp,\n    };\n  }\n\n  getComplexityMetrics(): {\n    totalParameters: number;\n    kalmanParameters: number;\n    transformerParameters: number;\n    effectiveContextLength: number;\n  } {\n    if (!this.weights) {\n      return { totalParameters: 0, kalmanParameters: 0, transformerParameters: 0, effectiveContextLength: 0 };\n    }\n\n    const { stateDim, embedDim, numHeads, numLayers } = this.config;\n\n    // Kalman parameters\n    const kalmanParameters = 4 * stateDim * stateDim; // 4 matrices\n\n    // Transformer parameters\n    const headDim = embedDim / numHeads;\n    const qkvPerLayer = 3 * numHeads * embedDim * headDim;\n    const ffnPerLayer = 2 * embedDim * embedDim * 4;\n    const transformerParameters = numLayers * (qkvPerLayer + ffnPerLayer + 4 * embedDim);\n\n    // Embedding parameters\n    const embeddingParams = this.config.obsDim * embedDim + this.config.contextWindow * embedDim;\n\n    return {\n      totalParameters: kalmanParameters + transformerParameters + embeddingParams,\n      kalmanParameters,\n      transformerParameters,\n      effectiveContextLength: this.config.contextWindow,\n    };\n  }\n\n  // ============================================================================\n  // PRIVATE HELPERS\n  // ============================================================================\n\n  private initializeState(observation: number[], timestamp: Date): IKalmanFormerState {\n    const n = observation.length;\n\n    return {\n      kalmanState: {\n        stateEstimate: [...observation],\n        errorCovariance: this.initDiagonalMatrix(n, 0.1),\n        predictedState: [...observation],\n        predictedCovariance: this.initDiagonalMatrix(n, 0.1),\n        innovation: new Array(n).fill(0),\n        innovationCovariance: this.initDiagonalMatrix(n, 0.1),\n        kalmanGain: this.initIdentityMatrix(n),\n        normalized_innovation_squared: 0,\n        isOutlier: false,\n        adaptedQ: null,\n        adaptedR: null,\n        timestep: 0,\n        timestamp,\n      },\n      transformerHidden: [],\n      observationHistory: [{\n        observation: [...observation],\n        timestamp,\n        embedding: this.embedObservation(observation, timestamp, 0),\n      }],\n      currentBlendRatio: this.config.blendRatio,\n      confidence: 0.5,\n      timestamp,\n    };\n  }\n\n  private kalmanPredict(state: IKalmanFilterState): IKalmanFilterState {\n    const A = this.weights!.kalman.stateTransition;\n    const Q = this.weights!.kalman.processNoise;\n\n    // x_pred = A * x\n    const predictedState = this.matVec(A, state.stateEstimate);\n\n    // P_pred = A * P * A' + Q\n    const AP = this.matMul(A, state.errorCovariance);\n    const APAt = this.matMul(AP, this.transpose(A));\n    const predictedCovariance = this.matAdd(APAt, Q);\n\n    return {\n      ...state,\n      predictedState,\n      predictedCovariance,\n      timestep: state.timestep + 1,\n      timestamp: new Date(),\n    };\n  }\n\n  private kalmanUpdate(\n    predicted: IKalmanFilterState,\n    observation: number[],\n    gain: number[][]\n  ): IKalmanFilterState {\n    const H = this.weights!.kalman.observationMatrix;\n\n    // Innovation: y = z - H * x_pred\n    const Hx = this.matVec(H, predicted.predictedState);\n    const innovation = observation.map((z, i) => z - (Hx[i] ?? 0));\n\n    // State update: x = x_pred + K * y\n    const Ky = this.matVec(gain, innovation);\n    const stateEstimate = predicted.predictedState.map((x, i) => x + (Ky[i] ?? 0));\n\n    // Covariance update: P = (I - K * H) * P_pred\n    const n = stateEstimate.length;\n    const KH = this.matMul(gain, H);\n    const IminusKH = this.matSub(this.initIdentityMatrix(n), KH);\n    const errorCovariance = this.matMul(IminusKH, predicted.predictedCovariance);\n\n    return {\n      ...predicted,\n      stateEstimate,\n      errorCovariance,\n      innovation,\n      kalmanGain: gain,\n    };\n  }\n\n  private computeStandardKalmanGain(predicted: IKalmanFilterState): number[][] {\n    const H = this.weights!.kalman.observationMatrix;\n    const R = this.weights!.kalman.measurementNoise;\n    const P = predicted.predictedCovariance;\n\n    // S = H * P * H' + R\n    const HP = this.matMul(H, P);\n    const HPHt = this.matMul(HP, this.transpose(H));\n    const S = this.matAdd(HPHt, R);\n\n    // K = P * H' * S^-1\n    const PHt = this.matMul(P, this.transpose(H));\n    const Sinv = this.matInverse(S);\n    return this.matMul(PHt, Sinv);\n  }\n\n  private predictKalmanGain(contextEncoding: number[][]): number[][] {\n    if (!this.weights!.gainPredictor) {\n      throw new Error('Gain predictor not initialized');\n    }\n\n    // Use last context embedding to predict gain\n    const lastContext = contextEncoding[contextEncoding.length - 1] ||\n      new Array(this.config.embedDim).fill(0);\n\n    // Linear transformation\n    const gainVector = this.matVec(\n      [this.weights!.gainPredictor.weights.map(row => row[0] || 0)],\n      lastContext\n    );\n\n    // Reshape to matrix\n    const n = this.config.stateDim;\n    const m = this.config.obsDim;\n    const gain: number[][] = [];\n\n    for (let i = 0; i < n; i++) {\n      const row: number[] = [];\n      for (let j = 0; j < m; j++) {\n        const idx = i * m + j;\n        // Sigmoid to bound gain values\n        row[j] = this.sigmoid(gainVector[idx] ?? 0);\n      }\n      gain[i] = row;\n    }\n\n    return gain;\n  }\n\n  private embedObservation(\n    observation: number[],\n    timestamp: Date,\n    position: number\n  ): number[] {\n    const { embedDim } = this.config;\n    const obsMatrix = this.weights!.embedding.observation;\n\n    // Observation embedding\n    let embedding = this.matVec(obsMatrix, observation);\n\n    // Add positional embedding\n    if (this.weights!.embedding.position) {\n      const posEmb = this.weights!.embedding.position[position % this.weights!.embedding.position.length];\n      if (posEmb) {\n        embedding = embedding.map((v, i) => v + (posEmb[i] ?? 0));\n      }\n    }\n\n    // Add time embedding (sinusoidal)\n    if (this.config.timeEmbedding === 'sinusoidal') {\n      const hour = timestamp.getHours() + timestamp.getMinutes() / 60;\n      const dayOfWeek = timestamp.getDay();\n\n      for (let i = 0; i < embedDim; i += 2) {\n        const freq = Math.pow(10000, i / embedDim);\n        const currVal = embedding[i] ?? 0;\n        embedding[i] = currVal + Math.sin(hour * 2 * Math.PI / 24 / freq);\n        if (i + 1 < embedDim) {\n          const nextVal = embedding[i + 1] ?? 0;\n          embedding[i + 1] = nextVal + Math.cos(dayOfWeek * 2 * Math.PI / 7 / freq);\n        }\n      }\n    }\n\n    return embedding;\n  }\n\n  private encodeContext(\n    history: Array<{ observation: number[]; timestamp: Date; embedding?: number[] }>\n  ): number[][] {\n    if (history.length === 0) {\n      return [new Array(this.config.embedDim).fill(0)];\n    }\n\n    // Get embeddings\n    const embeddings = history.map((h, i) =>\n      h.embedding || this.embedObservation(h.observation, h.timestamp, i)\n    );\n\n    // Apply self-attention layers\n    let output = embeddings;\n    const { numLayers } = this.config;\n\n    for (let layer = 0; layer < numLayers; layer++) {\n      // Multi-head self-attention\n      const attended = this.multiHeadAttention(output, layer);\n\n      // Add & Norm (residual connection)\n      output = this.addAndNorm(output, attended, layer * 2);\n\n      // Feed-forward\n      const ffOutput = this.feedForward(output, layer);\n\n      // Add & Norm\n      output = this.addAndNorm(output, ffOutput, layer * 2 + 1);\n    }\n\n    return output;\n  }\n\n  private multiHeadAttention(input: number[][], _layer: number): number[][] {\n    const { numHeads, embedDim } = this.config;\n    const headDim = embedDim / numHeads;\n    const seqLen = input.length;\n\n    // For each head, compute Q, K, V\n    const headOutputs: number[][] = [];\n\n    for (let h = 0; h < numHeads; h++) {\n      // Simplified: use portion of embedding as Q, K, V\n      const Q = input.map(emb => emb.slice(h * headDim, (h + 1) * headDim));\n      const K = input.map(emb => emb.slice(h * headDim, (h + 1) * headDim));\n      const V = input.map(emb => emb.slice(h * headDim, (h + 1) * headDim));\n\n      // Attention scores: softmax(Q * K' / sqrt(d))\n      const scores: number[][] = [];\n      for (let i = 0; i < seqLen; i++) {\n        const scoreRow: number[] = [];\n        const Qi = Q[i];\n        if (!Qi) continue;\n        for (let j = 0; j < seqLen; j++) {\n          let score = 0;\n          const Kj = K[j];\n          if (!Kj) continue;\n          for (let k = 0; k < headDim; k++) {\n            score += (Qi[k] ?? 0) * (Kj[k] ?? 0);\n          }\n          scoreRow[j] = score / Math.sqrt(headDim) / this.config.temperature;\n        }\n        // Softmax\n        const maxScore = Math.max(...scoreRow);\n        const expScores = scoreRow.map(s => Math.exp(s - maxScore));\n        const sumExp = expScores.reduce((a, b) => a + b, 0);\n        scores[i] = expScores.map(e => e / sumExp);\n      }\n\n      // Attended values\n      for (let i = 0; i < seqLen; i++) {\n        const attended = new Array(headDim).fill(0);\n        const scoresI = scores[i];\n        if (!scoresI) continue;\n        for (let j = 0; j < seqLen; j++) {\n          const Vj = V[j];\n          if (!Vj) continue;\n          for (let k = 0; k < headDim; k++) {\n            attended[k] += (scoresI[j] ?? 0) * (Vj[k] ?? 0);\n          }\n        }\n        if (!headOutputs[i]) headOutputs[i] = [];\n        headOutputs[i]!.push(...attended);\n      }\n    }\n\n    return headOutputs;\n  }\n\n  private feedForward(input: number[][], layer: number): number[][] {\n    const ff = this.weights!.transformer.feedforward[layer];\n    if (!ff) {\n      return input;\n    }\n\n    return input.map(emb => {\n      // Linear 1 + ReLU\n      let hidden = this.matVec([ff.linear1.map(row => row[0] ?? 0)], emb);\n      hidden = hidden.map((v, i) => Math.max(0, v + (ff.bias1[i] ?? 0)));\n\n      // Linear 2\n      let output = this.matVec([ff.linear2.map(row => row[0] ?? 0)], hidden);\n      output = output.map((v, i) => v + (ff.bias2[i] ?? 0));\n\n      return output;\n    });\n  }\n\n  private addAndNorm(\n    residual: number[][],\n    output: number[][],\n    layerNormIdx: number\n  ): number[][] {\n    const ln = this.weights!.transformer.layerNorm[layerNormIdx];\n    if (!ln) {\n      return residual;\n    }\n\n    return residual.map((res, i) => {\n      // Add\n      const added = res.map((r, j) => r + (output[i]?.[j] ?? 0));\n\n      // LayerNorm\n      const mean = added.reduce((a, b) => a + b, 0) / added.length;\n      const variance = added.reduce((sum, v) => sum + Math.pow(v - mean, 2), 0) / added.length;\n      const std = Math.sqrt(variance + 1e-5);\n\n      return added.map((v, j) =>\n        ((v - mean) / std) * (ln.gamma[j] ?? 1) + (ln.beta[j] ?? 0)\n      );\n    });\n  }\n\n  private transformerPredict(\n    _history: Array<{ observation: number[]; timestamp: Date; embedding?: number[] }>,\n    contextEncoding: number[][]\n  ): number[] {\n    if (contextEncoding.length === 0) {\n      return new Array(this.config.stateDim).fill(0);\n    }\n\n    // Use last encoding for prediction\n    const lastEncoding = contextEncoding[contextEncoding.length - 1];\n    if (!lastEncoding) {\n      return new Array(this.config.stateDim).fill(0);\n    }\n\n    // Project to state space\n    return this.matVec(this.weights!.outputProjection, lastEncoding);\n  }\n\n  private computeBlendRatio(\n    contextEncoding: number[][],\n    _kalmanState: IKalmanFilterState,\n    _observation: number[]\n  ): number {\n    if (!this.weights!.blendPredictor) {\n      return this.config.blendRatio;\n    }\n\n    // Use context to predict optimal blend\n    const lastContext = contextEncoding[contextEncoding.length - 1] ??\n      new Array(this.config.embedDim).fill(0);\n\n    const logit = lastContext.reduce((sum, v, i) =>\n      sum + v * (this.weights!.blendPredictor!.weights[i] ?? 0), 0\n    ) + this.weights!.blendPredictor!.bias;\n\n    // Sigmoid to get ratio between 0 and 1\n    return this.sigmoid(logit);\n  }\n\n  private blendPredictions(\n    kalman: number[],\n    transformer: number[],\n    ratio: number\n  ): number[] {\n    return kalman.map((k, i) =>\n      (1 - ratio) * k + ratio * (transformer[i] || k)\n    );\n  }\n\n  private computeConfidence(\n    kalmanState: IKalmanFilterState,\n    transformerPred: number[],\n    _observation: number[]\n  ): number {\n    // Agreement between Kalman and Transformer\n    const agreement = kalmanState.stateEstimate.reduce((sum, k, i) => {\n      const t = transformerPred[i] || k;\n      return sum + Math.exp(-Math.pow(k - t, 2));\n    }, 0) / kalmanState.stateEstimate.length;\n\n    // Low innovation = high confidence\n    const innovationMag = Math.sqrt(\n      kalmanState.innovation.reduce((sum, v) => sum + v * v, 0)\n    );\n    const innovationConfidence = Math.exp(-innovationMag);\n\n    return (agreement + innovationConfidence) / 2;\n  }\n\n  private computeAttentionWeights(embeddings: number[][]): number[][] {\n    const seqLen = embeddings.length;\n    const { embedDim } = this.config;\n\n    // Compute simplified attention weights\n    const weights: number[][] = [];\n\n    for (let i = 0; i < seqLen; i++) {\n      const weightRow: number[] = [];\n      const embI = embeddings[i];\n      if (!embI) continue;\n      for (let j = 0; j < seqLen; j++) {\n        let score = 0;\n        const embJ = embeddings[j];\n        if (!embJ) continue;\n        for (let k = 0; k < embedDim; k++) {\n          score += (embI[k] ?? 0) * (embJ[k] ?? 0);\n        }\n        weightRow[j] = score / Math.sqrt(embedDim);\n      }\n\n      // Softmax\n      const maxScore = Math.max(...weightRow);\n      const expScores = weightRow.map(s => Math.exp(s - maxScore));\n      const sumExp = expScores.reduce((a, b) => a + b, 0);\n      weights[i] = expScores.map(e => e / sumExp);\n    }\n\n    return weights;\n  }\n\n  private findMostInfluentialDimension(observation: number[]): string {\n    if (observation.length === 0) return 'unknown';\n    let maxIdx = 0;\n    let maxVal = Math.abs(observation[0] ?? 0);\n\n    for (let i = 1; i < observation.length; i++) {\n      const absVal = Math.abs(observation[i] ?? 0);\n      if (absVal > maxVal) {\n        maxVal = absVal;\n        maxIdx = i;\n      }\n    }\n\n    return STATE_DIMENSIONS[maxIdx] ?? `dim_${maxIdx}`;\n  }\n\n  private detectPatternMatching(attentionWeights: number[][]): boolean {\n    // Check if attention focuses on non-adjacent tokens (pattern matching)\n    if (attentionWeights.length < 3) return false;\n\n    const lastRow = attentionWeights[attentionWeights.length - 1];\n    if (!lastRow || lastRow.length < 2) return false;\n    const adjacentWeight = (lastRow[lastRow.length - 2] ?? 0) + (lastRow[lastRow.length - 1] ?? 0);\n    const totalWeight = lastRow.reduce((a, b) => a + b, 0);\n\n    // If < 50% of attention is on adjacent tokens, it's pattern matching\n    return totalWeight > 0 && adjacentWeight / totalWeight < 0.5;\n  }\n\n  // Matrix operations\n  private initIdentityMatrix(n: number): number[][] {\n    return Array(n).fill(null).map((_, i) =>\n      Array(n).fill(0).map((_, j) => i === j ? 1 : 0)\n    );\n  }\n\n  private initDiagonalMatrix(n: number, value: number): number[][] {\n    return Array(n).fill(null).map((_, i) =>\n      Array(n).fill(0).map((_, j) => i === j ? value : 0)\n    );\n  }\n\n  private initRandomMatrix(rows: number, cols: number): number[][] {\n    const scale = Math.sqrt(2.0 / (rows + cols));\n    return Array(rows).fill(null).map(() =>\n      Array(cols).fill(0).map(() => (Math.random() - 0.5) * 2 * scale)\n    );\n  }\n\n  private initPositionalEmbedding(maxLen: number, embedDim: number): number[][] {\n    const pe: number[][] = [];\n\n    for (let pos = 0; pos < maxLen; pos++) {\n      const row: number[] = [];\n      for (let i = 0; i < embedDim; i++) {\n        const angle = pos / Math.pow(10000, (2 * Math.floor(i / 2)) / embedDim);\n        row[i] = i % 2 === 0 ? Math.sin(angle) : Math.cos(angle);\n      }\n      pe[pos] = row;\n    }\n\n    return pe;\n  }\n\n  private initTransformerWeights(\n    numLayers: number,\n    numHeads: number,\n    embedDim: number,\n    headDim: number\n  ): number[][][] {\n    return Array(numLayers).fill(null).map(() =>\n      Array(numHeads).fill(null).map(() => {\n        const matrix = this.initRandomMatrix(embedDim, headDim);\n        return matrix[0] ?? new Array(headDim).fill(0);\n      })\n    );\n  }\n\n  private matVec(A: number[][], v: number[]): number[] {\n    return A.map(row => row.reduce((sum, val, j) => sum + val * (v[j] || 0), 0));\n  }\n\n  private matMul(A: number[][], B: number[][]): number[][] {\n    const rowsA = A.length;\n    const colsB = B[0]?.length || 0;\n    const colsA = A[0]?.length || 0;\n\n    return Array(rowsA).fill(null).map((_, i) =>\n      Array(colsB).fill(0).map((_, j) =>\n        Array(colsA).fill(0).reduce((sum, _, k) =>\n          sum + (A[i]?.[k] ?? 0) * (B[k]?.[j] ?? 0), 0\n        )\n      )\n    );\n  }\n\n  private transpose(A: number[][]): number[][] {\n    const rows = A.length;\n    const cols = A[0]?.length || 0;\n    return Array(cols).fill(null).map((_, i) =>\n      Array(rows).fill(0).map((_, j) => A[j]?.[i] || 0)\n    );\n  }\n\n  private matAdd(A: number[][], B: number[][]): number[][] {\n    return A.map((row, i) => row.map((val, j) => val + (B[i]?.[j] || 0)));\n  }\n\n  private matSub(A: number[][], B: number[][]): number[][] {\n    return A.map((row, i) => row.map((val, j) => val - (B[i]?.[j] || 0)));\n  }\n\n  private matInverse(A: number[][]): number[][] {\n    const n = A.length;\n    const identity = this.initIdentityMatrix(n);\n    const augmented = A.map((row, i) => [...row, ...(identity[i] ?? Array(n).fill(0))]);\n\n    for (let i = 0; i < n; i++) {\n      let maxRow = i;\n      const rowI = augmented[i];\n      if (!rowI) continue;\n\n      for (let k = i + 1; k < n; k++) {\n        const rowK = augmented[k];\n        const rowMax = augmented[maxRow];\n        if (!rowK || !rowMax) continue;\n        if (Math.abs(rowK[i] ?? 0) > Math.abs(rowMax[i] ?? 0)) {\n          maxRow = k;\n        }\n      }\n\n      const rowMax = augmented[maxRow];\n      if (rowMax) {\n        augmented[i] = rowMax;\n        augmented[maxRow] = rowI;\n      }\n\n      const currentRow = augmented[i];\n      if (!currentRow) continue;\n\n      const pivotVal = currentRow[i] ?? 0;\n      if (Math.abs(pivotVal) < 1e-10) {\n        return this.initDiagonalMatrix(n, 1);\n      }\n\n      for (let k = 0; k < n; k++) {\n        if (k !== i) {\n          const rowK = augmented[k];\n          if (!rowK) continue;\n          const factor = (rowK[i] ?? 0) / pivotVal;\n          for (let j = 0; j < 2 * n; j++) {\n            rowK[j] = (rowK[j] ?? 0) - factor * (currentRow[j] ?? 0);\n          }\n        }\n      }\n\n      const pivot = currentRow[i] ?? 1;\n      for (let j = 0; j < 2 * n; j++) {\n        currentRow[j] = (currentRow[j] ?? 0) / pivot;\n      }\n    }\n\n    return augmented.map(row => row.slice(n));\n  }\n\n  private sigmoid(x: number): number {\n    return 1 / (1 + Math.exp(-x));\n  }\n}\n\n/**\n * Factory function\n */\nexport function createKalmanFormerEngine(\n  config?: Partial<IKalmanFormerConfig>\n): IKalmanFormerEngine {\n  const engine = new KalmanFormerEngine(config);\n  engine.initialize(config);\n  return engine;\n}\n\nexport { DEFAULT_KALMANFORMER_CONFIG };\n","/**\n *  PLRNN ENGINE IMPLEMENTATION\n * ==============================\n * Piecewise Linear Recurrent Neural Network for Mental Health Dynamics\n *\n * Scientific Foundation (2025 Research):\n * - medRxiv 2025: \"PLRNNs provided the most accurate forecasts for EMA data\"\n * - Durstewitz Lab dendPLRNN: Interpretable nonlinear dynamics\n * - Brenner et al. 2022: \"Tractable Dendritic RNNs\" (ICML)\n *\n * Mathematical Formulation:\n * z_{t+1} = A * z_t + W * (z_t) + C * s_t + b_z\n * x_t = B * z_t + b_x\n *\n * where:\n * - z_t: latent state (5D: valence, arousal, dominance, risk, resources)\n * - A: diagonal autoregression matrix\n * - W: off-diagonal connection matrix (piecewise-linear dynamics)\n * - (z) = max(z, 0) (ReLU activation for piecewise-linear)\n * - s_t: external input (interventions, context)\n * - B: observation matrix\n *\n *   \" \", 2025\n */\n\nimport {\n  type IPLRNNEngine,\n  type IPLRNNConfig,\n  type IPLRNNState,\n  type IPLRNNPrediction,\n  type IPLRNNWeights,\n  type IPLRNNTrainingSample,\n  type IPLRNNTrainingResult,\n  type ICausalNetwork,\n  type ICausalNode,\n  type ICausalEdge,\n  type IEarlyWarningSignal,\n  type IInterventionSimulation,\n  DEFAULT_PLRNN_CONFIG,\n} from '../interfaces/IPLRNNEngine';\n\nimport {\n  type IKalmanFormerEngine,\n  type IKalmanFormerState,\n  type IKalmanFormerConfig,\n} from '../interfaces/IKalmanFormer';\nimport { KalmanFormerEngine } from './KalmanFormerEngine';\n\n/**\n * State dimension labels for interpretability\n */\nconst STATE_DIMENSIONS = ['valence', 'arousal', 'dominance', 'risk', 'resources'];\n\n/**\n * PLRNN Engine Implementation\n *\n * Key features:\n * - Piecewise-linear dynamics for nonlinear psychological modeling\n * - Interpretable causal network extraction\n * - Early warning signal detection (critical slowing down)\n * - Online learning for personalization\n */\nexport class PLRNNEngine implements IPLRNNEngine {\n  private config: IPLRNNConfig;\n  private weights: IPLRNNWeights | null = null;\n  private initialized = false;\n\n  // Training state\n  private trainingHistory: number[] = [];\n  private adamState: {\n    m: { [key: string]: number[][] };\n    v: { [key: string]: number[][] };\n    t: number;\n  } | null = null;\n\n  // KalmanFormer integration for hybrid predictions\n  // Per roadmap: Kalman for short-term, PLRNN for long-term\n  private kalmanFormer: IKalmanFormerEngine | null = null;\n  private kalmanFormerState: IKalmanFormerState | null = null;\n\n  constructor(config?: Partial<IPLRNNConfig>) {\n    this.config = { ...DEFAULT_PLRNN_CONFIG, ...config };\n  }\n\n  // ============================================================================\n  // INITIALIZATION\n  // ============================================================================\n\n  initialize(config?: Partial<IPLRNNConfig>): void {\n    if (config) {\n      this.config = { ...this.config, ...config };\n    }\n\n    // Initialize weights with improved stability\n    // Based on 2025 research: careful initialization prevents divergence\n    const n = this.config.latentDim;\n    // Note: hiddenUnits reserved for future shPLRNN expansion (W  , W  )\n\n    // Diagonal autoregression: values < 1 for stability (eigenvalues < 1)\n    // Research shows A should be in range [0.8, 0.95] for stable dynamics\n    const A = Array(n).fill(0).map(() => 0.85 + Math.random() * 0.1);\n\n    // Off-diagonal connections: smaller scale for stability\n    // Initialize with smaller magnitude to prevent gradient explosion\n    const W = this.initializeMatrix(n, n, 'sparse_stable');\n\n    // Observation matrix: near-identity for interpretability\n    // Small perturbation around identity prevents degenerate solutions\n    const B = this.initializeMatrix(n, n, 'near_identity');\n\n    // Bias vectors: zero initialization for stability\n    // Let the model learn appropriate biases during training\n    const biasLatent = Array(n).fill(0).map(() => 0);\n    const biasObserved = Array(n).fill(0).map(() => 0);\n\n    // Dendritic weights if using dendPLRNN\n    let dendriticWeights: number[][] | undefined;\n    let C: number[][] | undefined;\n\n    if (this.config.connectivity === 'dendritic' && this.config.dendriticBases) {\n      const d = this.config.dendriticBases;\n      dendriticWeights = this.initializeMatrix(n, d, 'normal');\n      C = this.initializeMatrix(n, d, 'normal');\n    }\n\n    this.weights = {\n      A,\n      W,\n      B,\n      C,\n      biasLatent,\n      biasObserved,\n      dendriticWeights,\n      meta: {\n        trainedAt: new Date(),\n        trainingSamples: 0,\n        validationLoss: Infinity,\n        config: this.config,\n      },\n    };\n\n    // Initialize Adam optimizer state\n    this.adamState = {\n      m: {},\n      v: {},\n      t: 0,\n    };\n\n    // Initialize KalmanFormer for hybrid short-term predictions\n    // Per roadmap: Kalman handles short-term (h=1-3), PLRNN handles long-term (h=6+)\n    const kalmanConfig: Partial<IKalmanFormerConfig> = {\n      stateDim: n,\n      obsDim: n,\n      embedDim: Math.max(32, n * 8), // Scale with state dimension\n      numHeads: 4,\n      numLayers: 2,\n      contextWindow: 24,\n      blendRatio: 0.3, // Favor Kalman for stability in short-term\n      learnedGain: true,\n    };\n    this.kalmanFormer = new KalmanFormerEngine(kalmanConfig);\n    this.kalmanFormer.initialize(kalmanConfig);\n\n    this.initialized = true;\n  }\n\n  loadWeights(weights: IPLRNNWeights): void {\n    this.weights = JSON.parse(JSON.stringify(weights));\n    if (weights.meta?.config) {\n      this.config = weights.meta.config;\n    }\n    this.initialized = true;\n  }\n\n  getWeights(): IPLRNNWeights {\n    if (!this.weights) {\n      throw new Error('PLRNN not initialized. Call initialize() first.');\n    }\n    return JSON.parse(JSON.stringify(this.weights));\n  }\n\n  // ============================================================================\n  // FORWARD PASS\n  // ============================================================================\n\n  /**\n   * Forward pass: compute next state\n   *\n   * z_{t+1} = A * z_t + W * (z_t) + C * s_t + b_z\n   * x_t = B * z_t + b_x\n   *\n   * where (z) = max(z, 0) (ReLU for piecewise-linear dynamics)\n   */\n  forward(state: IPLRNNState, input?: number[]): IPLRNNState {\n    if (!this.weights || !this.initialized) {\n      throw new Error('PLRNN not initialized');\n    }\n\n    const { A, W, B, C, biasLatent, biasObserved, dendriticWeights } = this.weights;\n    const z = state.latentState;\n    const n = z.length;\n\n    // Piecewise-linear activation (z) = max(z, 0)\n    const phiZ = z.map(v => Math.max(0, v));\n\n    // Autoregression: A * z_t\n    const Az = z.map((zi, i) => (A[i] ?? 0.9) * zi);\n\n    // Off-diagonal dynamics: W * (z_t)\n    const WphiZ = this.matVec(W, phiZ);\n\n    // Dendritic basis expansion (if dendPLRNN)\n    let dendriticTerm: number[] = Array(n).fill(0);\n    if (this.config.connectivity === 'dendritic' && dendriticWeights && C) {\n      // Dendritic nonlinearity: sum of ReLU basis functions\n      const bases = dendriticWeights.map(row =>\n        row.reduce((sum, w, i) => sum + w * (z[i % z.length] ?? 0), 0)\n      );\n      const activatedBases = bases.map(b => Math.max(0, b));\n      dendriticTerm = C.map(row =>\n        row.reduce((sum, c, i) => sum + c * (activatedBases[i] ?? 0), 0)\n      );\n    }\n\n    // Input term: C * s_t (if external input provided)\n    let inputTerm: number[] = Array(n).fill(0);\n    if (input && C) {\n      inputTerm = C.map(row =>\n        row.reduce((sum, c, i) => sum + c * (input[i] || 0), 0)\n      );\n    }\n\n    // Combine: z_{t+1} = A*z_t + W*(z_t) + dendritic + input + bias\n    // Add clamping to prevent state explosion (numerical stability)\n    const stateClamp = 10.0; // Reasonable range for normalized data\n    const zNext = Az.map((azi, i) => {\n      const val = azi + (WphiZ[i] ?? 0) + (dendriticTerm[i] ?? 0) + (inputTerm[i] ?? 0) + (biasLatent[i] ?? 0);\n      // Clamp to prevent explosion\n      return Math.max(-stateClamp, Math.min(stateClamp, Number.isFinite(val) ? val : 0));\n    });\n\n    // Observation: x_t = B * z_t + b_x\n    const xNext = this.matVec(B, zNext).map((v, i) => {\n      const val = v + (biasObserved[i] ?? 0);\n      // Clamp observations to reasonable range\n      return Math.max(-stateClamp, Math.min(stateClamp, Number.isFinite(val) ? val : 0));\n    });\n\n    // Compute uncertainty (based on distance from training manifold)\n    const uncertainty = this.computeUncertainty(zNext, state.uncertainty);\n\n    // Hidden activations for interpretability\n    const hiddenActivations = phiZ;\n\n    return {\n      latentState: zNext,\n      hiddenActivations,\n      observedState: xNext,\n      uncertainty,\n      timestamp: new Date(state.timestamp.getTime() + this.config.dt * 3600000),\n      timestep: state.timestep + 1,\n    };\n  }\n\n  // ============================================================================\n  // PREDICTION\n  // ============================================================================\n\n  predict(\n    currentState: IPLRNNState,\n    horizon: number,\n    input?: number[][]\n  ): IPLRNNPrediction {\n    const trajectory: IPLRNNState[] = [currentState];\n    let state = currentState;\n\n    // Multi-step prediction\n    for (let t = 0; t < horizon; t++) {\n      const inputT = input ? input[t] : undefined;\n      state = this.forward(state, inputT);\n      trajectory.push(state);\n    }\n\n    // Compute statistics\n    const finalState = trajectory[trajectory.length - 1]!;\n    const meanPrediction = finalState.observedState;\n\n    // Confidence intervals (using accumulated uncertainty)\n    const uncertaintyScale = 1.96; // 95% CI\n    const lower = meanPrediction.map((m, i) =>\n      m - uncertaintyScale * Math.sqrt(finalState.uncertainty[i] ?? 0.1)\n    );\n    const upper = meanPrediction.map((m, i) =>\n      m + uncertaintyScale * Math.sqrt(finalState.uncertainty[i] ?? 0.1)\n    );\n\n    // Variance at each step\n    const variance = trajectory.map(s => s.uncertainty);\n\n    // Detect early warning signals\n    const earlyWarningSignals = this.detectEarlyWarnings(trajectory, Math.min(5, trajectory.length));\n\n    return {\n      trajectory,\n      meanPrediction,\n      confidenceInterval: {\n        lower,\n        upper,\n        level: 0.95,\n      },\n      variance,\n      earlyWarningSignals,\n      horizon,\n    };\n  }\n\n  hybridPredict(\n    currentState: IPLRNNState,\n    horizon: 'short' | 'medium' | 'long'\n  ): IPLRNNPrediction {\n    const horizonMap = {\n      short: 3,   // 3 steps - KalmanFormer optimal\n      medium: 12, // 12 steps - blended approach\n      long: 48,   // 48 steps - full PLRNN nonlinear\n    };\n\n    const steps = horizonMap[horizon];\n\n    // Per roadmap architecture:\n    // - Short-term (h=1-3): Use KalmanFormer (optimal for noisy, linear-ish dynamics)\n    // - Long-term (h=6+): Use PLRNN (captures nonlinear patterns)\n    // - Medium: Blend both predictions\n\n    if (horizon === 'short' && this.kalmanFormer) {\n      // Use KalmanFormer for short-term predictions\n      // KalmanFormer is better at short-term because:\n      // 1. Kalman filter is optimal for linear Gaussian systems\n      // 2. Persistence baseline is strong for h=1-3 due to autocorrelation\n      // 3. KalmanFormer's learned gain adapts to observation noise\n\n      // Initialize or update KalmanFormer state from PLRNN state\n      if (!this.kalmanFormerState) {\n        this.kalmanFormerState = this.kalmanFormer.fromPLRNNState(currentState);\n      }\n\n      // Update with current observation\n      this.kalmanFormerState = this.kalmanFormer.update(\n        this.kalmanFormerState,\n        currentState.observedState,\n        currentState.timestamp\n      );\n\n      // Get KalmanFormer prediction\n      const kalmanPrediction = this.kalmanFormer.predict(this.kalmanFormerState, steps);\n\n      // Convert to PLRNN prediction format\n      const trajectory = kalmanPrediction.trajectory?.map(s =>\n        this.kalmanFormer!.toPLRNNState(s)\n      ) ?? [currentState];\n\n      // Use KalmanFormer's confidence interval\n      // Variance format: [step][dimension] - extract diagonal from covariance\n      const variance: number[][] = trajectory.map(() =>\n        kalmanPrediction.covariance.map((row, i) => row[i] ?? 0.1)\n      );\n\n      return {\n        trajectory,\n        meanPrediction: kalmanPrediction.blendedPrediction,\n        confidenceInterval: kalmanPrediction.confidenceInterval,\n        variance,\n        earlyWarningSignals: this.detectEarlyWarnings(trajectory, Math.min(3, trajectory.length)),\n        horizon: steps,\n      };\n    } else if (horizon === 'medium' && this.kalmanFormer) {\n      // Blend KalmanFormer and PLRNN predictions for medium horizon\n      // This captures both short-term stability and long-term patterns\n\n      // Get PLRNN prediction\n      const plrnnPrediction = this.predict(currentState, steps);\n\n      // Get KalmanFormer prediction\n      if (!this.kalmanFormerState) {\n        this.kalmanFormerState = this.kalmanFormer.fromPLRNNState(currentState);\n      }\n      this.kalmanFormerState = this.kalmanFormer.update(\n        this.kalmanFormerState,\n        currentState.observedState,\n        currentState.timestamp\n      );\n      const kalmanPrediction = this.kalmanFormer.predict(this.kalmanFormerState, steps);\n\n      // Adaptive blending: more Kalman for early steps, more PLRNN for later\n      // Blend ratio: start at 0.7 Kalman, decay to 0.3 Kalman by end\n      const blendedMean = plrnnPrediction.meanPrediction.map((plrnnVal, i) => {\n        const kalmanVal = kalmanPrediction.blendedPrediction[i] ?? plrnnVal;\n        const kalmanWeight = 0.5; // Equal weight for medium horizon\n        return kalmanWeight * kalmanVal + (1 - kalmanWeight) * plrnnVal;\n      });\n\n      // Blend confidence intervals (take wider bounds for safety)\n      const lower = plrnnPrediction.confidenceInterval.lower.map((plrnnLower, i) => {\n        const kalmanLower = kalmanPrediction.confidenceInterval.lower[i] ?? plrnnLower;\n        return Math.min(plrnnLower, kalmanLower);\n      });\n      const upper = plrnnPrediction.confidenceInterval.upper.map((plrnnUpper, i) => {\n        const kalmanUpper = kalmanPrediction.confidenceInterval.upper[i] ?? plrnnUpper;\n        return Math.max(plrnnUpper, kalmanUpper);\n      });\n\n      return {\n        trajectory: plrnnPrediction.trajectory,\n        meanPrediction: blendedMean,\n        confidenceInterval: { lower, upper, level: 0.95 },\n        variance: plrnnPrediction.variance,\n        earlyWarningSignals: plrnnPrediction.earlyWarningSignals,\n        horizon: steps,\n      };\n    } else {\n      // Long horizon: Use full PLRNN for nonlinear dynamics\n      // PLRNN excels at capturing:\n      // 1. Nonlinear mood transitions\n      // 2. Complex causal patterns\n      // 3. Critical slowing down before transitions\n      return this.predict(currentState, steps);\n    }\n  }\n\n  /**\n   * Update KalmanFormer state with new observation\n   * Call this after each observation to maintain state synchronization\n   */\n  updateKalmanFormerState(observation: number[], timestamp: Date): void {\n    if (!this.kalmanFormer) return;\n\n    if (!this.kalmanFormerState) {\n      // Initialize with observation\n      const initialState: IPLRNNState = {\n        latentState: [...observation],\n        hiddenActivations: observation.map(v => Math.max(0, v)),\n        observedState: [...observation],\n        uncertainty: Array(observation.length).fill(0.1),\n        timestamp,\n        timestep: 0,\n      };\n      this.kalmanFormerState = this.kalmanFormer.fromPLRNNState(initialState);\n    } else {\n      this.kalmanFormerState = this.kalmanFormer.update(\n        this.kalmanFormerState,\n        observation,\n        timestamp\n      );\n    }\n  }\n\n  /**\n   * Get the current KalmanFormer state (for debugging/analysis)\n   */\n  getKalmanFormerState(): IKalmanFormerState | null {\n    return this.kalmanFormerState;\n  }\n\n  // ============================================================================\n  // CAUSAL NETWORK EXTRACTION\n  // ============================================================================\n\n  extractCausalNetwork(): ICausalNetwork {\n    if (!this.weights) {\n      throw new Error('PLRNN not initialized');\n    }\n\n    const { A, W } = this.weights;\n    const n = this.config.latentDim;\n\n    // Create nodes\n    const nodes: ICausalNode[] = STATE_DIMENSIONS.slice(0, n).map((label, i) => ({\n      id: `node_${i}`,\n      label,\n      selfWeight: A[i] ?? 0.9,\n      centrality: this.calculateCentrality(W, i),\n      value: 0, // Will be updated with actual state\n    }));\n\n    // Create edges (only significant connections)\n    const edges: ICausalEdge[] = [];\n    const significanceThreshold = 0.1;\n\n    for (let i = 0; i < n; i++) {\n      const row = W[i];\n      if (!row) continue;\n      for (let j = 0; j < n; j++) {\n        const weight = row[j] ?? 0;\n        if (i !== j && Math.abs(weight) > significanceThreshold) {\n          edges.push({\n            source: `node_${j}`,\n            target: `node_${i}`,\n            weight,\n            lag: this.config.dt,\n            significance: this.computeEdgeSignificance(weight, n),\n          });\n        }\n      }\n    }\n\n    // Calculate network metrics\n    const density = edges.length / (n * (n - 1));\n    const centralNode = nodes.reduce((max, node) =>\n      node.centrality > max.centrality ? node : max\n    ).label;\n\n    // Detect feedback loops (simplified: 2-node loops)\n    const feedbackLoops = this.detectFeedbackLoops(W, n);\n\n    return {\n      nodes,\n      edges,\n      metrics: {\n        density,\n        centralNode,\n        feedbackLoops,\n      },\n    };\n  }\n\n  // ============================================================================\n  // INTERVENTION SIMULATION\n  // ============================================================================\n\n  simulateIntervention(\n    currentState: IPLRNNState,\n    target: string,\n    intervention: 'increase' | 'decrease' | 'stabilize',\n    magnitude: number\n  ): IInterventionSimulation {\n    if (!this.weights) {\n      throw new Error('PLRNN not initialized');\n    }\n\n    const targetIdx = STATE_DIMENSIONS.indexOf(target);\n    if (targetIdx === -1) {\n      throw new Error(`Unknown target dimension: ${target}`);\n    }\n\n    // Create intervention input\n    const input = Array(this.config.latentDim).fill(0);\n\n    switch (intervention) {\n      case 'increase':\n        input[targetIdx] = magnitude;\n        break;\n      case 'decrease':\n        input[targetIdx] = -magnitude;\n        break;\n      case 'stabilize':\n        // For stabilization, we dampen the target dimension\n        input[targetIdx] = -(currentState.latentState[targetIdx] ?? 0) * 0.5;\n        break;\n    }\n\n    // Simulate system response over 24 hours\n    const horizon = 24;\n    const baselineTrajectory = this.predict(currentState, horizon);\n    const interventionTrajectory = this.predict(currentState, horizon, Array(horizon).fill(input));\n\n    // Calculate effects on each dimension\n    const effects = new Map<string, number>();\n    const n = this.config.latentDim;\n\n    for (let i = 0; i < n; i++) {\n      const baseline = baselineTrajectory.meanPrediction[i] ?? 0;\n      const intervened = interventionTrajectory.meanPrediction[i] ?? 0;\n      const effect = intervened - baseline;\n      const dimLabel = STATE_DIMENSIONS[i] ?? `dim_${i}`;\n      effects.set(dimLabel, effect);\n    }\n\n    // Find time to peak effect\n    let maxEffect = 0;\n    let timeToPeak = 0;\n\n    for (let t = 0; t < horizon; t++) {\n      const intState = interventionTrajectory.trajectory[t];\n      const baseState = baselineTrajectory.trajectory[t];\n      if (!intState || !baseState) continue;\n      const effect = Math.abs(\n        (intState.observedState[targetIdx] ?? 0) -\n        (baseState.observedState[targetIdx] ?? 0)\n      );\n      if (effect > maxEffect) {\n        maxEffect = effect;\n        timeToPeak = t * this.config.dt;\n      }\n    }\n\n    // Identify side effects (unintended changes > 0.1)\n    const sideEffects: Array<{ dimension: string; effect: number }> = [];\n    effects.forEach((effect, dimension) => {\n      if (dimension !== target && Math.abs(effect) > 0.1) {\n        sideEffects.push({ dimension, effect });\n      }\n    });\n\n    // Estimate duration (time until effect decays to 10%)\n    let duration = horizon;\n    for (let t = Math.floor(timeToPeak / this.config.dt); t < horizon; t++) {\n      const intState = interventionTrajectory.trajectory[t];\n      const baseState = baselineTrajectory.trajectory[t];\n      if (!intState || !baseState) continue;\n      const effect = Math.abs(\n        (intState.observedState[targetIdx] ?? 0) -\n        (baseState.observedState[targetIdx] ?? 0)\n      );\n      if (effect < maxEffect * 0.1) {\n        duration = t * this.config.dt;\n        break;\n      }\n    }\n\n    // Confidence based on model certainty\n    const finalVariance = interventionTrajectory.variance[horizon - 1];\n    const confidence = 1 - (finalVariance?.[targetIdx] ?? 0.5);\n\n    return {\n      target: { dimension: target, intervention, magnitude },\n      response: {\n        effects,\n        timeToPeak,\n        duration,\n        sideEffects,\n      },\n      confidence: Math.max(0, Math.min(1, confidence)),\n    };\n  }\n\n  // ============================================================================\n  // EARLY WARNING SIGNALS\n  // ============================================================================\n\n  detectEarlyWarnings(\n    stateHistory: IPLRNNState[],\n    windowSize: number\n  ): IEarlyWarningSignal[] {\n    if (stateHistory.length < windowSize * 2) {\n      return []; // Not enough data\n    }\n\n    const signals: IEarlyWarningSignal[] = [];\n    const n = this.config.latentDim;\n\n    // Split into early and late windows\n    const earlyWindow = stateHistory.slice(0, windowSize);\n    const lateWindow = stateHistory.slice(-windowSize);\n\n    for (let dim = 0; dim < n; dim++) {\n      const dimLabel = STATE_DIMENSIONS[dim] ?? `dim_${dim}`;\n\n      // 1. Rising Autocorrelation (critical slowing down)\n      const earlyAC = this.calculateAutocorrelation(\n        earlyWindow.map(s => s.latentState[dim] ?? 0)\n      );\n      const lateAC = this.calculateAutocorrelation(\n        lateWindow.map(s => s.latentState[dim] ?? 0)\n      );\n\n      if (lateAC > earlyAC + 0.1 && lateAC > 0.5) {\n        signals.push({\n          type: 'autocorrelation',\n          dimension: dimLabel,\n          strength: (lateAC - earlyAC) / (1 - earlyAC),\n          estimatedTimeToTransition: this.estimateTransitionTime(lateAC),\n          confidence: Math.min(1, stateHistory.length / 50),\n          recommendation: `   ${dimLabel}      .   .`,\n        });\n      }\n\n      // 2. Rising Variance\n      const earlyVar = this.calculateVariance(\n        earlyWindow.map(s => s.latentState[dim] ?? 0)\n      );\n      const lateVar = this.calculateVariance(\n        lateWindow.map(s => s.latentState[dim] ?? 0)\n      );\n\n      if (lateVar > earlyVar * 1.5) {\n        signals.push({\n          type: 'variance',\n          dimension: dimLabel,\n          strength: (lateVar - earlyVar) / earlyVar,\n          estimatedTimeToTransition: null,\n          confidence: Math.min(1, stateHistory.length / 50),\n          recommendation: `  ${dimLabel}.    .`,\n        });\n      }\n\n      // 3. Flickering (bimodal distribution approaching)\n      const flickering = this.detectFlickering(\n        lateWindow.map(s => s.latentState[dim] ?? 0)\n      );\n\n      if (flickering > 0.3) {\n        signals.push({\n          type: 'flickering',\n          dimension: dimLabel,\n          strength: flickering,\n          estimatedTimeToTransition: 12, // hours\n          confidence: 0.6,\n          recommendation: ` \"\"  ${dimLabel} -     .`,\n        });\n      }\n    }\n\n    // 4. Rising Connectivity (network-level)\n    if (this.weights) {\n      const connectivity = this.calculateNetworkConnectivity(stateHistory);\n      if (connectivity.late > connectivity.early * 1.3) {\n        signals.push({\n          type: 'connectivity',\n          dimension: 'network',\n          strength: (connectivity.late - connectivity.early) / connectivity.early,\n          estimatedTimeToTransition: null,\n          confidence: 0.7,\n          recommendation: '    .       .',\n        });\n      }\n    }\n\n    return signals;\n  }\n\n  // ============================================================================\n  // TRAINING\n  // ============================================================================\n\n  trainOnline(sample: IPLRNNTrainingSample): IPLRNNTrainingResult {\n    if (!this.weights || !this.adamState) {\n      this.initialize();\n    }\n\n    const startTime = Date.now();\n    const { observations, timestamps: _timestamps } = sample;\n\n    if (observations.length < 2) {\n      return {\n        loss: Infinity,\n        validationLoss: Infinity,\n        epochs: 0,\n        trainingTime: 0,\n        converged: false,\n        weights: this.weights!,\n      };\n    }\n\n    // Single pass through sequence\n    let totalLoss = 0;\n    const firstObs = observations[0];\n    if (!firstObs) {\n      return {\n        loss: Infinity,\n        validationLoss: Infinity,\n        epochs: 0,\n        trainingTime: 0,\n        converged: false,\n        weights: this.weights!,\n      };\n    }\n    let state = this.initializeState(firstObs);\n\n    for (let t = 0; t < observations.length - 1; t++) {\n      // Forward pass\n      const predicted = this.forward(state);\n\n      // Calculate loss\n      const target = observations[t + 1];\n      if (!target) continue;\n      const loss = this.calculateLoss([predicted.observedState], [target]);\n      totalLoss += loss;\n\n      // Backward pass (BPTT simplified to one step for online)\n      this.updateWeightsOnline(state, predicted, target);\n\n      // Teacher forcing\n      if (Math.random() < this.config.teacherForcingRatio) {\n        state = this.initializeState(target);\n        state.timestep = predicted.timestep;\n      } else {\n        state = predicted;\n      }\n    }\n\n    const avgLoss = totalLoss / (observations.length - 1);\n    this.trainingHistory.push(avgLoss);\n\n    // Update meta\n    this.weights!.meta.trainingSamples++;\n    this.weights!.meta.trainedAt = new Date();\n\n    return {\n      loss: avgLoss,\n      validationLoss: avgLoss,\n      epochs: 1,\n      trainingTime: Date.now() - startTime,\n      converged: avgLoss < 0.1,\n      weights: this.weights!,\n    };\n  }\n\n  trainBatch(samples: IPLRNNTrainingSample[]): IPLRNNTrainingResult {\n    const startTime = Date.now();\n    let totalLoss = 0;\n\n    for (const sample of samples) {\n      const result = this.trainOnline(sample);\n      totalLoss += result.loss;\n    }\n\n    const avgLoss = totalLoss / samples.length;\n    const converged = avgLoss < 0.05;\n\n    if (converged) {\n      this.weights!.meta.validationLoss = avgLoss;\n    }\n\n    return {\n      loss: avgLoss,\n      validationLoss: avgLoss,\n      epochs: samples.length,\n      trainingTime: Date.now() - startTime,\n      converged,\n      weights: this.weights!,\n    };\n  }\n\n  calculateLoss(predicted: number[][], actual: number[][]): number {\n    let loss = 0;\n    let count = 0;\n\n    for (let t = 0; t < predicted.length; t++) {\n      const predRow = predicted[t];\n      const actualRow = actual[t];\n      if (!predRow || !actualRow) continue;\n      for (let i = 0; i < predRow.length; i++) {\n        const diff = (predRow[i] ?? 0) - (actualRow[i] ?? 0);\n        loss += diff * diff;\n        count++;\n      }\n    }\n\n    return count > 0 ? loss / count : 0;\n  }\n\n  getComplexityMetrics(): {\n    effectiveDimensionality: number;\n    sparsity: number;\n    lyapunovExponent: number;\n  } {\n    if (!this.weights) {\n      return { effectiveDimensionality: 0, sparsity: 0, lyapunovExponent: 0 };\n    }\n\n    const { W } = this.weights;\n    const n = W.length;\n\n    // Sparsity (fraction of near-zero weights)\n    let zeroCount = 0;\n    let totalCount = 0;\n    for (let i = 0; i < n; i++) {\n      const row = W[i];\n      if (!row) continue;\n      for (let j = 0; j < n; j++) {\n        if (Math.abs(row[j] ?? 0) < 0.01) zeroCount++;\n        totalCount++;\n      }\n    }\n    const sparsity = totalCount > 0 ? zeroCount / totalCount : 0;\n\n    // Effective dimensionality (based on singular values approximation)\n    const effectiveDimensionality = n * (1 - sparsity);\n\n    // Lyapunov exponent approximation (stability indicator)\n    const maxEigenvalue = this.approximateMaxEigenvalue(W);\n    const lyapunovExponent = Math.log(Math.abs(maxEigenvalue));\n\n    return {\n      effectiveDimensionality,\n      sparsity,\n      lyapunovExponent,\n    };\n  }\n\n  // ============================================================================\n  // PRIVATE HELPERS\n  // ============================================================================\n\n  private initializeMatrix(\n    rows: number,\n    cols: number,\n    type: 'sparse' | 'full' | 'identity' | 'normal' | 'sparse_stable' | 'near_identity'\n  ): number[][] {\n    const matrix: number[][] = [];\n    const scale = Math.sqrt(2.0 / (rows + cols)); // Xavier initialization\n\n    for (let i = 0; i < rows; i++) {\n      const row: number[] = [];\n      for (let j = 0; j < cols; j++) {\n        if (type === 'identity') {\n          row[j] = i === j ? 1 : 0;\n        } else if (type === 'near_identity') {\n          // Near-identity: identity + small perturbation\n          // Better for stable training while allowing learning\n          row[j] = i === j ? 1 + (Math.random() - 0.5) * 0.1 : (Math.random() - 0.5) * 0.02;\n        } else if (type === 'sparse') {\n          // Sparse: 80% zeros\n          row[j] = Math.random() < 0.2 ? (Math.random() - 0.5) * 2 * scale : 0;\n        } else if (type === 'sparse_stable') {\n          // Sparse with smaller scale for stability\n          // 70% zeros, smaller magnitude for non-zero entries\n          const smallScale = scale * 0.3; // Reduced scale\n          row[j] = Math.random() < 0.3 ? (Math.random() - 0.5) * 2 * smallScale : 0;\n        } else {\n          // Full or normal\n          row[j] = (Math.random() - 0.5) * 2 * scale;\n        }\n      }\n      matrix[i] = row;\n    }\n\n    return matrix;\n  }\n\n  private matVec(A: number[][], v: number[]): number[] {\n    return A.map(row => row.reduce((sum, val, j) => sum + val * (v[j] ?? 0), 0));\n  }\n\n  private initializeState(observation: number[]): IPLRNNState {\n    const n = this.config.latentDim;\n    const obs = observation.slice(0, n);\n\n    // Pad if observation is smaller than latent dim\n    while (obs.length < n) {\n      obs.push(0);\n    }\n\n    return {\n      latentState: [...obs],\n      hiddenActivations: obs.map(v => Math.max(0, v)),\n      observedState: [...obs],\n      uncertainty: Array(n).fill(0.1),\n      timestamp: new Date(),\n      timestep: 0,\n    };\n  }\n\n  private computeUncertainty(zNext: number[], prevUncertainty: number[]): number[] {\n    // Uncertainty grows with distance from training data\n    // Simplified: exponential growth with dampening\n    const growthRate = 0.05;\n    const maxUncertainty = 1.0;\n\n    return prevUncertainty.map((u, i) => {\n      const stateDeviation = Math.abs(zNext[i] ?? 0) > 2 ? 0.1 : 0;\n      const newU = u * (1 + growthRate) + stateDeviation;\n      return Math.min(maxUncertainty, newU);\n    });\n  }\n\n  private calculateCentrality(W: number[][], nodeIdx: number): number {\n    // Out-degree centrality (sum of absolute outgoing weights)\n    const nodeRow = W[nodeIdx];\n    const outStrength = nodeRow ? nodeRow.reduce((sum, w) => sum + Math.abs(w), 0) : 0;\n\n    // In-degree centrality (sum of absolute incoming weights)\n    let inStrength = 0;\n    for (let i = 0; i < W.length; i++) {\n      const row = W[i];\n      if (row) {\n        inStrength += Math.abs(row[nodeIdx] ?? 0);\n      }\n    }\n\n    return (outStrength + inStrength) / (2 * W.length);\n  }\n\n  private computeEdgeSignificance(weight: number, n: number): number {\n    // Simplified: absolute weight normalized\n    const expectedWeight = 1 / n;\n    return Math.min(1, Math.abs(weight) / expectedWeight);\n  }\n\n  private detectFeedbackLoops(W: number[][], n: number): string[][] {\n    const loops: string[][] = [];\n    const threshold = 0.1;\n\n    // Detect 2-node loops\n    for (let i = 0; i < n; i++) {\n      const rowI = W[i];\n      const rowJ_check = W;\n      if (!rowI) continue;\n      for (let j = i + 1; j < n; j++) {\n        const rowJ = rowJ_check[j];\n        if (!rowJ) continue;\n        const wij = rowI[j] ?? 0;\n        const wji = rowJ[i] ?? 0;\n        if (Math.abs(wij) > threshold && Math.abs(wji) > threshold) {\n          const dimI = STATE_DIMENSIONS[i] ?? `dim_${i}`;\n          const dimJ = STATE_DIMENSIONS[j] ?? `dim_${j}`;\n          loops.push([dimI, dimJ]);\n        }\n      }\n    }\n\n    return loops;\n  }\n\n  private calculateAutocorrelation(series: number[]): number {\n    if (series.length < 3) return 0;\n\n    const mean = series.reduce((a, b) => a + b, 0) / series.length;\n    let numerator = 0;\n    let denominator = 0;\n\n    for (let t = 0; t < series.length - 1; t++) {\n      const vt = series[t] ?? 0;\n      const vt1 = series[t + 1] ?? 0;\n      numerator += (vt - mean) * (vt1 - mean);\n    }\n\n    for (let t = 0; t < series.length; t++) {\n      const vt = series[t] ?? 0;\n      denominator += (vt - mean) ** 2;\n    }\n\n    return denominator > 0 ? numerator / denominator : 0;\n  }\n\n  private calculateVariance(series: number[]): number {\n    if (series.length < 2) return 0;\n\n    const mean = series.reduce((a, b) => a + b, 0) / series.length;\n    const variance = series.reduce((sum, v) => sum + (v - mean) ** 2, 0) / (series.length - 1);\n\n    return variance;\n  }\n\n  private detectFlickering(series: number[]): number {\n    if (series.length < 5) return 0;\n\n    // Count zero-crossings around mean (indicator of bimodality)\n    const mean = series.reduce((a, b) => a + b, 0) / series.length;\n    let crossings = 0;\n\n    for (let t = 1; t < series.length; t++) {\n      const prev = series[t - 1] ?? 0;\n      const curr = series[t] ?? 0;\n      if ((prev < mean && curr >= mean) ||\n          (prev >= mean && curr < mean)) {\n        crossings++;\n      }\n    }\n\n    // Normalize by expected crossings for white noise\n    const expectedCrossings = (series.length - 1) / 2;\n    const flickering = crossings / expectedCrossings;\n\n    // High flickering = approaching bimodal distribution\n    return Math.max(0, flickering - 1);\n  }\n\n  private estimateTransitionTime(autocorrelation: number): number | null {\n    if (autocorrelation < 0.7) return null;\n\n    // Empirical formula based on critical slowing down theory\n    // Time to transition ~ 1 / (1 - AC)\n    const timeScale = 1 / (1 - autocorrelation);\n    return Math.min(48, timeScale * this.config.dt); // Cap at 48 hours\n  }\n\n  private calculateNetworkConnectivity(stateHistory: IPLRNNState[]): { early: number; late: number } {\n    const midpoint = Math.floor(stateHistory.length / 2);\n\n    const calculateCorrelationMatrix = (states: IPLRNNState[]): number => {\n      const n = this.config.latentDim;\n      let totalCorr = 0;\n      let count = 0;\n\n      for (let i = 0; i < n; i++) {\n        for (let j = i + 1; j < n; j++) {\n          const seriesI = states.map(s => s.latentState[i] ?? 0);\n          const seriesJ = states.map(s => s.latentState[j] ?? 0);\n          const corr = this.calculateCorrelation(seriesI, seriesJ);\n          totalCorr += Math.abs(corr);\n          count++;\n        }\n      }\n\n      return count > 0 ? totalCorr / count : 0;\n    };\n\n    return {\n      early: calculateCorrelationMatrix(stateHistory.slice(0, midpoint)),\n      late: calculateCorrelationMatrix(stateHistory.slice(midpoint)),\n    };\n  }\n\n  private calculateCorrelation(x: number[], y: number[]): number {\n    const n = x.length;\n    if (n < 3) return 0;\n\n    const meanX = x.reduce((a, b) => a + b, 0) / n;\n    const meanY = y.reduce((a, b) => a + b, 0) / n;\n\n    let numerator = 0;\n    let denomX = 0;\n    let denomY = 0;\n\n    for (let i = 0; i < n; i++) {\n      const dx = (x[i] ?? 0) - meanX;\n      const dy = (y[i] ?? 0) - meanY;\n      numerator += dx * dy;\n      denomX += dx * dx;\n      denomY += dy * dy;\n    }\n\n    const denom = Math.sqrt(denomX * denomY);\n    return denom > 0 ? numerator / denom : 0;\n  }\n\n  private updateWeightsOnline(\n    prevState: IPLRNNState,\n    predicted: IPLRNNState,\n    target: number[]\n  ): void {\n    if (!this.weights || !this.adamState) return;\n\n    const { A, W, B, biasLatent, biasObserved } = this.weights;\n    const lr = this.config.learningRate;\n    const clip = this.config.gradientClip;\n    const l1 = this.config.l1Regularization;\n\n    // Compute output error\n    const outputError = predicted.observedState.map((p, i) => (target[i] ?? 0) - p);\n\n    // Backpropagate through observation matrix B\n    const latentError = this.matVec(\n      B.map(row => [...row]), // Transpose approximation for square matrix\n      outputError\n    );\n\n    // Gradient for B\n    for (let i = 0; i < B.length; i++) {\n      const rowB = B[i];\n      if (!rowB) continue;\n      const errI = outputError[i] ?? 0;\n      for (let j = 0; j < rowB.length; j++) {\n        let grad = -errI * (predicted.latentState[j] ?? 0);\n        grad = Math.max(-clip, Math.min(clip, grad));\n        const currentB = rowB[j] ?? 0;\n        rowB[j] = currentB - lr * grad;\n      }\n      const currentBiasObs = biasObserved[i];\n      if (currentBiasObs !== undefined) {\n        biasObserved[i] = currentBiasObs - lr * Math.max(-clip, Math.min(clip, -errI));\n      }\n    }\n\n    // Gradient for A (diagonal)\n    for (let i = 0; i < A.length; i++) {\n      const latErr = latentError[i] ?? 0;\n      const prevLatent = prevState.latentState[i] ?? 0;\n      let grad = -latErr * prevLatent;\n      grad = Math.max(-clip, Math.min(clip, grad));\n      const currentA = A[i];\n      if (currentA !== undefined) {\n        A[i] = currentA - lr * grad;\n      }\n    }\n\n    // Gradient for W with L1 regularization for sparsity\n    const phiZ = prevState.latentState.map(v => Math.max(0, v));\n    for (let i = 0; i < W.length; i++) {\n      const rowW = W[i];\n      if (!rowW) continue;\n      const latErr = latentError[i] ?? 0;\n      for (let j = 0; j < rowW.length; j++) {\n        const phi = phiZ[j] ?? 0;\n        const wij = rowW[j] ?? 0;\n        let grad = -latErr * phi;\n        // Add L1 regularization gradient\n        grad += l1 * Math.sign(wij);\n        grad = Math.max(-clip, Math.min(clip, grad));\n        rowW[j] = wij - lr * grad;\n      }\n      const currentBiasLat = biasLatent[i];\n      if (currentBiasLat !== undefined) {\n        biasLatent[i] = currentBiasLat - lr * Math.max(-clip, Math.min(clip, -latErr));\n      }\n    }\n  }\n\n  private approximateMaxEigenvalue(W: number[][]): number {\n    // Power iteration for largest eigenvalue\n    const n = W.length;\n    let v = Array(n).fill(1 / Math.sqrt(n));\n\n    for (let iter = 0; iter < 20; iter++) {\n      const Av = this.matVec(W, v);\n      const norm = Math.sqrt(Av.reduce((sum, x) => sum + x * x, 0));\n      if (norm < 1e-10) return 0;\n      v = Av.map(x => x / norm);\n    }\n\n    const Av = this.matVec(W, v);\n    return Av.reduce((sum, x, i) => sum + x * v[i], 0);\n  }\n\n  // ============================================================================\n  // BPTT SUPPORT METHODS (for PLRNNTrainer)\n  // ============================================================================\n\n  /**\n   * Get latent dimension\n   */\n  getLatentDim(): number {\n    return this.config.latentDim;\n  }\n\n  /**\n   * Get config\n   */\n  getConfig(): IPLRNNConfig {\n    return { ...this.config };\n  }\n\n  /**\n   * Compute gradients for a single timestep (for BPTT)\n   * Returns gradients for A, W, B, biasLatent, biasObserved\n   */\n  computeStepGradients(\n    prevState: IPLRNNState,\n    currentState: IPLRNNState,\n    target: number[],\n    outputError?: number[]\n  ): {\n    dA: number[];\n    dW: number[][];\n    dB: number[][];\n    dBiasLatent: number[];\n    dBiasObserved: number[];\n    latentError: number[];\n  } {\n    if (!this.weights) {\n      throw new Error('PLRNNEngine not initialized');\n    }\n\n    const { W, B } = this.weights;\n    const n = this.config.latentDim;\n\n    // Output error: (prediction - target)\n    const obsError = outputError ?? currentState.observedState.map(\n      (pred, i) => pred - (target[i] ?? 0)\n    );\n\n    // Gradients for B: dL/dB = obsError * z^T\n    const dB: number[][] = [];\n    for (let i = 0; i < n; i++) {\n      const row: number[] = [];\n      for (let j = 0; j < n; j++) {\n        row[j] = (obsError[i] ?? 0) * (currentState.latentState[j] ?? 0);\n      }\n      dB[i] = row;\n    }\n\n    // Gradient for biasObserved: dL/d_biasObs = obsError\n    const dBiasObserved = [...obsError];\n\n    // Backprop through B: latent error = B^T * obsError\n    const latentError: number[] = [];\n    for (let j = 0; j < n; j++) {\n      let sum = 0;\n      for (let i = 0; i < n; i++) {\n        const bRow = B[i];\n        if (bRow) {\n          sum += (bRow[j] ?? 0) * (obsError[i] ?? 0);\n        }\n      }\n      latentError[j] = sum;\n    }\n\n    // ReLU activations: phi(z) = max(0, z)\n    const phiZ = prevState.latentState.map(v => Math.max(0, v));\n\n    // ReLU derivative: 1 if z > 0, else 0\n    const phiDerivative = prevState.latentState.map(v => v > 0 ? 1 : 0);\n\n    // Gradient for A (diagonal): dL/dA_i = latentError_i * z_{t-1,i}\n    const dA: number[] = [];\n    for (let i = 0; i < n; i++) {\n      dA[i] = (latentError[i] ?? 0) * (prevState.latentState[i] ?? 0);\n    }\n\n    // Gradient for W: dL/dW_ij = latentError_i * phi(z_{t-1})_j\n    const dW: number[][] = [];\n    for (let i = 0; i < n; i++) {\n      const row: number[] = [];\n      for (let j = 0; j < n; j++) {\n        row[j] = (latentError[i] ?? 0) * (phiZ[j] ?? 0);\n      }\n      dW[i] = row;\n    }\n\n    // Gradient for biasLatent: dL/d_biasLat = latentError\n    const dBiasLatent = [...latentError];\n\n    // Propagate error through W and ReLU for next backward step\n    // delta_{t-1} = A * delta_t + (W^T * delta_t) * phi'(z_{t-1})\n    const wTransposeError: number[] = [];\n    for (let j = 0; j < n; j++) {\n      let sum = 0;\n      for (let i = 0; i < n; i++) {\n        const wRow = W[i];\n        if (wRow) {\n          sum += (wRow[j] ?? 0) * (latentError[i] ?? 0);\n        }\n      }\n      wTransposeError[j] = sum * (phiDerivative[j] ?? 0);\n    }\n\n    // Combined error to propagate: A * delta + W^T * delta * phi'\n    const propagatedError = latentError.map((ae, i) => {\n      const aVal = this.weights!.A[i] ?? 0.9;\n      return aVal * ae + (wTransposeError[i] ?? 0);\n    });\n\n    return {\n      dA,\n      dW,\n      dB,\n      dBiasLatent,\n      dBiasObserved,\n      latentError: propagatedError,\n    };\n  }\n\n  /**\n   * Apply accumulated gradients using Adam optimizer\n   */\n  applyGradients(\n    gradients: {\n      dA: number[];\n      dW: number[][];\n      dB: number[][];\n      dBiasLatent: number[];\n      dBiasObserved: number[];\n    },\n    learningRate: number,\n    l1Reg: number = 0.01,\n    l2Reg: number = 0.0001,\n    gradClip: number = 1.0\n  ): void {\n    if (!this.weights) {\n      throw new Error('PLRNNEngine not initialized');\n    }\n\n    const { A, W, B, biasLatent, biasObserved } = this.weights;\n    const n = this.config.latentDim;\n\n    // Initialize Adam state if needed\n    if (!this.adamState) {\n      this.adamState = {\n        m: {},\n        v: {},\n        t: 0,\n      };\n    }\n\n    this.adamState.t += 1;\n    const beta1 = 0.9;\n    const beta2 = 0.999;\n    const epsilon = 1e-8;\n    const t = this.adamState.t;\n\n    // Bias correction\n    const biasCorrection1 = 1 - Math.pow(beta1, t);\n    const biasCorrection2 = 1 - Math.pow(beta2, t);\n\n    // Helper: clip gradient\n    const clip = (g: number): number => Math.max(-gradClip, Math.min(gradClip, g));\n\n    // Update A (diagonal)\n    if (!this.adamState.m['A']) {\n      this.adamState.m['A'] = [Array(n).fill(0)];\n      this.adamState.v['A'] = [Array(n).fill(0)];\n    }\n    for (let i = 0; i < n; i++) {\n      let grad = gradients.dA[i] ?? 0;\n      grad += l2Reg * (A[i] ?? 0); // L2 regularization\n      grad = clip(grad);\n\n      const mA = this.adamState.m['A']![0]!;\n      const vA = this.adamState.v['A']![0]!;\n\n      mA[i] = beta1 * (mA[i] ?? 0) + (1 - beta1) * grad;\n      vA[i] = beta2 * (vA[i] ?? 0) + (1 - beta2) * grad * grad;\n\n      const mHat = mA[i]! / biasCorrection1;\n      const vHat = vA[i]! / biasCorrection2;\n\n      A[i] = (A[i] ?? 0.9) - learningRate * mHat / (Math.sqrt(vHat) + epsilon);\n    }\n\n    // Update W\n    if (!this.adamState.m['W']) {\n      this.adamState.m['W'] = Array(n).fill(null).map(() => Array(n).fill(0));\n      this.adamState.v['W'] = Array(n).fill(null).map(() => Array(n).fill(0));\n    }\n    for (let i = 0; i < n; i++) {\n      const wRow = W[i];\n      const dWRow = gradients.dW[i];\n      if (!wRow || !dWRow) continue;\n\n      for (let j = 0; j < n; j++) {\n        let grad = dWRow[j] ?? 0;\n        const wij = wRow[j] ?? 0;\n        grad += l1Reg * Math.sign(wij); // L1 regularization\n        grad += l2Reg * wij; // L2 regularization\n        grad = clip(grad);\n\n        const mW = this.adamState.m['W']! as number[][];\n        const vW = this.adamState.v['W']! as number[][];\n\n        mW[i]![j] = beta1 * (mW[i]![j] ?? 0) + (1 - beta1) * grad;\n        vW[i]![j] = beta2 * (vW[i]![j] ?? 0) + (1 - beta2) * grad * grad;\n\n        const mHat = mW[i]![j]! / biasCorrection1;\n        const vHat = vW[i]![j]! / biasCorrection2;\n\n        wRow[j] = wij - learningRate * mHat / (Math.sqrt(vHat) + epsilon);\n      }\n    }\n\n    // Update B\n    if (!this.adamState.m['B']) {\n      this.adamState.m['B'] = Array(n).fill(null).map(() => Array(n).fill(0));\n      this.adamState.v['B'] = Array(n).fill(null).map(() => Array(n).fill(0));\n    }\n    for (let i = 0; i < n; i++) {\n      const bRow = B[i];\n      const dBRow = gradients.dB[i];\n      if (!bRow || !dBRow) continue;\n\n      for (let j = 0; j < n; j++) {\n        let grad = dBRow[j] ?? 0;\n        grad += l2Reg * (bRow[j] ?? 0);\n        grad = clip(grad);\n\n        const mB = this.adamState.m['B']! as number[][];\n        const vB = this.adamState.v['B']! as number[][];\n\n        mB[i]![j] = beta1 * (mB[i]![j] ?? 0) + (1 - beta1) * grad;\n        vB[i]![j] = beta2 * (vB[i]![j] ?? 0) + (1 - beta2) * grad * grad;\n\n        const mHat = mB[i]![j]! / biasCorrection1;\n        const vHat = vB[i]![j]! / biasCorrection2;\n\n        bRow[j] = (bRow[j] ?? 0) - learningRate * mHat / (Math.sqrt(vHat) + epsilon);\n      }\n    }\n\n    // Update biases\n    if (!this.adamState.m['biasLatent']) {\n      this.adamState.m['biasLatent'] = [Array(n).fill(0)];\n      this.adamState.v['biasLatent'] = [Array(n).fill(0)];\n    }\n    for (let i = 0; i < n; i++) {\n      let grad = clip(gradients.dBiasLatent[i] ?? 0);\n\n      const mBL = this.adamState.m['biasLatent']![0]!;\n      const vBL = this.adamState.v['biasLatent']![0]!;\n\n      mBL[i] = beta1 * (mBL[i] ?? 0) + (1 - beta1) * grad;\n      vBL[i] = beta2 * (vBL[i] ?? 0) + (1 - beta2) * grad * grad;\n\n      const mHat = mBL[i]! / biasCorrection1;\n      const vHat = vBL[i]! / biasCorrection2;\n\n      biasLatent[i] = (biasLatent[i] ?? 0) - learningRate * mHat / (Math.sqrt(vHat) + epsilon);\n    }\n\n    if (!this.adamState.m['biasObserved']) {\n      this.adamState.m['biasObserved'] = [Array(n).fill(0)];\n      this.adamState.v['biasObserved'] = [Array(n).fill(0)];\n    }\n    for (let i = 0; i < n; i++) {\n      let grad = clip(gradients.dBiasObserved[i] ?? 0);\n\n      const mBO = this.adamState.m['biasObserved']![0]!;\n      const vBO = this.adamState.v['biasObserved']![0]!;\n\n      mBO[i] = beta1 * (mBO[i] ?? 0) + (1 - beta1) * grad;\n      vBO[i] = beta2 * (vBO[i] ?? 0) + (1 - beta2) * grad * grad;\n\n      const mHat = mBO[i]! / biasCorrection1;\n      const vHat = vBO[i]! / biasCorrection2;\n\n      biasObserved[i] = (biasObserved[i] ?? 0) - learningRate * mHat / (Math.sqrt(vHat) + epsilon);\n    }\n  }\n\n  /**\n   * Reset Adam optimizer state (for new training run)\n   */\n  resetAdamState(): void {\n    this.adamState = null;\n  }\n\n  /**\n   * Create a state from observation values\n   */\n  createState(observation: number[], timestamp?: Date): IPLRNNState {\n    const state = this.initializeState(observation);\n    if (timestamp) {\n      state.timestamp = timestamp;\n    }\n    return state;\n  }\n}\n\n/**\n * Factory function\n */\nexport function createPLRNNEngine(config?: Partial<IPLRNNConfig>): IPLRNNEngine {\n  const engine = new PLRNNEngine(config);\n  engine.initialize(config);\n  return engine;\n}\n\nexport { DEFAULT_PLRNN_CONFIG };\n","/**\n *  VOICE INPUT ADAPTER INTERFACES\n * ==================================\n * Acoustic Feature Extraction & Multimodal Fusion\n *\n * Scientific Foundation (2025 Research):\n * - JMIR Mental Health 2025: \"Speech Emotion Recognition in Mental Health: Systematic Review\"\n * - Wav2Vec2 + NCDEs: 74% accuracy in emotion recognition\n * - Voice biomarkers: F0, jitter, shimmer for depression detection\n * - Prosody analysis: Pitch contour, speech rate, pauses\n *\n * Key Features:\n * - Acoustic feature extraction (F0, jitter, shimmer, HNR, MFCCs)\n * - Prosody  Emotional state mapping (VAD)\n * - Multimodal fusion (text + voice)\n * - Whisper API integration for transcription\n * - Real-time and offline processing\n *\n *   \" \", 2025\n */\n\n/**\n * Voice Input Configuration\n */\nexport interface IVoiceAdapterConfig {\n  /** Sample rate for audio processing (Hz) */\n  sampleRate: number;\n\n  /** Frame size for feature extraction (ms) */\n  frameSizeMs: number;\n\n  /** Hop size for overlapping frames (ms) */\n  hopSizeMs: number;\n\n  /** Number of MFCC coefficients */\n  numMfcc: number;\n\n  /** Minimum F0 for pitch detection (Hz) */\n  minF0: number;\n\n  /** Maximum F0 for pitch detection (Hz) */\n  maxF0: number;\n\n  /** Enable Whisper API for transcription */\n  enableWhisper: boolean;\n\n  /** Whisper API endpoint */\n  whisperEndpoint?: string;\n\n  /** Whisper API key */\n  whisperApiKey?: string;\n\n  /** Text-voice fusion strategy */\n  fusionStrategy: 'early' | 'late' | 'hybrid';\n\n  /** Fusion weights [text, voice] */\n  fusionWeights: [number, number];\n\n  /** Enable real-time processing */\n  realtime: boolean;\n\n  /** Buffer size for real-time (frames) */\n  realtimeBufferSize: number;\n\n  /** Language for speech recognition */\n  language: string;\n}\n\n/**\n * Default Voice Adapter Configuration\n */\nexport const DEFAULT_VOICE_CONFIG: IVoiceAdapterConfig = {\n  sampleRate: 16000,\n  frameSizeMs: 25,\n  hopSizeMs: 10,\n  numMfcc: 13,\n  minF0: 75, // Human voice range\n  maxF0: 500,\n  enableWhisper: true,\n  fusionStrategy: 'late',\n  fusionWeights: [0.6, 0.4], // Text slightly more important\n  realtime: false,\n  realtimeBufferSize: 100,\n  language: 'ru',\n};\n\n/**\n * Acoustic Features extracted from voice\n */\nexport interface IAcousticFeatures {\n  /** Fundamental frequency (pitch) statistics */\n  pitch: {\n    /** Mean F0 in Hz */\n    meanF0: number;\n    /** Standard deviation of F0 */\n    stdF0: number;\n    /** Minimum F0 */\n    minF0: number;\n    /** Maximum F0 */\n    maxF0: number;\n    /** F0 range */\n    rangeF0: number;\n    /** Pitch contour (F0 values per frame) */\n    contour: number[];\n    /** Voiced frames ratio */\n    voicedRatio: number;\n  };\n\n  /** Voice quality measures */\n  voiceQuality: {\n    /** Jitter (pitch perturbation) - % */\n    jitterLocal: number;\n    /** Shimmer (amplitude perturbation) - % */\n    shimmerLocal: number;\n    /** Harmonics-to-Noise Ratio (dB) */\n    hnr: number;\n    /** Noise-to-Harmonics Ratio */\n    nhr: number;\n  };\n\n  /** Temporal features */\n  temporal: {\n    /** Speech rate (syllables per second) */\n    speechRate: number;\n    /** Articulation rate */\n    articulationRate: number;\n    /** Total duration (seconds) */\n    duration: number;\n    /** Speaking time (excluding pauses) */\n    speakingTime: number;\n    /** Pause duration total */\n    pauseDuration: number;\n    /** Number of pauses */\n    pauseCount: number;\n    /** Mean pause duration */\n    meanPauseDuration: number;\n  };\n\n  /** Spectral features */\n  spectral: {\n    /** MFCC coefficients (mean per coefficient) */\n    mfccMean: number[];\n    /** MFCC standard deviation */\n    mfccStd: number[];\n    /** Spectral centroid mean */\n    spectralCentroid: number;\n    /** Spectral flux (change rate) */\n    spectralFlux: number;\n    /** Spectral rolloff frequency */\n    spectralRolloff: number;\n  };\n\n  /** Energy features */\n  energy: {\n    /** Mean energy (dB) */\n    meanEnergy: number;\n    /** Energy standard deviation */\n    stdEnergy: number;\n    /** Energy range */\n    rangeEnergy: number;\n    /** Energy contour */\n    contour: number[];\n  };\n\n  /** Quality metrics */\n  quality: {\n    /** Overall signal quality (0-1) */\n    signalQuality: number;\n    /** Background noise level (dB) */\n    noiseLevel: number;\n    /** Clipping ratio */\n    clippingRatio: number;\n    /** Silence ratio */\n    silenceRatio: number;\n  };\n}\n\n/**\n * Prosody features (suprasegmental)\n */\nexport interface IProsodyFeatures {\n  /** Pitch pattern type */\n  pitchPattern: 'monotone' | 'varied' | 'rising' | 'falling' | 'irregular';\n\n  /** Speech rhythm pattern */\n  rhythmPattern: 'regular' | 'irregular' | 'hesitant' | 'rushed';\n\n  /** Stress patterns (emphatic words) */\n  stressPatterns: Array<{\n    word: string;\n    position: number;\n    strength: number;\n  }>;\n\n  /** Intonation contour type */\n  intonationType: 'declarative' | 'interrogative' | 'exclamatory' | 'neutral';\n\n  /** Emotional prosody indicators */\n  emotionalIndicators: {\n    /** Higher pitch = more arousal */\n    arousalLevel: number;\n    /** Pitch variability = emotional expressiveness */\n    expressiveness: number;\n    /** Slow/fast rate = depressed/anxious */\n    energyLevel: number;\n    /** Voice tremor indicator */\n    tremorIndicator: number;\n  };\n\n  /** Pause patterns */\n  pausePatterns: {\n    /** Long pauses before words (hesitation) */\n    hesitationMarkers: number;\n    /** Filled pauses (um, uh) count */\n    filledPauses: number;\n    /** Pause pattern suggests cognitive load */\n    cognitiveLoadIndicator: number;\n  };\n}\n\n/**\n * Voice-based emotional state estimate\n */\nexport interface IVoiceEmotionEstimate {\n  /** Primary emotion detected */\n  primaryEmotion: string;\n\n  /** Emotion probabilities */\n  emotionProbabilities: Map<string, number>;\n\n  /** VAD (Valence-Arousal-Dominance) estimate */\n  vad: {\n    valence: number; // -1 to 1\n    arousal: number; // -1 to 1\n    dominance: number; // 0 to 1\n    confidence: number;\n  };\n\n  /** Depression indicators */\n  depressionIndicators: {\n    /** Flat affect (low pitch variation) */\n    flatAffect: number;\n    /** Psychomotor retardation (slow speech) */\n    psychomotorRetardation: number;\n    /** Low energy voice */\n    lowEnergy: number;\n    /** Overall depression score (0-1) */\n    score: number;\n    /** Confidence in assessment */\n    confidence: number;\n  };\n\n  /** Anxiety indicators */\n  anxietyIndicators: {\n    /** High pitch */\n    highPitch: number;\n    /** Fast speech rate */\n    fastSpeech: number;\n    /** Voice tremor */\n    tremor: number;\n    /** Hesitation frequency */\n    hesitation: number;\n    /** Overall anxiety score (0-1) */\n    score: number;\n    /** Confidence */\n    confidence: number;\n  };\n\n  /** Stress indicators */\n  stressIndicators: {\n    /** Increased jitter/shimmer */\n    voiceInstability: number;\n    /** Reduced HNR */\n    reducedClarity: number;\n    /** Irregular breathing patterns */\n    breathingIrregularity: number;\n    /** Overall stress score (0-1) */\n    score: number;\n    /** Confidence */\n    confidence: number;\n  };\n}\n\n/**\n * Text analysis result (from transcription)\n */\nexport interface ITextAnalysis {\n  /** Transcribed text */\n  text: string;\n\n  /** Language detected */\n  language: string;\n\n  /** Word count */\n  wordCount: number;\n\n  /** Sentiment score (-1 to 1) */\n  sentiment: number;\n\n  /** Key phrases extracted */\n  keyPhrases: string[];\n\n  /** Detected emotions from text */\n  textEmotions: Map<string, number>;\n\n  /** Cognitive distortions detected */\n  cognitiveDistortions: Array<{\n    type: string;\n    phrase: string;\n    confidence: number;\n  }>;\n\n  /** Risk keywords detected */\n  riskKeywords: Array<{\n    keyword: string;\n    category: string;\n    severity: number;\n  }>;\n\n  /** Transcription confidence */\n  confidence: number;\n}\n\n/**\n * Multimodal fusion result\n */\nexport interface IMultimodalFusion {\n  /** Fused VAD estimate */\n  vad: {\n    valence: number;\n    arousal: number;\n    dominance: number;\n    confidence: number;\n  };\n\n  /** Fused emotion probabilities */\n  emotionProbabilities: Map<string, number>;\n\n  /** Primary emotion after fusion */\n  primaryEmotion: string;\n\n  /** Component contributions */\n  contributions: {\n    text: number;\n    voice: number;\n  };\n\n  /** Agreement between modalities */\n  modalityAgreement: number;\n\n  /** Discrepancy analysis (when text and voice disagree) */\n  discrepancy?: {\n    type: 'suppression' | 'masking' | 'amplification' | 'none';\n    textEmotion: string;\n    voiceEmotion: string;\n    interpretation: string;\n  };\n\n  /** Overall confidence after fusion */\n  confidence: number;\n\n  /** Recommendations based on analysis */\n  recommendations: string[];\n}\n\n/**\n * Voice processing result\n */\nexport interface IVoiceProcessingResult {\n  /** Processing ID */\n  id: string;\n\n  /** Timestamp */\n  timestamp: Date;\n\n  /** Audio duration (seconds) */\n  duration: number;\n\n  /** Acoustic features */\n  acousticFeatures: IAcousticFeatures;\n\n  /** Prosody features */\n  prosodyFeatures: IProsodyFeatures;\n\n  /** Voice-based emotion estimate */\n  voiceEmotion: IVoiceEmotionEstimate;\n\n  /** Text analysis (if transcription enabled) */\n  textAnalysis?: ITextAnalysis;\n\n  /** Multimodal fusion result */\n  fusion?: IMultimodalFusion;\n\n  /** Processing quality metrics */\n  quality: {\n    audioQuality: number;\n    featureReliability: number;\n    overallConfidence: number;\n  };\n}\n\n/**\n * Voice Input Adapter Interface\n */\nexport interface IVoiceInputAdapter {\n  /**\n   * Initialize adapter\n   */\n  initialize(config?: Partial<IVoiceAdapterConfig>): Promise<void>;\n\n  /**\n   * Process audio buffer\n   */\n  processAudio(\n    audioBuffer: Float32Array,\n    sampleRate?: number\n  ): Promise<IVoiceProcessingResult>;\n\n  /**\n   * Process audio file\n   */\n  processFile(\n    filePath: string\n  ): Promise<IVoiceProcessingResult>;\n\n  /**\n   * Process with transcription\n   */\n  processWithTranscription(\n    audioBuffer: Float32Array,\n    existingTranscript?: string\n  ): Promise<IVoiceProcessingResult>;\n\n  /**\n   * Extract acoustic features only\n   */\n  extractAcousticFeatures(\n    audioBuffer: Float32Array\n  ): IAcousticFeatures;\n\n  /**\n   * Extract prosody features\n   */\n  extractProsodyFeatures(\n    audioBuffer: Float32Array,\n    acousticFeatures?: IAcousticFeatures\n  ): IProsodyFeatures;\n\n  /**\n   * Map acoustic features to emotional state\n   */\n  mapToEmotion(\n    acoustic: IAcousticFeatures,\n    prosody: IProsodyFeatures\n  ): IVoiceEmotionEstimate;\n\n  /**\n   * Fuse text and voice modalities\n   */\n  fuseModalities(\n    voiceEmotion: IVoiceEmotionEstimate,\n    textAnalysis: ITextAnalysis\n  ): IMultimodalFusion;\n\n  /**\n   * Transcribe audio using Whisper API\n   */\n  transcribe(\n    audioBuffer: Float32Array\n  ): Promise<ITextAnalysis>;\n\n  /**\n   * Analyze text for emotions and risk\n   */\n  analyzeText(text: string): ITextAnalysis;\n\n  /**\n   * Real-time processing: add audio chunk\n   */\n  addRealtimeChunk(chunk: Float32Array): void;\n\n  /**\n   * Real-time processing: get current estimate\n   */\n  getRealtimeEstimate(): IVoiceEmotionEstimate | null;\n\n  /**\n   * Convert to state vector observation\n   */\n  toStateObservation(result: IVoiceProcessingResult): number[];\n\n  /**\n   * Get configuration\n   */\n  getConfig(): IVoiceAdapterConfig;\n\n  /**\n   * Update fusion weights based on historical accuracy\n   */\n  adaptFusionWeights(\n    predictions: IMultimodalFusion[],\n    actuals: IVoiceEmotionEstimate[]\n  ): void;\n}\n\n/**\n * Factory type\n */\nexport type VoiceInputAdapterFactory = (\n  config?: Partial<IVoiceAdapterConfig>\n) => IVoiceInputAdapter;\n","/**\n *  VOICE INPUT ADAPTER IMPLEMENTATION\n * =====================================\n * Acoustic Feature Extraction & Multimodal Fusion\n *\n * Scientific Foundation (2025 Research):\n * - Wav2Vec2.0 + NCDEs: 74.18% accuracy (PLOS ONE 2025)\n * - F0, jitter, shimmer: Key biomarkers for depression\n * - Parselmouth/Praat algorithms for voice quality\n * - Late fusion for text + voice (best performance)\n *\n * Features:\n * - Frame-based acoustic analysis\n * - Pitch detection (autocorrelation method)\n * - MFCC extraction (Mel-frequency cepstral coefficients)\n * - Voice quality metrics (jitter, shimmer, HNR)\n * - Prosody-to-emotion mapping\n * - Text-voice multimodal fusion\n *\n *   \" \", 2025\n */\n\nimport {\n  type IVoiceInputAdapter,\n  type IVoiceAdapterConfig,\n  type IVoiceProcessingResult,\n  type IAcousticFeatures,\n  type IProsodyFeatures,\n  type IVoiceEmotionEstimate,\n  type ITextAnalysis,\n  type IMultimodalFusion,\n  DEFAULT_VOICE_CONFIG,\n} from './interfaces/IVoiceAdapter';\n\n// Future: Emotion mappings for prosody features\n// Based on research: Scherer (2003), Russell circumplex model\n// Reserved for future emotion-to-prosody pattern matching\n// const EMOTION_PROSODY_MAPPINGS = {\n//   // High arousal emotions\n//   anger: { pitchHigh: true, pitchVar: 'high', rateHigh: true, energyHigh: true },\n//   fear: { pitchHigh: true, pitchVar: 'high', rateHigh: true, energyMid: true },\n//   joy: { pitchHigh: true, pitchVar: 'high', rateMid: true, energyHigh: true },\n//   surprise: { pitchHigh: true, pitchVar: 'very_high', rateHigh: true },\n//   // Low arousal emotions\n//   sadness: { pitchLow: true, pitchVar: 'low', rateLow: true, energyLow: true },\n//   depression: { pitchLow: true, pitchVar: 'very_low', rateLow: true, energyLow: true, monotone: true },\n//   fatigue: { pitchLow: true, pitchVar: 'low', rateLow: true, energyLow: true },\n//   // Mixed\n//   anxiety: { pitchHigh: true, pitchVar: 'irregular', rateHigh: true, hesitation: true, tremor: true },\n//   stress: { pitchMid: true, pitchVar: 'irregular', jitterHigh: true, shimmerHigh: true },\n//   neutral: { pitchMid: true, pitchVar: 'mid', rateMid: true, energyMid: true },\n// };\n\n/**\n * Risk keywords for text analysis\n */\nconst RISK_KEYWORDS = {\n  suicidal: ['', '', ' ', '  ', '', ' '],\n  self_harm: ['', '', ' ', ' '],\n  crisis: ['  ', '', ' ', '', ''],\n  substance: ['', '', '', '', ''],\n};\n\n/**\n * Cognitive distortion patterns\n */\nconst DISTORTION_PATTERNS = [\n  { type: 'catastrophizing', patterns: ['', '', ' ', ' '] },\n  { type: 'black_and_white', patterns: ['', '', '', '', ''] },\n  { type: 'mind_reading', patterns: [' ', ' ', ' '] },\n  { type: 'fortune_telling', patterns: [' ', '  ', ' '] },\n  { type: 'should_statements', patterns: ['', '', ' '] },\n];\n\n/**\n * Voice Input Adapter Implementation\n */\nexport class VoiceInputAdapter implements IVoiceInputAdapter {\n  private config: IVoiceAdapterConfig;\n  private initialized = false;\n\n  // Real-time processing state\n  private realtimeBuffer: Float32Array[] = [];\n  private realtimeEstimate: IVoiceEmotionEstimate | null = null;\n\n  // Processing counter\n  private processingCounter = 0;\n\n  constructor(config?: Partial<IVoiceAdapterConfig>) {\n    this.config = { ...DEFAULT_VOICE_CONFIG, ...config };\n  }\n\n  // ============================================================================\n  // INITIALIZATION\n  // ============================================================================\n\n  async initialize(config?: Partial<IVoiceAdapterConfig>): Promise<void> {\n    if (config) {\n      this.config = { ...this.config, ...config };\n    }\n\n    // Validate configuration\n    if (this.config.sampleRate < 8000 || this.config.sampleRate > 48000) {\n      throw new Error('Sample rate must be between 8000 and 48000 Hz');\n    }\n\n    this.initialized = true;\n  }\n\n  // ============================================================================\n  // MAIN PROCESSING\n  // ============================================================================\n\n  async processAudio(\n    audioBuffer: Float32Array,\n    sampleRate?: number\n  ): Promise<IVoiceProcessingResult> {\n    if (!this.initialized) {\n      await this.initialize();\n    }\n\n    const sr = sampleRate || this.config.sampleRate;\n    const processingId = `voice_${Date.now()}_${++this.processingCounter}`;\n\n    // Resample if necessary\n    const resampled = sr !== this.config.sampleRate\n      ? this.resample(audioBuffer, sr, this.config.sampleRate)\n      : audioBuffer;\n\n    // Extract features\n    const acousticFeatures = this.extractAcousticFeatures(resampled);\n    const prosodyFeatures = this.extractProsodyFeatures(resampled, acousticFeatures);\n\n    // Map to emotion\n    const voiceEmotion = this.mapToEmotion(acousticFeatures, prosodyFeatures);\n\n    // Calculate quality metrics\n    const quality = {\n      audioQuality: acousticFeatures.quality.signalQuality,\n      featureReliability: this.calculateFeatureReliability(acousticFeatures),\n      overallConfidence: voiceEmotion.vad.confidence,\n    };\n\n    return {\n      id: processingId,\n      timestamp: new Date(),\n      duration: resampled.length / this.config.sampleRate,\n      acousticFeatures,\n      prosodyFeatures,\n      voiceEmotion,\n      quality,\n    };\n  }\n\n  async processFile(_filePath: string): Promise<IVoiceProcessingResult> {\n    // In a real implementation, this would read the file\n    // For now, throw an error as we can't access files directly\n    throw new Error('File processing not implemented. Use processAudio with audio buffer.');\n  }\n\n  async processWithTranscription(\n    audioBuffer: Float32Array,\n    existingTranscript?: string\n  ): Promise<IVoiceProcessingResult> {\n    // Process audio\n    const result = await this.processAudio(audioBuffer);\n\n    // Get or create transcription\n    let textAnalysis: ITextAnalysis;\n\n    if (existingTranscript) {\n      textAnalysis = this.analyzeText(existingTranscript);\n    } else if (this.config.enableWhisper) {\n      textAnalysis = await this.transcribe(audioBuffer);\n    } else {\n      // No transcription available\n      return result;\n    }\n\n    // Fuse modalities\n    const fusion = this.fuseModalities(result.voiceEmotion, textAnalysis);\n\n    return {\n      ...result,\n      textAnalysis,\n      fusion,\n    };\n  }\n\n  // ============================================================================\n  // ACOUSTIC FEATURE EXTRACTION\n  // ============================================================================\n\n  extractAcousticFeatures(audioBuffer: Float32Array): IAcousticFeatures {\n    const sr = this.config.sampleRate;\n    const frameSamples = Math.floor(this.config.frameSizeMs * sr / 1000);\n    const hopSamples = Math.floor(this.config.hopSizeMs * sr / 1000);\n\n    // Pre-emphasis\n    const preemphasized = this.preEmphasis(audioBuffer, 0.97);\n\n    // Frame the signal\n    const frames = this.frameSignal(preemphasized, frameSamples, hopSamples);\n\n    // Apply Hamming window\n    const windowedFrames = frames.map(frame => this.hammingWindow(frame));\n\n    // Extract pitch (F0) using autocorrelation\n    const pitchContour = this.extractPitch(windowedFrames, sr);\n    const pitchStats = this.calculatePitchStats(pitchContour);\n\n    // Calculate energy per frame\n    const energyContour = windowedFrames.map(frame =>\n      10 * Math.log10(frame.reduce((sum, s) => sum + s * s, 0) / frame.length + 1e-10)\n    );\n    const energyStats = this.calculateStats(energyContour);\n\n    // Extract MFCCs\n    const mfccs = this.extractMFCCs(windowedFrames, sr);\n    const firstFrame = mfccs[0];\n    const mfccMean = firstFrame\n      ? firstFrame.map((_, i) =>\n          mfccs.reduce((sum, frame) => sum + (frame[i] ?? 0), 0) / mfccs.length\n        )\n      : [];\n    const mfccStd = firstFrame\n      ? firstFrame.map((_, i) => {\n          const mean = mfccMean[i] ?? 0;\n          return Math.sqrt(\n            mfccs.reduce((sum, frame) => sum + Math.pow((frame[i] ?? 0) - mean, 2), 0) / mfccs.length\n          );\n        })\n      : [];\n\n    // Voice quality measures\n    const voiceQuality = this.calculateVoiceQuality(windowedFrames, pitchContour, sr);\n\n    // Temporal features\n    const temporal = this.calculateTemporalFeatures(audioBuffer, frames, pitchContour, sr);\n\n    // Spectral features\n    const spectral = this.calculateSpectralFeatures(windowedFrames, sr, mfccMean, mfccStd);\n\n    // Quality assessment\n    const quality = this.assessAudioQuality(audioBuffer, energyContour);\n\n    return {\n      pitch: {\n        ...pitchStats,\n        contour: pitchContour,\n      },\n      voiceQuality,\n      temporal,\n      spectral,\n      energy: {\n        ...energyStats,\n        contour: energyContour,\n      },\n      quality,\n    };\n  }\n\n  // ============================================================================\n  // PROSODY EXTRACTION\n  // ============================================================================\n\n  extractProsodyFeatures(\n    audioBuffer: Float32Array,\n    acousticFeatures?: IAcousticFeatures\n  ): IProsodyFeatures {\n    const features = acousticFeatures || this.extractAcousticFeatures(audioBuffer);\n\n    // Analyze pitch pattern\n    const pitchPattern = this.analyzePitchPattern(features.pitch);\n\n    // Analyze rhythm\n    const rhythmPattern = this.analyzeRhythmPattern(features);\n\n    // Detect stress patterns (simplified)\n    const stressPatterns: IProsodyFeatures['stressPatterns'] = [];\n\n    // Determine intonation type\n    const intonationType = this.determineIntonationType(features.pitch);\n\n    // Calculate emotional prosody indicators\n    const emotionalIndicators = {\n      arousalLevel: this.calculateArousalFromProsody(features),\n      expressiveness: features.pitch.stdF0 / (features.pitch.meanF0 || 1),\n      energyLevel: (features.energy.meanEnergy + 60) / 60, // Normalize dB\n      tremorIndicator: features.voiceQuality.jitterLocal / 5, // Normalize\n    };\n\n    // Analyze pause patterns\n    const pausePatterns = {\n      hesitationMarkers: this.countHesitationMarkers(features),\n      filledPauses: 0, // Would need transcription\n      cognitiveLoadIndicator: features.temporal.meanPauseDuration / 0.5,\n    };\n\n    return {\n      pitchPattern,\n      rhythmPattern,\n      stressPatterns,\n      intonationType,\n      emotionalIndicators,\n      pausePatterns,\n    };\n  }\n\n  // ============================================================================\n  // EMOTION MAPPING\n  // ============================================================================\n\n  mapToEmotion(\n    acoustic: IAcousticFeatures,\n    prosody: IProsodyFeatures\n  ): IVoiceEmotionEstimate {\n    // Calculate emotion probabilities based on prosodic features\n    const emotionProbabilities = this.calculateEmotionProbabilities(acoustic, prosody);\n\n    // Find primary emotion\n    let primaryEmotion = 'neutral';\n    let maxProb = 0;\n    emotionProbabilities.forEach((prob, emotion) => {\n      if (prob > maxProb) {\n        maxProb = prob;\n        primaryEmotion = emotion;\n      }\n    });\n\n    // Calculate VAD from acoustic features\n    const vad = this.calculateVAD(acoustic, prosody);\n\n    // Calculate clinical indicators\n    const depressionIndicators = this.calculateDepressionIndicators(acoustic, prosody);\n    const anxietyIndicators = this.calculateAnxietyIndicators(acoustic, prosody);\n    const stressIndicators = this.calculateStressIndicators(acoustic, prosody);\n\n    return {\n      primaryEmotion,\n      emotionProbabilities,\n      vad,\n      depressionIndicators,\n      anxietyIndicators,\n      stressIndicators,\n    };\n  }\n\n  // ============================================================================\n  // MULTIMODAL FUSION\n  // ============================================================================\n\n  fuseModalities(\n    voiceEmotion: IVoiceEmotionEstimate,\n    textAnalysis: ITextAnalysis\n  ): IMultimodalFusion {\n    const [textWeight, voiceWeight] = this.config.fusionWeights;\n\n    // Fuse VAD\n    const textVAD = this.textSentimentToVAD(textAnalysis.sentiment, textAnalysis.textEmotions);\n    const voiceVAD = voiceEmotion.vad;\n\n    const fusedVAD = {\n      valence: textWeight * textVAD.valence + voiceWeight * voiceVAD.valence,\n      arousal: textWeight * textVAD.arousal + voiceWeight * voiceVAD.arousal,\n      dominance: textWeight * textVAD.dominance + voiceWeight * voiceVAD.dominance,\n      confidence: Math.min(textAnalysis.confidence, voiceVAD.confidence),\n    };\n\n    // Fuse emotion probabilities\n    const fusedEmotions = new Map<string, number>();\n    const allEmotions = new Set([\n      ...voiceEmotion.emotionProbabilities.keys(),\n      ...textAnalysis.textEmotions.keys(),\n    ]);\n\n    allEmotions.forEach(emotion => {\n      const voiceProb = voiceEmotion.emotionProbabilities.get(emotion) || 0;\n      const textProb = textAnalysis.textEmotions.get(emotion) || 0;\n      fusedEmotions.set(emotion, textWeight * textProb + voiceWeight * voiceProb);\n    });\n\n    // Primary emotion after fusion\n    let primaryEmotion = 'neutral';\n    let maxProb = 0;\n    fusedEmotions.forEach((prob, emotion) => {\n      if (prob > maxProb) {\n        maxProb = prob;\n        primaryEmotion = emotion;\n      }\n    });\n\n    // Check for modality discrepancy\n    const voicePrimary = voiceEmotion.primaryEmotion;\n    const textPrimary = this.getTextPrimaryEmotion(textAnalysis);\n    const agreement = this.calculateModalityAgreement(voiceEmotion, textAnalysis);\n\n    let discrepancy: IMultimodalFusion['discrepancy'];\n    if (agreement < 0.5 && voicePrimary !== textPrimary) {\n      discrepancy = this.analyzeDiscrepancy(voicePrimary, textPrimary, voiceEmotion, textAnalysis);\n    }\n\n    // Generate recommendations\n    const recommendations = this.generateRecommendations(\n      fusedVAD,\n      voiceEmotion,\n      textAnalysis,\n      discrepancy\n    );\n\n    return {\n      vad: fusedVAD,\n      emotionProbabilities: fusedEmotions,\n      primaryEmotion,\n      contributions: { text: textWeight, voice: voiceWeight },\n      modalityAgreement: agreement,\n      discrepancy,\n      confidence: fusedVAD.confidence,\n      recommendations,\n    };\n  }\n\n  // ============================================================================\n  // TRANSCRIPTION\n  // ============================================================================\n\n  async transcribe(_audioBuffer: Float32Array): Promise<ITextAnalysis> {\n    if (!this.config.enableWhisper) {\n      throw new Error('Whisper transcription not enabled');\n    }\n\n    // In production, this would call the Whisper API with _audioBuffer\n    // For now, return a placeholder that indicates transcription is needed\n    console.warn('Whisper API integration requires external service. Returning placeholder.');\n\n    return {\n      text: '[Transcription requires Whisper API integration]',\n      language: this.config.language,\n      wordCount: 0,\n      sentiment: 0,\n      keyPhrases: [],\n      textEmotions: new Map([['neutral', 1.0]]),\n      cognitiveDistortions: [],\n      riskKeywords: [],\n      confidence: 0.1,\n    };\n  }\n\n  analyzeText(text: string): ITextAnalysis {\n    const words = text.toLowerCase().split(/\\s+/).filter(w => w.length > 0);\n\n    // Simple sentiment analysis\n    const sentiment = this.calculateSimpleSentiment(text);\n\n    // Detect emotions from text\n    const textEmotions = this.detectTextEmotions(text);\n\n    // Detect cognitive distortions\n    const cognitiveDistortions = this.detectCognitiveDistortions(text);\n\n    // Detect risk keywords\n    const riskKeywords = this.detectRiskKeywords(text);\n\n    // Extract key phrases (simplified: just return longer words)\n    const keyPhrases = words.filter(w => w.length > 6).slice(0, 5);\n\n    return {\n      text,\n      language: this.config.language,\n      wordCount: words.length,\n      sentiment,\n      keyPhrases,\n      textEmotions,\n      cognitiveDistortions,\n      riskKeywords,\n      confidence: 0.7,\n    };\n  }\n\n  // ============================================================================\n  // REAL-TIME PROCESSING\n  // ============================================================================\n\n  addRealtimeChunk(chunk: Float32Array): void {\n    this.realtimeBuffer.push(chunk);\n\n    // Keep buffer size limited\n    while (this.realtimeBuffer.length > this.config.realtimeBufferSize) {\n      this.realtimeBuffer.shift();\n    }\n\n    // Update estimate if we have enough data\n    if (this.realtimeBuffer.length >= 10) {\n      const combined = this.combineBuffers(this.realtimeBuffer);\n      const acoustic = this.extractAcousticFeatures(combined);\n      const prosody = this.extractProsodyFeatures(combined, acoustic);\n      this.realtimeEstimate = this.mapToEmotion(acoustic, prosody);\n    }\n  }\n\n  getRealtimeEstimate(): IVoiceEmotionEstimate | null {\n    return this.realtimeEstimate;\n  }\n\n  // ============================================================================\n  // CONVERSION\n  // ============================================================================\n\n  toStateObservation(result: IVoiceProcessingResult): number[] {\n    const fusion = result.fusion;\n    const voice = result.voiceEmotion;\n\n    // If fusion available, use it; otherwise use voice-only\n    const vad = fusion?.vad || voice.vad;\n\n    return [\n      vad.valence, // -1 to 1\n      vad.arousal, // -1 to 1\n      vad.dominance, // 0 to 1\n      1 - voice.depressionIndicators.score, // Invert for risk dimension\n      1 - voice.stressIndicators.score, // Invert for resources dimension\n    ];\n  }\n\n  getConfig(): IVoiceAdapterConfig {\n    return { ...this.config };\n  }\n\n  adaptFusionWeights(\n    predictions: IMultimodalFusion[],\n    actuals: IVoiceEmotionEstimate[]\n  ): void {\n    if (predictions.length !== actuals.length || predictions.length < 5) {\n      return;\n    }\n\n    // Calculate error for text-weighted and voice-weighted predictions\n    let textError = 0;\n    let voiceError = 0;\n\n    for (let i = 0; i < predictions.length; i++) {\n      const pred = predictions[i];\n      const actual = actuals[i];\n\n      // Skip if either is undefined\n      if (!pred || !actual) continue;\n\n      // Error based on VAD distance\n      const vadError = Math.sqrt(\n        Math.pow(pred.vad.valence - actual.vad.valence, 2) +\n        Math.pow(pred.vad.arousal - actual.vad.arousal, 2) +\n        Math.pow(pred.vad.dominance - actual.vad.dominance, 2)\n      );\n\n      textError += vadError * pred.contributions.text;\n      voiceError += vadError * pred.contributions.voice;\n    }\n\n    // Adjust weights based on relative error\n    const totalError = textError + voiceError;\n    if (totalError > 0) {\n      const textPerformance = 1 - textError / totalError;\n      const voicePerformance = 1 - voiceError / totalError;\n\n      // Smooth update\n      const alpha = 0.1;\n      const currentTextWeight = this.config.fusionWeights[0] ?? 0.5;\n      const currentVoiceWeight = this.config.fusionWeights[1] ?? 0.5;\n      this.config.fusionWeights[0] = currentTextWeight * (1 - alpha) + textPerformance * alpha;\n      this.config.fusionWeights[1] = currentVoiceWeight * (1 - alpha) + voicePerformance * alpha;\n\n      // Normalize\n      const sum = (this.config.fusionWeights[0] ?? 0.5) + (this.config.fusionWeights[1] ?? 0.5);\n      this.config.fusionWeights[0] = (this.config.fusionWeights[0] ?? 0.5) / sum;\n      this.config.fusionWeights[1] = (this.config.fusionWeights[1] ?? 0.5) / sum;\n    }\n  }\n\n  // ============================================================================\n  // PRIVATE HELPERS: Signal Processing\n  // ============================================================================\n\n  private preEmphasis(signal: Float32Array, coef: number): Float32Array {\n    const result = new Float32Array(signal.length);\n    result[0] = signal[0] ?? 0;\n    for (let i = 1; i < signal.length; i++) {\n      result[i] = (signal[i] ?? 0) - coef * (signal[i - 1] ?? 0);\n    }\n    return result;\n  }\n\n  private frameSignal(\n    signal: Float32Array,\n    frameSize: number,\n    hopSize: number\n  ): Float32Array[] {\n    const frames: Float32Array[] = [];\n    for (let i = 0; i + frameSize <= signal.length; i += hopSize) {\n      frames.push(signal.slice(i, i + frameSize));\n    }\n    return frames;\n  }\n\n  private hammingWindow(frame: Float32Array): Float32Array {\n    const N = frame.length;\n    const result = new Float32Array(N);\n    for (let i = 0; i < N; i++) {\n      const window = 0.54 - 0.46 * Math.cos(2 * Math.PI * i / (N - 1));\n      result[i] = (frame[i] ?? 0) * window;\n    }\n    return result;\n  }\n\n  private extractPitch(frames: Float32Array[], sampleRate: number): number[] {\n    const minLag = Math.floor(sampleRate / this.config.maxF0);\n    const maxLag = Math.floor(sampleRate / this.config.minF0);\n\n    return frames.map(frame => {\n      // Autocorrelation method\n      let maxCorr = 0;\n      let bestLag = 0;\n\n      for (let lag = minLag; lag <= maxLag && lag < frame.length; lag++) {\n        let corr = 0;\n        for (let i = 0; i < frame.length - lag; i++) {\n          corr += (frame[i] ?? 0) * (frame[i + lag] ?? 0);\n        }\n\n        if (corr > maxCorr) {\n          maxCorr = corr;\n          bestLag = lag;\n        }\n      }\n\n      // Calculate F0 if correlation is strong enough\n      if (maxCorr > 0.3 * frame.reduce((sum, s) => sum + s * s, 0) && bestLag > 0) {\n        return sampleRate / bestLag;\n      }\n      return 0; // Unvoiced\n    });\n  }\n\n  private extractMFCCs(frames: Float32Array[], sampleRate: number): number[][] {\n    const numFilters = 26;\n    const numCoeffs = this.config.numMfcc;\n\n    return frames.map(frame => {\n      // Simplified MFCC: Use power spectrum\n      const fft = this.simpleFFT(frame);\n      const powerSpectrum = fft.map(c => c * c);\n\n      // Mel filterbank (simplified)\n      const melEnergies = this.melFilterbank(powerSpectrum, sampleRate, numFilters);\n\n      // Log compression\n      const logMelEnergies = melEnergies.map(e => Math.log(e + 1e-10));\n\n      // DCT to get MFCCs\n      const mfccs = this.dct(logMelEnergies, numCoeffs);\n\n      return mfccs;\n    });\n  }\n\n  private simpleFFT(frame: Float32Array): number[] {\n    // Very simplified FFT magnitude (for demonstration)\n    // In production, use a proper FFT library\n    const N = frame.length;\n    const result: number[] = [];\n\n    for (let k = 0; k < N / 2; k++) {\n      let real = 0;\n      let imag = 0;\n      for (let n = 0; n < N; n++) {\n        const angle = 2 * Math.PI * k * n / N;\n        const sample = frame[n] ?? 0;\n        real += sample * Math.cos(angle);\n        imag -= sample * Math.sin(angle);\n      }\n      result.push(Math.sqrt(real * real + imag * imag));\n    }\n\n    return result;\n  }\n\n  private melFilterbank(spectrum: number[], sampleRate: number, numFilters: number): number[] {\n    const melEnergies: number[] = [];\n    const fMax = sampleRate / 2;\n    const melMax = 2595 * Math.log10(1 + fMax / 700);\n\n    for (let i = 0; i < numFilters; i++) {\n      const melLow = melMax * i / (numFilters + 1);\n      const melHigh = melMax * (i + 2) / (numFilters + 1);\n      const melCenter = melMax * (i + 1) / (numFilters + 1);\n\n      const fLow = 700 * (Math.pow(10, melLow / 2595) - 1);\n      const fCenter = 700 * (Math.pow(10, melCenter / 2595) - 1);\n      const fHigh = 700 * (Math.pow(10, melHigh / 2595) - 1);\n\n      const binLow = Math.floor(fLow / fMax * spectrum.length);\n      const binCenter = Math.floor(fCenter / fMax * spectrum.length);\n      const binHigh = Math.floor(fHigh / fMax * spectrum.length);\n\n      let energy = 0;\n      for (let k = binLow; k < binHigh && k < spectrum.length; k++) {\n        const weight = k < binCenter\n          ? (k - binLow) / (binCenter - binLow)\n          : (binHigh - k) / (binHigh - binCenter);\n        energy += (spectrum[k] ?? 0) * Math.max(0, weight);\n      }\n\n      melEnergies.push(energy);\n    }\n\n    return melEnergies;\n  }\n\n  private dct(input: number[], numCoeffs: number): number[] {\n    const N = input.length;\n    const result: number[] = [];\n\n    for (let k = 0; k < numCoeffs; k++) {\n      let sum = 0;\n      for (let n = 0; n < N; n++) {\n        sum += (input[n] ?? 0) * Math.cos(Math.PI * k * (n + 0.5) / N);\n      }\n      result.push(sum * Math.sqrt(2 / N));\n    }\n\n    return result;\n  }\n\n  private resample(buffer: Float32Array, fromRate: number, toRate: number): Float32Array {\n    if (fromRate === toRate) return buffer;\n\n    const ratio = toRate / fromRate;\n    const newLength = Math.floor(buffer.length * ratio);\n    const result = new Float32Array(newLength);\n\n    for (let i = 0; i < newLength; i++) {\n      const srcIndex = i / ratio;\n      const srcIndexFloor = Math.floor(srcIndex);\n      const frac = srcIndex - srcIndexFloor;\n\n      if (srcIndexFloor + 1 < buffer.length) {\n        result[i] = (buffer[srcIndexFloor] ?? 0) * (1 - frac) + (buffer[srcIndexFloor + 1] ?? 0) * frac;\n      } else {\n        result[i] = buffer[srcIndexFloor] ?? 0;\n      }\n    }\n\n    return result;\n  }\n\n  private combineBuffers(buffers: Float32Array[]): Float32Array {\n    const totalLength = buffers.reduce((sum, b) => sum + b.length, 0);\n    const result = new Float32Array(totalLength);\n    let offset = 0;\n    for (const buffer of buffers) {\n      result.set(buffer, offset);\n      offset += buffer.length;\n    }\n    return result;\n  }\n\n  // ============================================================================\n  // PRIVATE HELPERS: Statistics & Analysis\n  // ============================================================================\n\n  private calculatePitchStats(pitchContour: number[]): {\n    meanF0: number;\n    stdF0: number;\n    minF0: number;\n    maxF0: number;\n    rangeF0: number;\n    voicedRatio: number;\n  } {\n    const voiced = pitchContour.filter(f => f > 0);\n\n    if (voiced.length === 0) {\n      return { meanF0: 0, stdF0: 0, minF0: 0, maxF0: 0, rangeF0: 0, voicedRatio: 0 };\n    }\n\n    const meanF0 = voiced.reduce((a, b) => a + b, 0) / voiced.length;\n    const stdF0 = Math.sqrt(\n      voiced.reduce((sum, f) => sum + Math.pow(f - meanF0, 2), 0) / voiced.length\n    );\n    const minF0 = Math.min(...voiced);\n    const maxF0 = Math.max(...voiced);\n\n    return {\n      meanF0,\n      stdF0,\n      minF0,\n      maxF0,\n      rangeF0: maxF0 - minF0,\n      voicedRatio: voiced.length / pitchContour.length,\n    };\n  }\n\n  private calculateStats(values: number[]): {\n    meanEnergy: number;\n    stdEnergy: number;\n    rangeEnergy: number;\n  } {\n    const mean = values.reduce((a, b) => a + b, 0) / values.length;\n    const std = Math.sqrt(\n      values.reduce((sum, v) => sum + Math.pow(v - mean, 2), 0) / values.length\n    );\n    const range = Math.max(...values) - Math.min(...values);\n\n    return { meanEnergy: mean, stdEnergy: std, rangeEnergy: range };\n  }\n\n  private calculateVoiceQuality(\n    frames: Float32Array[],\n    pitchContour: number[],\n    _sampleRate: number\n  ): IAcousticFeatures['voiceQuality'] {\n    const voicedFrames = frames.filter((_, i) => (pitchContour[i] ?? 0) > 0);\n\n    if (voicedFrames.length < 3) {\n      return { jitterLocal: 0, shimmerLocal: 0, hnr: 0, nhr: 0 };\n    }\n\n    // Calculate jitter (pitch perturbation)\n    const voicedPitches = pitchContour.filter(f => f > 0);\n    let jitterSum = 0;\n    for (let i = 1; i < voicedPitches.length; i++) {\n      const curr = voicedPitches[i] ?? 0;\n      const prev = voicedPitches[i - 1] ?? 0;\n      jitterSum += Math.abs(curr - prev);\n    }\n    const jitterLocal = (jitterSum / (voicedPitches.length - 1)) / (\n      voicedPitches.reduce((a, b) => a + b, 0) / voicedPitches.length\n    ) * 100;\n\n    // Calculate shimmer (amplitude perturbation)\n    const amplitudes = voicedFrames.map(frame =>\n      Math.sqrt(frame.reduce((sum, s) => sum + s * s, 0) / frame.length)\n    );\n    let shimmerSum = 0;\n    for (let i = 1; i < amplitudes.length; i++) {\n      const curr = amplitudes[i] ?? 0;\n      const prev = amplitudes[i - 1] ?? 0;\n      shimmerSum += Math.abs(curr - prev);\n    }\n    const shimmerLocal = (shimmerSum / (amplitudes.length - 1)) / (\n      amplitudes.reduce((a, b) => a + b, 0) / amplitudes.length\n    ) * 100;\n\n    // Calculate HNR (simplified)\n    const hnr = 20 * Math.log10(1 / (jitterLocal / 100 + shimmerLocal / 100 + 0.01));\n    const nhr = 1 / (Math.pow(10, hnr / 20) + 1);\n\n    return {\n      jitterLocal: Math.min(10, jitterLocal),\n      shimmerLocal: Math.min(20, shimmerLocal),\n      hnr: Math.max(-20, Math.min(30, hnr)),\n      nhr,\n    };\n  }\n\n  private calculateTemporalFeatures(\n    audioBuffer: Float32Array,\n    _frames: Float32Array[],\n    pitchContour: number[],\n    sampleRate: number\n  ): IAcousticFeatures['temporal'] {\n    const duration = audioBuffer.length / sampleRate;\n    const voicedFrames = pitchContour.filter(f => f > 0).length;\n    const totalFrames = pitchContour.length;\n\n    // Estimate pauses (unvoiced segments)\n    let pauseCount = 0;\n    let pauseDuration = 0;\n    let inPause = (pitchContour[0] ?? 0) === 0;\n\n    for (let i = 1; i < pitchContour.length; i++) {\n      const pitch = pitchContour[i] ?? 0;\n      if (pitch === 0 && !inPause) {\n        inPause = true;\n        pauseCount++;\n      } else if (pitch > 0 && inPause) {\n        inPause = false;\n      }\n\n      if (pitch === 0) {\n        pauseDuration += this.config.hopSizeMs / 1000;\n      }\n    }\n\n    const speakingTime = (voicedFrames / totalFrames) * duration;\n    const speechRate = 3; // syllables/sec (placeholder)\n    const articulationRate = speechRate / (speakingTime / duration);\n\n    return {\n      speechRate,\n      articulationRate,\n      duration,\n      speakingTime,\n      pauseDuration,\n      pauseCount,\n      meanPauseDuration: pauseCount > 0 ? pauseDuration / pauseCount : 0,\n    };\n  }\n\n  private calculateSpectralFeatures(\n    frames: Float32Array[],\n    sampleRate: number,\n    mfccMean: number[],\n    mfccStd: number[]\n  ): IAcousticFeatures['spectral'] {\n    // Calculate spectral centroid\n    let totalCentroid = 0;\n    let totalFlux = 0;\n    let prevSpectrum: number[] | null = null;\n\n    for (const frame of frames) {\n      const spectrum = this.simpleFFT(frame);\n      const total = spectrum.reduce((a, b) => a + b, 0) + 1e-10;\n\n      // Centroid\n      let centroid = 0;\n      for (let i = 0; i < spectrum.length; i++) {\n        const freq = i * sampleRate / (2 * spectrum.length);\n        centroid += freq * (spectrum[i] ?? 0) / total;\n      }\n      totalCentroid += centroid;\n\n      // Spectral flux\n      if (prevSpectrum) {\n        let flux = 0;\n        for (let i = 0; i < spectrum.length; i++) {\n          flux += Math.pow((spectrum[i] ?? 0) - (prevSpectrum[i] ?? 0), 2);\n        }\n        totalFlux += Math.sqrt(flux);\n      }\n      prevSpectrum = spectrum;\n    }\n\n    const spectralCentroid = totalCentroid / frames.length;\n    const spectralFlux = totalFlux / (frames.length - 1);\n\n    // Spectral rolloff (placeholder)\n    const spectralRolloff = spectralCentroid * 2;\n\n    return {\n      mfccMean,\n      mfccStd,\n      spectralCentroid,\n      spectralFlux,\n      spectralRolloff,\n    };\n  }\n\n  private assessAudioQuality(\n    audioBuffer: Float32Array,\n    energyContour: number[]\n  ): IAcousticFeatures['quality'] {\n    // Signal quality based on dynamic range\n    const maxEnergy = Math.max(...energyContour);\n    const minEnergy = Math.min(...energyContour);\n    const dynamicRange = maxEnergy - minEnergy;\n\n    // Clipping detection\n    let clippedSamples = 0;\n    for (let i = 0; i < audioBuffer.length; i++) {\n      if (Math.abs(audioBuffer[i] ?? 0) > 0.99) {\n        clippedSamples++;\n      }\n    }\n    const clippingRatio = clippedSamples / audioBuffer.length;\n\n    // Silence detection\n    const silentFrames = energyContour.filter(e => e < -40).length;\n    const silenceRatio = silentFrames / energyContour.length;\n\n    // Overall signal quality\n    const signalQuality = Math.max(0, Math.min(1,\n      (dynamicRange / 60) * (1 - clippingRatio) * (1 - silenceRatio * 0.5)\n    ));\n\n    return {\n      signalQuality,\n      noiseLevel: minEnergy,\n      clippingRatio,\n      silenceRatio,\n    };\n  }\n\n  private calculateFeatureReliability(features: IAcousticFeatures): number {\n    // Combine multiple quality indicators\n    const pitchReliability = features.pitch.voicedRatio;\n    const signalQuality = features.quality.signalQuality;\n    const energyRange = Math.min(1, features.energy.rangeEnergy / 30);\n\n    return (pitchReliability + signalQuality + energyRange) / 3;\n  }\n\n  // ============================================================================\n  // PRIVATE HELPERS: Prosody Analysis\n  // ============================================================================\n\n  private analyzePitchPattern(pitch: IAcousticFeatures['pitch']): IProsodyFeatures['pitchPattern'] {\n    const cv = pitch.stdF0 / (pitch.meanF0 || 1);\n\n    if (cv < 0.1) return 'monotone';\n    if (cv > 0.3) return 'varied';\n\n    // Check trend\n    const contour = pitch.contour.filter(f => f > 0);\n    if (contour.length < 5) return 'monotone'; // Not enough data for pattern detection\n\n    const firstHalf = contour.slice(0, contour.length / 2);\n    const secondHalf = contour.slice(contour.length / 2);\n\n    const firstMean = firstHalf.reduce((a, b) => a + b, 0) / firstHalf.length;\n    const secondMean = secondHalf.reduce((a, b) => a + b, 0) / secondHalf.length;\n\n    if (secondMean > firstMean * 1.1) return 'rising';\n    if (secondMean < firstMean * 0.9) return 'falling';\n\n    return 'varied';\n  }\n\n  private analyzeRhythmPattern(features: IAcousticFeatures): IProsodyFeatures['rhythmPattern'] {\n    const pauseVariability = features.temporal.meanPauseDuration > 0\n      ? features.temporal.pauseDuration / features.temporal.pauseCount / features.temporal.meanPauseDuration\n      : 1;\n\n    if (pauseVariability > 1.5) return 'irregular';\n    if (features.temporal.pauseCount / features.temporal.duration > 0.5) return 'hesitant';\n    if (features.temporal.speechRate > 5) return 'rushed';\n\n    return 'regular';\n  }\n\n  private determineIntonationType(pitch: IAcousticFeatures['pitch']): IProsodyFeatures['intonationType'] {\n    const contour = pitch.contour.filter(f => f > 0);\n    if (contour.length < 3) return 'neutral';\n\n    const lastThird = contour.slice(-Math.floor(contour.length / 3));\n    const lastMean = lastThird.reduce((a, b) => a + b, 0) / lastThird.length;\n    const overallMean = pitch.meanF0;\n\n    if (lastMean > overallMean * 1.2) return 'interrogative';\n    if (lastMean < overallMean * 0.8) return 'declarative';\n    if (pitch.rangeF0 > pitch.meanF0 * 0.5) return 'exclamatory';\n\n    return 'neutral';\n  }\n\n  private calculateArousalFromProsody(features: IAcousticFeatures): number {\n    // Arousal correlates with: high pitch, fast rate, high energy, high variability\n    const pitchNorm = Math.min(1, features.pitch.meanF0 / 200);\n    const rateNorm = Math.min(1, features.temporal.speechRate / 5);\n    const energyNorm = Math.min(1, (features.energy.meanEnergy + 40) / 40);\n    const variabilityNorm = Math.min(1, features.pitch.stdF0 / 50);\n\n    return (pitchNorm * 0.3 + rateNorm * 0.3 + energyNorm * 0.2 + variabilityNorm * 0.2) * 2 - 1;\n  }\n\n  private countHesitationMarkers(features: IAcousticFeatures): number {\n    // Count pauses before speech that could indicate hesitation\n    return Math.min(10, features.temporal.pauseCount);\n  }\n\n  // ============================================================================\n  // PRIVATE HELPERS: Emotion Mapping\n  // ============================================================================\n\n  private calculateEmotionProbabilities(\n    acoustic: IAcousticFeatures,\n    prosody: IProsodyFeatures\n  ): Map<string, number> {\n    const emotions = new Map<string, number>();\n    const arousal = prosody.emotionalIndicators.arousalLevel;\n    const valence = this.estimateValenceFromAcoustic(acoustic);\n\n    // Map to basic emotions based on arousal-valence quadrant\n    if (arousal > 0.3 && valence > 0.3) {\n      emotions.set('joy', 0.6);\n      emotions.set('excitement', 0.3);\n    } else if (arousal > 0.3 && valence < -0.3) {\n      emotions.set('anger', 0.4);\n      emotions.set('anxiety', 0.4);\n    } else if (arousal < -0.3 && valence < -0.3) {\n      emotions.set('sadness', 0.6);\n      emotions.set('depression', 0.3);\n    } else if (arousal < -0.3 && valence > 0.3) {\n      emotions.set('calm', 0.6);\n      emotions.set('contentment', 0.3);\n    } else {\n      emotions.set('neutral', 0.8);\n    }\n\n    // Adjust based on voice quality (stress/anxiety indicators)\n    if (acoustic.voiceQuality.jitterLocal > 2 || acoustic.voiceQuality.shimmerLocal > 5) {\n      const stressProb = emotions.get('anxiety') || 0;\n      emotions.set('stress', stressProb + 0.2);\n    }\n\n    // Normalize\n    const total = Array.from(emotions.values()).reduce((a, b) => a + b, 0);\n    emotions.forEach((v, k) => emotions.set(k, v / total));\n\n    return emotions;\n  }\n\n  private estimateValenceFromAcoustic(acoustic: IAcousticFeatures): number {\n    // Higher spectral centroid and HNR tend to indicate positive valence\n    const hnrNorm = Math.min(1, Math.max(-1, acoustic.voiceQuality.hnr / 20));\n    const centroidNorm = Math.min(1, acoustic.spectral.spectralCentroid / 2000);\n\n    return (hnrNorm * 0.6 + centroidNorm * 0.4) * 2 - 1;\n  }\n\n  private calculateVAD(\n    acoustic: IAcousticFeatures,\n    prosody: IProsodyFeatures\n  ): IVoiceEmotionEstimate['vad'] {\n    const arousal = prosody.emotionalIndicators.arousalLevel;\n    const valence = this.estimateValenceFromAcoustic(acoustic);\n    const dominance = Math.min(1, Math.max(0,\n      0.5 + (acoustic.energy.meanEnergy + 30) / 60 * 0.3 +\n      prosody.emotionalIndicators.expressiveness * 0.2\n    ));\n\n    const confidence = acoustic.quality.signalQuality * acoustic.pitch.voicedRatio;\n\n    return { valence, arousal, dominance, confidence };\n  }\n\n  private calculateDepressionIndicators(\n    acoustic: IAcousticFeatures,\n    _prosody: IProsodyFeatures\n  ): IVoiceEmotionEstimate['depressionIndicators'] {\n    // Flat affect: low pitch variation\n    const pitchCV = acoustic.pitch.stdF0 / (acoustic.pitch.meanF0 || 1);\n    const flatAffect = Math.max(0, 1 - pitchCV / 0.2);\n\n    // Psychomotor retardation: slow speech\n    const psychomotorRetardation = Math.max(0, 1 - acoustic.temporal.speechRate / 3);\n\n    // Low energy\n    const lowEnergy = Math.max(0, 1 - (acoustic.energy.meanEnergy + 40) / 40);\n\n    const score = (flatAffect * 0.4 + psychomotorRetardation * 0.3 + lowEnergy * 0.3);\n    const confidence = acoustic.quality.signalQuality * 0.8;\n\n    return { flatAffect, psychomotorRetardation, lowEnergy, score, confidence };\n  }\n\n  private calculateAnxietyIndicators(\n    acoustic: IAcousticFeatures,\n    prosody: IProsodyFeatures\n  ): IVoiceEmotionEstimate['anxietyIndicators'] {\n    // High pitch\n    const highPitch = Math.min(1, acoustic.pitch.meanF0 / 250);\n\n    // Fast speech\n    const fastSpeech = Math.min(1, acoustic.temporal.speechRate / 5);\n\n    // Voice tremor (jitter)\n    const tremor = Math.min(1, acoustic.voiceQuality.jitterLocal / 3);\n\n    // Hesitation\n    const hesitation = Math.min(1, prosody.pausePatterns.hesitationMarkers / 10);\n\n    const score = (highPitch * 0.25 + fastSpeech * 0.25 + tremor * 0.25 + hesitation * 0.25);\n    const confidence = acoustic.quality.signalQuality * 0.8;\n\n    return { highPitch, fastSpeech, tremor, hesitation, score, confidence };\n  }\n\n  private calculateStressIndicators(\n    acoustic: IAcousticFeatures,\n    prosody: IProsodyFeatures\n  ): IVoiceEmotionEstimate['stressIndicators'] {\n    // Voice instability (jitter + shimmer)\n    const voiceInstability = Math.min(1, (acoustic.voiceQuality.jitterLocal + acoustic.voiceQuality.shimmerLocal) / 10);\n\n    // Reduced clarity (low HNR)\n    const reducedClarity = Math.max(0, 1 - (acoustic.voiceQuality.hnr + 10) / 30);\n\n    // Irregular breathing (pause patterns)\n    const breathingIrregularity = Math.min(1, prosody.pausePatterns.cognitiveLoadIndicator);\n\n    const score = (voiceInstability * 0.4 + reducedClarity * 0.3 + breathingIrregularity * 0.3);\n    const confidence = acoustic.quality.signalQuality * 0.8;\n\n    return { voiceInstability, reducedClarity, breathingIrregularity, score, confidence };\n  }\n\n  // ============================================================================\n  // PRIVATE HELPERS: Text Analysis\n  // ============================================================================\n\n  private calculateSimpleSentiment(text: string): number {\n    const positiveWords = ['', '', '', '', '', '', '', ''];\n    const negativeWords = ['', '', '', '', '', '', '', ''];\n\n    const lower = text.toLowerCase();\n    let score = 0;\n\n    positiveWords.forEach(w => {\n      if (lower.includes(w)) score += 0.2;\n    });\n\n    negativeWords.forEach(w => {\n      if (lower.includes(w)) score -= 0.2;\n    });\n\n    return Math.max(-1, Math.min(1, score));\n  }\n\n  private detectTextEmotions(text: string): Map<string, number> {\n    const emotions = new Map<string, number>();\n    const lower = text.toLowerCase();\n\n    const emotionKeywords: Record<string, string[]> = {\n      joy: ['', '', '', ''],\n      sadness: ['', '', '', ''],\n      anger: ['', '', '', ''],\n      fear: ['', '', '', ''],\n      anxiety: ['', '', ''],\n      neutral: [],\n    };\n\n    let total = 0;\n    Object.entries(emotionKeywords).forEach(([emotion, keywords]) => {\n      let count = 0;\n      keywords.forEach(kw => {\n        if (lower.includes(kw)) count++;\n      });\n      if (count > 0) {\n        emotions.set(emotion, count);\n        total += count;\n      }\n    });\n\n    // Normalize\n    if (total > 0) {\n      emotions.forEach((v, k) => emotions.set(k, v / total));\n    } else {\n      emotions.set('neutral', 1.0);\n    }\n\n    return emotions;\n  }\n\n  private detectCognitiveDistortions(text: string): ITextAnalysis['cognitiveDistortions'] {\n    const lower = text.toLowerCase();\n    const distortions: ITextAnalysis['cognitiveDistortions'] = [];\n\n    DISTORTION_PATTERNS.forEach(({ type, patterns }) => {\n      patterns.forEach(pattern => {\n        if (lower.includes(pattern)) {\n          distortions.push({\n            type,\n            phrase: pattern,\n            confidence: 0.7,\n          });\n        }\n      });\n    });\n\n    return distortions;\n  }\n\n  private detectRiskKeywords(text: string): ITextAnalysis['riskKeywords'] {\n    const lower = text.toLowerCase();\n    const risks: ITextAnalysis['riskKeywords'] = [];\n\n    Object.entries(RISK_KEYWORDS).forEach(([category, keywords]) => {\n      keywords.forEach(keyword => {\n        if (lower.includes(keyword)) {\n          risks.push({\n            keyword,\n            category,\n            severity: category === 'suicidal' ? 1.0 : category === 'self_harm' ? 0.8 : 0.5,\n          });\n        }\n      });\n    });\n\n    return risks;\n  }\n\n  private textSentimentToVAD(\n    sentiment: number,\n    emotions: Map<string, number>\n  ): { valence: number; arousal: number; dominance: number } {\n    // Map sentiment to valence\n    const valence = sentiment;\n\n    // Estimate arousal from emotions\n    let arousal = 0;\n    if (emotions.has('anger')) arousal += emotions.get('anger')! * 0.8;\n    if (emotions.has('fear')) arousal += emotions.get('fear')! * 0.6;\n    if (emotions.has('joy')) arousal += emotions.get('joy')! * 0.4;\n    if (emotions.has('sadness')) arousal -= emotions.get('sadness')! * 0.4;\n\n    // Dominance from emotion type\n    let dominance = 0.5;\n    if (emotions.has('anger')) dominance += emotions.get('anger')! * 0.3;\n    if (emotions.has('fear')) dominance -= emotions.get('fear')! * 0.3;\n\n    return {\n      valence: Math.max(-1, Math.min(1, valence)),\n      arousal: Math.max(-1, Math.min(1, arousal)),\n      dominance: Math.max(0, Math.min(1, dominance)),\n    };\n  }\n\n  private getTextPrimaryEmotion(textAnalysis: ITextAnalysis): string {\n    let primary = 'neutral';\n    let maxProb = 0;\n    textAnalysis.textEmotions.forEach((prob, emotion) => {\n      if (prob > maxProb) {\n        maxProb = prob;\n        primary = emotion;\n      }\n    });\n    return primary;\n  }\n\n  private calculateModalityAgreement(\n    voice: IVoiceEmotionEstimate,\n    text: ITextAnalysis\n  ): number {\n    const voicePrimary = voice.primaryEmotion;\n    const textPrimary = this.getTextPrimaryEmotion(text);\n\n    // Same emotion = high agreement\n    if (voicePrimary === textPrimary) return 1.0;\n\n    // Similar valence = medium agreement\n    const voiceValence = voice.vad.valence;\n    const textValence = text.sentiment;\n    const valenceDiff = Math.abs(voiceValence - textValence);\n\n    return Math.max(0, 1 - valenceDiff);\n  }\n\n  private analyzeDiscrepancy(\n    voicePrimary: string,\n    textPrimary: string,\n    voice: IVoiceEmotionEstimate,\n    text: ITextAnalysis\n  ): IMultimodalFusion['discrepancy'] {\n    const voiceValence = voice.vad.valence;\n    const textValence = text.sentiment;\n\n    // Positive text + negative voice = suppression\n    if (textValence > 0 && voiceValence < -0.3) {\n      return {\n        type: 'suppression',\n        textEmotion: textPrimary,\n        voiceEmotion: voicePrimary,\n        interpretation: '   ,   .   .',\n      };\n    }\n\n    // Negative text + positive voice = masking\n    if (textValence < 0 && voiceValence > 0.3) {\n      return {\n        type: 'masking',\n        textEmotion: textPrimary,\n        voiceEmotion: voicePrimary,\n        interpretation: '     .   .',\n      };\n    }\n\n    // Both negative but different intensity\n    if (textValence < 0 && voiceValence < 0) {\n      const voiceIntensity = Math.abs(voiceValence);\n      const textIntensity = Math.abs(textValence);\n\n      if (voiceIntensity > textIntensity * 1.5) {\n        return {\n          type: 'amplification',\n          textEmotion: textPrimary,\n          voiceEmotion: voicePrimary,\n          interpretation: '     ,  .',\n        };\n      }\n    }\n\n    return {\n      type: 'none',\n      textEmotion: textPrimary,\n      voiceEmotion: voicePrimary,\n      interpretation: ' .',\n    };\n  }\n\n  private generateRecommendations(\n    vad: IMultimodalFusion['vad'],\n    voice: IVoiceEmotionEstimate,\n    text: ITextAnalysis,\n    discrepancy?: IMultimodalFusion['discrepancy']\n  ): string[] {\n    const recommendations: string[] = [];\n\n    // Risk-based recommendations\n    if (text.riskKeywords.length > 0) {\n      const severity = Math.max(...text.riskKeywords.map(r => r.severity));\n      if (severity >= 0.8) {\n        recommendations.push(':    .    .');\n      } else {\n        recommendations.push('   .   .');\n      }\n    }\n\n    // Depression indicators\n    if (voice.depressionIndicators.score > 0.6) {\n      recommendations.push('      .   PHQ-9.');\n    }\n\n    // Anxiety indicators\n    if (voice.anxietyIndicators.score > 0.6) {\n      recommendations.push('     .   .');\n    }\n\n    // Discrepancy recommendations\n    if (discrepancy && discrepancy.type !== 'none') {\n      recommendations.push(`      (${discrepancy.type}). ${discrepancy.interpretation}`);\n    }\n\n    // Cognitive distortions\n    if (text.cognitiveDistortions.length > 0) {\n      const types = [...new Set(text.cognitiveDistortions.map(d => d.type))];\n      recommendations.push(`  : ${types.join(', ')}.    -.`);\n    }\n\n    // General wellbeing\n    if (vad.valence > 0.5 && voice.stressIndicators.score < 0.3) {\n      recommendations.push('     .');\n    }\n\n    return recommendations;\n  }\n}\n\n/**\n * Factory function\n */\nexport function createVoiceInputAdapter(\n  config?: Partial<IVoiceAdapterConfig>\n): IVoiceInputAdapter {\n  return new VoiceInputAdapter(config);\n}\n\nexport { DEFAULT_VOICE_CONFIG };\n","/**\n *  MULTI-LAYER CRISIS DETECTION ENGINE\n * =======================================\n * Real-time Crisis Detection for Mental Health Safety\n *\n * Scientific Foundation (2025 Research):\n * - Multi-layer detection pattern (AI UX Design Guide, 2025)\n * - C-SSRS inspired severity levels (Columbia Protocol)\n * - Suicide Risk Lexicon methodology (ResearchGate, 2025)\n * - Russian language support (Springer, 2020)\n *\n * Architecture:\n * Layer 1: Raw text keyword scanning (IMMEDIATE, before any processing)\n * Layer 2: Pattern & context analysis (linguistic patterns)\n * Layer 3: State-based risk assessment (integration with StateVector)\n *\n *   \" \", 2025\n */\n\n// ============================================================================\n// TYPES & INTERFACES\n// ============================================================================\n\n/**\n * Crisis severity levels (C-SSRS inspired)\n */\nexport type CrisisSeverity =\n  | 'none'           // No crisis indicators\n  | 'low'            // Minor indicators, monitor\n  | 'moderate'       // Clear indicators, attention needed\n  | 'high'           // Serious indicators, intervention required\n  | 'critical';      // Acute risk, immediate action required\n\n/**\n * Crisis type classification\n */\nexport type CrisisType =\n  | 'suicidal_ideation'    // Thoughts about suicide\n  | 'suicidal_intent'      // Plans or intent to act\n  | 'self_harm'            // Non-suicidal self-injury\n  | 'acute_distress'       // Severe emotional crisis\n  | 'psychotic_features'   // Reality disconnection\n  | 'substance_crisis'     // Substance-related emergency\n  | 'panic_attack'         // Acute anxiety crisis\n  | 'unknown';             // Unclassified crisis\n\n/**\n * Detection layer result\n */\nexport interface LayerResult {\n  readonly triggered: boolean;\n  readonly confidence: number;\n  readonly indicators: string[];\n  readonly matchedPatterns: string[];\n}\n\n/**\n * Complete crisis detection result\n */\nexport interface CrisisDetectionResult {\n  readonly isCrisis: boolean;\n  readonly severity: CrisisSeverity;\n  readonly crisisType: CrisisType;\n  readonly confidence: number;\n\n  // Layer results\n  readonly layer1RawText: LayerResult;\n  readonly layer2Pattern: LayerResult;\n  readonly layer3State: LayerResult;\n\n  // Aggregated indicators\n  readonly allIndicators: string[];\n  readonly primaryIndicator: string | null;\n\n  // Response guidance\n  readonly recommendedAction: 'none' | 'monitor' | 'supportive_response' | 'crisis_protocol' | 'emergency_escalation';\n  readonly urgency: 'routine' | 'soon' | 'urgent' | 'immediate';\n\n  // Metadata\n  readonly detectedAt: Date;\n  readonly processingTimeMs: number;\n}\n\n/**\n * Crisis detector configuration\n */\nexport interface CrisisDetectorConfig {\n  readonly enableLayer1: boolean;\n  readonly enableLayer2: boolean;\n  readonly enableLayer3: boolean;\n  readonly sensitivityLevel: 'low' | 'medium' | 'high';\n  readonly language: 'ru' | 'en' | 'auto';\n}\n\n/**\n * State risk data for Layer 3\n */\nexport interface StateRiskData {\n  readonly overallRiskLevel: number;\n  readonly suicidalIdeation: number;\n  readonly selfHarmRisk: number;\n  readonly emotionalValence: number;\n  readonly recentTrend: 'improving' | 'stable' | 'declining';\n}\n\n// ============================================================================\n// KEYWORD LEXICONS (Bilingual)\n// ============================================================================\n\n/**\n * Layer 1: Critical keywords that require IMMEDIATE attention\n * Based on Suicide Risk Lexicon and clinical guidelines\n */\nconst CRITICAL_KEYWORDS = {\n  // Suicidal ideation - Russian\n  ru_suicidal: [\n    '', '', '  ', '  ',\n    ' ', ' ', ' ', ' ',\n    '', '', // standalone for mixed language detection\n    '  ', '   ', ' ', ' ',\n    '   ', '   ', '    ',\n    '', '', ' ', ' ',\n    ' ', ' ', ' ', ' ',\n    '   ', ' ', ' ',\n    '    ', '  ', '  ',\n    ' ', ' ', ' ',\n  ],\n\n  // Suicidal ideation - English\n  en_suicidal: [\n    'suicide', 'kill myself', 'end my life', 'end it all',\n    'want to die', 'wanna die', 'wish i was dead', 'wish i were dead',\n    'don\\'t want to live', 'do not want to live', 'tired of living',\n    'better off dead', 'better if i was gone', 'world without me',\n    'hang myself', 'slit my wrists', 'overdose', 'jump off',\n    'no reason to live', 'life is meaningless', 'pointless to live',\n    'everyone would be better', 'nobody needs me', 'no one cares',\n    'disappear forever', 'cease to exist',\n  ],\n\n  // Self-harm - Russian\n  ru_selfharm: [\n    ' ', ' ', ' ', '',\n    ' ', ' ', '  ',\n    ' ', ' ', ' ',\n    '', '',\n  ],\n\n  // Self-harm - English\n  en_selfharm: [\n    'cut myself', 'cutting myself', 'hurt myself', 'hurting myself',\n    'harm myself', 'harming myself', 'self-harm', 'selfharm',\n    'self harm', 'self-injury', 'self injury',\n    'burn myself', 'punch myself', 'hit myself',\n  ],\n\n  // Hopelessness indicators - Russian\n  ru_hopeless: [\n    '', '', ' ', '  ',\n    '   ', '  ', ' ',\n    ' ', '', ' ', ' ',\n    ' ', '  ',\n  ],\n\n  // Hopelessness indicators - English\n  en_hopeless: [\n    'hopeless', 'no hope', 'nothing will change', 'nothing will ever change',\n    'never get better', 'always be like this', 'no way out', 'trapped forever',\n    'stuck forever', 'pointless', 'nothing helps', 'can\\'t go on',\n  ],\n};\n\n/**\n * Layer 2: Context patterns that increase concern\n * Linguistic patterns suggesting crisis\n */\nconst CONTEXT_PATTERNS = {\n  // Planning language\n  planning: [\n    /.*(?:|||)/i,\n    /(?:|)?.*(?:||)/i,\n    /(?:)?.*(?:||)/i,\n    /plan.*(?:kill|die|end|suicide)/i,\n    /ready to.*(?:die|end|go)/i,\n    /decided to.*(?:kill|end|die)/i,\n    /going to.*(?:kill myself|end it)/i,\n  ],\n\n  // Farewell language\n  farewell: [\n    /(?:|).*(?:?|)/i,\n    /(?:||).*(?:||)/i,\n    /goodbye.*(?:forever|everyone|all)/i,\n    /this is.*(?:goodbye|the end|my last)/i,\n    /final.*(?:message|goodbye|words)/i,\n  ],\n\n  // Giving away possessions\n  giving_away: [\n    /(?:|).*(?:||)/i,\n    /.*(?:|)/i,\n    /giving away.*(?:stuff|things|everything)/i,\n    /want you to have/i,\n  ],\n\n  // Time pressure\n  urgency: [\n    /.*(?:?||)/i,\n    /(?:|).*/i,\n    /tonight.*(?:end|over|die)/i,\n    /this is.*(?:it|the end)/i,\n    /won'?t.*(?:see|be here).*(?:tomorrow|morning)/i,\n  ],\n\n  // Absolute negative statements\n  absolutes: [\n    /.*(?: | | )/i,\n    /.*(?:||)/i,\n    /.*(?: | | )/i,\n    /never.*(?:get better|change|be happy)/i,\n    /always.*(?:alone|suffering|miserable)/i,\n    /nobody.*(?:cares|understands|loves)/i,\n    /everyone.*(?:hates|against|better without)/i,\n  ],\n};\n\n/**\n * Protective factors that may reduce severity\n */\nconst PROTECTIVE_FACTORS = [\n  // Russian - more specific patterns to avoid false positives\n  /\\s+(?:||| )/i,\n  /\\s+(?: ||  )/i,\n  /(?:|)/i,\n  / /i,\n  /\\s+/i,            // must be \" \" directly, not separated\n  /\\s+(?:|)/i,\n\n  // English - more specific patterns\n  /but\\s+(?:i\\s+)?(?:want to|will|trying|there's hope)/i,\n  /(?:i\\s+)?don'?t\\s+(?:want to die|going to|actually)/i,\n  /help me/i,\n  /need help/i,\n  /want to\\s+(?:live|change|get help)/i,\n];\n\n// ============================================================================\n// CRISIS DETECTOR IMPLEMENTATION\n// ============================================================================\n\n/**\n * Default configuration\n */\nexport const DEFAULT_CRISIS_CONFIG: CrisisDetectorConfig = {\n  enableLayer1: true,\n  enableLayer2: true,\n  enableLayer3: true,\n  sensitivityLevel: 'high',\n  language: 'auto',\n};\n\n/**\n * Multi-layer Crisis Detector\n */\nexport class CrisisDetector {\n  private readonly config: CrisisDetectorConfig;\n\n  constructor(config: Partial<CrisisDetectorConfig> = {}) {\n    this.config = { ...DEFAULT_CRISIS_CONFIG, ...config };\n  }\n\n  /**\n   * Main detection method - analyzes text for crisis indicators\n   * This should be called BEFORE any cognitive analysis\n   */\n  detect(\n    rawText: string,\n    stateRiskData?: StateRiskData\n  ): CrisisDetectionResult {\n    const startTime = Date.now();\n\n    // Normalize text for analysis\n    const normalizedText = this.normalizeText(rawText);\n    const detectedLanguage = this.detectLanguage(normalizedText);\n\n    // Run all enabled layers\n    const layer1 = this.config.enableLayer1\n      ? this.runLayer1RawTextScan(normalizedText, detectedLanguage)\n      : this.emptyLayerResult();\n\n    const layer2 = this.config.enableLayer2\n      ? this.runLayer2PatternAnalysis(normalizedText)\n      : this.emptyLayerResult();\n\n    const layer3 = this.config.enableLayer3 && stateRiskData\n      ? this.runLayer3StateAnalysis(stateRiskData)\n      : this.emptyLayerResult();\n\n    // Check for protective factors\n    const hasProtectiveFactors = this.checkProtectiveFactors(normalizedText);\n\n    // Aggregate results\n    const result = this.aggregateResults(layer1, layer2, layer3, hasProtectiveFactors);\n\n    return {\n      ...result,\n      layer1RawText: layer1,\n      layer2Pattern: layer2,\n      layer3State: layer3,\n      detectedAt: new Date(),\n      processingTimeMs: Date.now() - startTime,\n    };\n  }\n\n  /**\n   * Quick check - returns true if ANY crisis indicator found\n   * Use for immediate bypass decisions\n   */\n  quickCheck(rawText: string): boolean {\n    const normalizedText = this.normalizeText(rawText);\n    const language = this.detectLanguage(normalizedText);\n\n    // Check critical keywords only (fastest path)\n    const keywords = language === 'ru'\n      ? [...CRITICAL_KEYWORDS.ru_suicidal, ...CRITICAL_KEYWORDS.ru_selfharm]\n      : language === 'en'\n      ? [...CRITICAL_KEYWORDS.en_suicidal, ...CRITICAL_KEYWORDS.en_selfharm]\n      : [...CRITICAL_KEYWORDS.ru_suicidal, ...CRITICAL_KEYWORDS.ru_selfharm,\n         ...CRITICAL_KEYWORDS.en_suicidal, ...CRITICAL_KEYWORDS.en_selfharm];\n\n    for (const keyword of keywords) {\n      if (normalizedText.includes(keyword.toLowerCase())) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  // ==========================================================================\n  // LAYER 1: Raw Text Keyword Scanning\n  // ==========================================================================\n\n  private runLayer1RawTextScan(text: string, language: 'ru' | 'en' | 'both'): LayerResult {\n    const indicators: string[] = [];\n    const matchedPatterns: string[] = [];\n\n    // Select keyword sets based on language\n    const keywordSets = this.getKeywordSets(language);\n\n    // Check each category\n    for (const [category, keywords] of Object.entries(keywordSets)) {\n      for (const keyword of keywords) {\n        if (text.includes(keyword.toLowerCase())) {\n          indicators.push(`keyword_${category}`);\n          matchedPatterns.push(keyword);\n        }\n      }\n    }\n\n    // Calculate confidence based on number and type of matches\n    const confidence = this.calculateLayer1Confidence(indicators);\n\n    return {\n      triggered: indicators.length > 0,\n      confidence,\n      indicators: [...new Set(indicators)],\n      matchedPatterns: [...new Set(matchedPatterns)],\n    };\n  }\n\n  private getKeywordSets(language: 'ru' | 'en' | 'both'): Record<string, string[]> {\n    if (language === 'ru') {\n      return {\n        suicidal: CRITICAL_KEYWORDS.ru_suicidal,\n        selfharm: CRITICAL_KEYWORDS.ru_selfharm,\n        hopeless: CRITICAL_KEYWORDS.ru_hopeless,\n      };\n    } else if (language === 'en') {\n      return {\n        suicidal: CRITICAL_KEYWORDS.en_suicidal,\n        selfharm: CRITICAL_KEYWORDS.en_selfharm,\n        hopeless: CRITICAL_KEYWORDS.en_hopeless,\n      };\n    } else {\n      return {\n        suicidal: [...CRITICAL_KEYWORDS.ru_suicidal, ...CRITICAL_KEYWORDS.en_suicidal],\n        selfharm: [...CRITICAL_KEYWORDS.ru_selfharm, ...CRITICAL_KEYWORDS.en_selfharm],\n        hopeless: [...CRITICAL_KEYWORDS.ru_hopeless, ...CRITICAL_KEYWORDS.en_hopeless],\n      };\n    }\n  }\n\n  private calculateLayer1Confidence(indicators: string[]): number {\n    if (indicators.length === 0) return 0;\n\n    // Weight by indicator type\n    let score = 0;\n    for (const indicator of indicators) {\n      if (indicator.includes('suicidal')) score += 0.4;\n      else if (indicator.includes('selfharm')) score += 0.3;\n      else if (indicator.includes('hopeless')) score += 0.2;\n      else score += 0.1;\n    }\n\n    return Math.min(1, score);\n  }\n\n  // ==========================================================================\n  // LAYER 2: Pattern & Context Analysis\n  // ==========================================================================\n\n  private runLayer2PatternAnalysis(text: string): LayerResult {\n    const indicators: string[] = [];\n    const matchedPatterns: string[] = [];\n\n    // Check each pattern category\n    for (const [category, patterns] of Object.entries(CONTEXT_PATTERNS)) {\n      for (const pattern of patterns) {\n        if (pattern.test(text)) {\n          indicators.push(`pattern_${category}`);\n          const match = text.match(pattern);\n          if (match) {\n            matchedPatterns.push(match[0]);\n          }\n        }\n      }\n    }\n\n    // Calculate confidence\n    const confidence = this.calculateLayer2Confidence(indicators);\n\n    return {\n      triggered: indicators.length > 0,\n      confidence,\n      indicators: [...new Set(indicators)],\n      matchedPatterns,\n    };\n  }\n\n  private calculateLayer2Confidence(indicators: string[]): number {\n    if (indicators.length === 0) return 0;\n\n    // Weight by pattern type\n    let score = 0;\n    for (const indicator of indicators) {\n      if (indicator.includes('planning')) score += 0.5;\n      else if (indicator.includes('farewell')) score += 0.4;\n      else if (indicator.includes('giving_away')) score += 0.3;\n      else if (indicator.includes('urgency')) score += 0.4;\n      else if (indicator.includes('absolutes')) score += 0.2;\n      else score += 0.1;\n    }\n\n    return Math.min(1, score);\n  }\n\n  // ==========================================================================\n  // LAYER 3: State-Based Risk Analysis\n  // ==========================================================================\n\n  private runLayer3StateAnalysis(stateRisk: StateRiskData): LayerResult {\n    const indicators: string[] = [];\n    const matchedPatterns: string[] = [];\n\n    // Check risk thresholds\n    if (stateRisk.overallRiskLevel >= 0.7) {\n      indicators.push('state_high_overall_risk');\n      matchedPatterns.push(`risk_level=${stateRisk.overallRiskLevel.toFixed(2)}`);\n    }\n\n    if (stateRisk.suicidalIdeation > 0.5) {\n      indicators.push('state_suicidal_ideation');\n      matchedPatterns.push(`suicidal_ideation=${stateRisk.suicidalIdeation.toFixed(2)}`);\n    }\n\n    if (stateRisk.selfHarmRisk > 0.5) {\n      indicators.push('state_self_harm_risk');\n      matchedPatterns.push(`self_harm_risk=${stateRisk.selfHarmRisk.toFixed(2)}`);\n    }\n\n    if (stateRisk.emotionalValence < -0.7) {\n      indicators.push('state_severe_negative_affect');\n      matchedPatterns.push(`valence=${stateRisk.emotionalValence.toFixed(2)}`);\n    }\n\n    if (stateRisk.recentTrend === 'declining') {\n      indicators.push('state_declining_trend');\n      matchedPatterns.push('trend=declining');\n    }\n\n    // Calculate confidence\n    const confidence = this.calculateLayer3Confidence(stateRisk, indicators);\n\n    return {\n      triggered: indicators.length > 0,\n      confidence,\n      indicators,\n      matchedPatterns,\n    };\n  }\n\n  private calculateLayer3Confidence(stateRisk: StateRiskData, indicators: string[]): number {\n    if (indicators.length === 0) return 0;\n\n    // Weighted combination of risk factors\n    const riskScore = (\n      stateRisk.overallRiskLevel * 0.3 +\n      stateRisk.suicidalIdeation * 0.4 +\n      stateRisk.selfHarmRisk * 0.3\n    );\n\n    return Math.min(1, riskScore);\n  }\n\n  // ==========================================================================\n  // PROTECTIVE FACTORS\n  // ==========================================================================\n\n  private checkProtectiveFactors(text: string): boolean {\n    for (const pattern of PROTECTIVE_FACTORS) {\n      if (pattern.test(text)) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  // ==========================================================================\n  // RESULT AGGREGATION\n  // ==========================================================================\n\n  private aggregateResults(\n    layer1: LayerResult,\n    layer2: LayerResult,\n    layer3: LayerResult,\n    hasProtectiveFactors: boolean\n  ): Omit<CrisisDetectionResult, 'layer1RawText' | 'layer2Pattern' | 'layer3State' | 'detectedAt' | 'processingTimeMs'> {\n\n    // Collect all indicators\n    const allIndicators = [\n      ...layer1.indicators,\n      ...layer2.indicators,\n      ...layer3.indicators,\n    ];\n\n    // Check if any layer triggered\n    const anyTriggered = layer1.triggered || layer2.triggered || layer3.triggered;\n\n    // Calculate combined confidence\n    const combinedConfidence = this.calculateCombinedConfidence(layer1, layer2, layer3, hasProtectiveFactors);\n\n    // Determine severity\n    const severity = this.determineSeverity(layer1, layer2, layer3, combinedConfidence, hasProtectiveFactors);\n\n    // Determine crisis type\n    const crisisType = this.determineCrisisType(allIndicators);\n\n    // Determine recommended action\n    const { recommendedAction, urgency } = this.determineResponse(severity, crisisType);\n\n    // Find primary indicator\n    const primaryIndicator = this.findPrimaryIndicator(layer1, layer2, layer3);\n\n    return {\n      isCrisis: anyTriggered && severity !== 'none' && severity !== 'low',\n      severity,\n      crisisType,\n      confidence: combinedConfidence,\n      allIndicators,\n      primaryIndicator,\n      recommendedAction,\n      urgency,\n    };\n  }\n\n  private calculateCombinedConfidence(\n    layer1: LayerResult,\n    layer2: LayerResult,\n    layer3: LayerResult,\n    hasProtectiveFactors: boolean\n  ): number {\n    // Weighted combination - Layer 1 (raw text) is most important\n    const base = (\n      layer1.confidence * 0.5 +\n      layer2.confidence * 0.3 +\n      layer3.confidence * 0.2\n    );\n\n    // Reduce confidence slightly if protective factors present\n    const adjusted = hasProtectiveFactors ? base * 0.85 : base;\n\n    return Math.min(1, adjusted);\n  }\n\n  private determineSeverity(\n    layer1: LayerResult,\n    layer2: LayerResult,\n    layer3: LayerResult,\n    confidence: number,\n    hasProtectiveFactors: boolean\n  ): CrisisSeverity {\n\n    // CRITICAL: Planning + suicidal keywords\n    if (layer1.indicators.includes('keyword_suicidal') &&\n        layer2.indicators.includes('pattern_planning')) {\n      return 'critical';\n    }\n\n    // CRITICAL: High confidence + multiple layers\n    if (confidence > 0.8 && layer1.triggered && layer2.triggered) {\n      return hasProtectiveFactors ? 'high' : 'critical';\n    }\n\n    // HIGH: ANY suicidal keyword is serious - don't require high confidence\n    // Suicidal content should always be treated as high severity for safety\n    if (layer1.indicators.includes('keyword_suicidal')) {\n      return hasProtectiveFactors ? 'moderate' : 'high';\n    }\n\n    // HIGH: Farewell + urgency patterns\n    if (layer2.indicators.includes('pattern_farewell') ||\n        layer2.indicators.includes('pattern_urgency')) {\n      return 'high';\n    }\n\n    // MODERATE: Self-harm indicators\n    if (layer1.indicators.includes('keyword_selfharm')) {\n      return hasProtectiveFactors ? 'low' : 'moderate';\n    }\n\n    // MODERATE: State-based high risk\n    if (layer3.indicators.includes('state_suicidal_ideation') ||\n        layer3.indicators.includes('state_high_overall_risk')) {\n      return 'moderate';\n    }\n\n    // LOW: Hopelessness without other indicators\n    if (layer1.indicators.includes('keyword_hopeless') &&\n        !layer1.indicators.includes('keyword_suicidal')) {\n      return 'low';\n    }\n\n    // LOW: Only absolutes pattern\n    if (layer2.triggered && layer2.indicators.length === 1 &&\n        layer2.indicators[0] === 'pattern_absolutes') {\n      return 'low';\n    }\n\n    // NONE: No significant indicators\n    if (!layer1.triggered && !layer2.triggered && !layer3.triggered) {\n      return 'none';\n    }\n\n    // Default to low if any indicator but not clear severity\n    return 'low';\n  }\n\n  private determineCrisisType(indicators: string[]): CrisisType {\n    // Check for suicidal indicators first\n    const hasSuicidalKeyword = indicators.some(i => i.includes('suicidal'));\n    const hasPlanning = indicators.some(i => i.includes('planning'));\n\n    if (hasSuicidalKeyword && hasPlanning) {\n      return 'suicidal_intent';\n    }\n\n    if (hasSuicidalKeyword) {\n      return 'suicidal_ideation';\n    }\n\n    // Check for self-harm\n    if (indicators.some(i => i.includes('selfharm') || i.includes('self_harm'))) {\n      return 'self_harm';\n    }\n\n    // Check for acute distress\n    if (indicators.some(i => i.includes('hopeless') || i.includes('absolutes'))) {\n      return 'acute_distress';\n    }\n\n    // Check for panic\n    if (indicators.some(i => i.includes('urgency'))) {\n      return 'panic_attack';\n    }\n\n    return 'unknown';\n  }\n\n  private determineResponse(\n    severity: CrisisSeverity,\n    _crisisType: CrisisType\n  ): { recommendedAction: CrisisDetectionResult['recommendedAction']; urgency: CrisisDetectionResult['urgency'] } {\n\n    switch (severity) {\n      case 'critical':\n        return { recommendedAction: 'emergency_escalation', urgency: 'immediate' };\n      case 'high':\n        return { recommendedAction: 'crisis_protocol', urgency: 'urgent' };\n      case 'moderate':\n        return { recommendedAction: 'supportive_response', urgency: 'soon' };\n      case 'low':\n        return { recommendedAction: 'monitor', urgency: 'routine' };\n      case 'none':\n      default:\n        return { recommendedAction: 'none', urgency: 'routine' };\n    }\n  }\n\n  private findPrimaryIndicator(\n    layer1: LayerResult,\n    layer2: LayerResult,\n    layer3: LayerResult\n  ): string | null {\n    // Priority: suicidal > planning > selfharm > others\n    const allIndicators = [...layer1.indicators, ...layer2.indicators, ...layer3.indicators];\n\n    if (allIndicators.some(i => i.includes('suicidal'))) {\n      return allIndicators.find(i => i.includes('suicidal')) || null;\n    }\n    if (allIndicators.some(i => i.includes('planning'))) {\n      return allIndicators.find(i => i.includes('planning')) || null;\n    }\n    if (allIndicators.some(i => i.includes('selfharm') || i.includes('self_harm'))) {\n      return allIndicators.find(i => i.includes('selfharm') || i.includes('self_harm')) || null;\n    }\n\n    return allIndicators[0] || null;\n  }\n\n  // ==========================================================================\n  // UTILITY METHODS\n  // ==========================================================================\n\n  private normalizeText(text: string): string {\n    return text\n      .toLowerCase()\n      .replace(/\\s+/g, ' ')\n      .trim();\n  }\n\n  private detectLanguage(text: string): 'ru' | 'en' | 'both' {\n    if (this.config.language !== 'auto') {\n      return this.config.language === 'ru' ? 'ru' : 'en';\n    }\n\n    // Simple heuristic: check for Cyrillic characters\n    const cyrillicPattern = /[-]/i;\n    const latinPattern = /[a-z]/i;\n\n    const hasCyrillic = cyrillicPattern.test(text);\n    const hasLatin = latinPattern.test(text);\n\n    if (hasCyrillic && hasLatin) return 'both';\n    if (hasCyrillic) return 'ru';\n    return 'en';\n  }\n\n  private emptyLayerResult(): LayerResult {\n    return {\n      triggered: false,\n      confidence: 0,\n      indicators: [],\n      matchedPatterns: [],\n    };\n  }\n\n  /**\n   * Get crisis resources for user\n   */\n  getCrisisResources(language: 'ru' | 'en' = 'ru'): string[] {\n    if (language === 'ru') {\n      return [\n        ' : 8-800-2000-122 ()',\n        '    : 8-499-216-50-50',\n        '  : 8-800-2000-122',\n        ' : 051 (  8-495-051)',\n      ];\n    }\n\n    return [\n      'National Suicide Prevention Lifeline: 988',\n      'Crisis Text Line: Text HOME to 741741',\n      'International Association for Suicide Prevention: https://www.iasp.info/resources/Crisis_Centres/',\n    ];\n  }\n}\n\n// ============================================================================\n// FACTORY FUNCTION\n// ============================================================================\n\n/**\n * Create crisis detector with optional configuration\n */\nexport function createCrisisDetector(config?: Partial<CrisisDetectorConfig>): CrisisDetector {\n  return new CrisisDetector(config);\n}\n\n/**\n * Create default crisis detector instance\n */\nexport const defaultCrisisDetector = createCrisisDetector();\n","/**\n * @cognicore/engine\n * =================\n * World's First Universal POMDP-based Cognitive State Engine\n * for Digital Therapeutics (DTx)\n *\n * @packageDocumentation\n * @module @cognicore/engine\n *\n *  \" \" | CogniCore Engine v1.0 | 2025\n */\n\n// =============================================================================\n// VERSION INFO\n// =============================================================================\n\nexport const COGNICORE_VERSION = {\n  version: '2.0.0-alpha.1',\n  name: '@cognicore/engine',\n  description: 'POMDP-based Cognitive State Engine for Digital Therapeutics with Nonlinear Dynamics',\n  buildDate: '2025-12-28',\n  phase: 'Phase 1 - Nonlinear Core',\n  features: [\n    'PLRNN for nonlinear psychological dynamics',\n    'KalmanFormer hybrid architecture',\n    'Voice biomarker analysis',\n    'Multimodal fusion (text + voice)',\n    'Early warning signal detection',\n  ],\n};\n\n// =============================================================================\n// CORE STATE INTERFACES (Phase 1: Interfaces only)\n// =============================================================================\n\n// Emotional State\nexport type {\n  EmotionType,\n  EmotionTrend,\n  VADDimensions,\n  ScoredEmotion,\n  EmotionPattern,\n  RegulationEffectiveness,\n  IEmotionalState,\n  IEmotionalStateBuilder,\n  IEmotionalStateFactory,\n  IVADMapper,\n} from './state/interfaces/IEmotionalState';\n\nexport {\n  DEFAULT_EMOTION_VAD,\n  EMOTION_THERAPY_MAPPING,\n} from './state/interfaces/IEmotionalState';\n\n// Cognitive State\nexport type {\n  CognitiveTriad,\n  CognitiveDistortionType,\n  CognitiveDistortion,\n  AttentionalBias,\n  ThinkingStyle,\n  BeliefUpdate,\n  CoreBeliefPattern,\n  CognitiveLoad,\n  Metacognition,\n  ICognitiveState,\n  ICognitiveStateBuilder,\n  ICognitiveStateFactory,\n  ICognitiveDistortionDetector,\n} from './state/interfaces/ICognitiveState';\n\nexport {\n  DISTORTION_PATTERNS,\n  DISTORTION_INTERVENTIONS,\n} from './state/interfaces/ICognitiveState';\n\n// Narrative State\nexport type {\n  ChangeStage,\n  NarrativeRole,\n  NarrativeMoment,\n  NarrativeChapter,\n  NarrativeTheme,\n  StageTransition,\n  INarrativeState,\n  INarrativeStateBuilder,\n} from './state/interfaces/INarrativeState';\n\n// Risk State\nexport type {\n  RiskLevel,\n  RiskTrajectory,\n  RiskFactor,\n  ProtectiveFactor,\n  SafetyPlan,\n  IRiskState,\n  IRiskStateBuilder,\n} from './state/interfaces/IRiskState';\n\n// Resource State\nexport type {\n  PERMADimensions,\n  CopingStrategy,\n  CopingStrategyType,\n  EnergyLevel,\n  Resilience,\n  SocialResources,\n  IResourceState,\n  IResourceStateBuilder,\n} from './state/interfaces/IResourceState';\n\n// State Vector (Main)\nexport type {\n  ObservationSource,\n  StateQuality,\n  BeliefState,\n  StateTransition,\n  TemporalPrediction,\n  StateSummary,\n  StateBasedRecommendation,\n  IStateVector,\n  IStateVectorBuilder,\n  IStateVectorFactory,\n  IStateVectorService,\n  IStateVectorRepository,\n  ComponentStatus,\n  AgeGroup,\n} from './state/interfaces/IStateVector';\n\nexport {\n  WELLBEING_WEIGHTS,\n  INDEX_THRESHOLDS,\n  getComponentStatus,\n} from './state/interfaces/IStateVector';\n\n// =============================================================================\n// BELIEF UPDATE ENGINE\n// =============================================================================\n\nexport type {\n  Observation,\n  BeliefUpdateResult,\n  IBeliefUpdateEngine,\n} from './belief/IBeliefUpdate';\n\n// Phase 1 Integration: BeliefStateAdapter\n// Bridges BeliefUpdateEngine with PLRNN/KalmanFormer nonlinear engines\nexport {\n  BeliefStateAdapter,\n  createBeliefStateAdapter,\n  beliefStateToObservation,\n  beliefStateToUncertainty,\n  beliefStateToPLRNNState,\n  beliefStateToKalmanFormerState,\n  plrnnStateToBeliefUpdate,\n  kalmanFormerStateToBeliefUpdate,\n  mergeHybridPredictions,\n  DIMENSION_MAPPING,\n  DIMENSION_INDEX,\n} from './belief/BeliefStateAdapter';\n\nexport type { IHybridPrediction } from './belief/BeliefStateAdapter';\n\n// =============================================================================\n// TEMPORAL ENGINE\n// =============================================================================\n\nexport type {\n  VulnerabilityWindow,\n  ITemporalEchoEngine,\n} from './temporal/ITemporalPrediction';\n\n// =============================================================================\n// COGNITIVE MIRROR\n// =============================================================================\n\nexport type {\n  TextAnalysisResult,\n  TherapeuticInsight,\n  SocraticQuestion,\n  ABCDChain,\n  DetectedDistortion,\n  IDeepCognitiveMirror,\n} from './mirror/IDeepCognitiveMirror';\n\n// =============================================================================\n// INTERVENTION OPTIMIZER\n// =============================================================================\n\nexport type {\n  IIntervention,\n  IInterventionSelection,\n  IInterventionOutcome,\n  IContextualFeatures,\n  IDecisionPoint,\n  IInterventionOptimizer,\n} from './intervention/IInterventionOptimizer';\n\n// =============================================================================\n// SAFETY ENVELOPE\n// =============================================================================\n\nexport type {\n  SafetyLevel,\n  ISafetyContext,\n  ISafetyValidationResult,\n  ICrisisDetectionResult,\n  IHumanEscalationRequest,\n  IEscalationDecision,\n  IConstitutionalPrinciple,\n  ISafetyInvariant,\n  IModelCard,\n  RiskLevel as SafetyRiskLevel,\n} from './safety/interfaces/ISafetyEnvelope';\n\n// =============================================================================\n// CAUSAL INFERENCE\n// =============================================================================\n\nexport type {\n  ICausalGraph,\n  ICausalEdge,\n  ICausalNode,\n  IInterventionTarget,\n} from './causal/interfaces/ICausalGraph';\n\n// =============================================================================\n// EXPLAINABILITY\n// =============================================================================\n\nexport type {\n  ISHAPExplanation,\n  ICounterfactualExplanation,\n  IGlobalFeatureImportance,\n  IFeatureAttribution,\n  INarrativeExplanation,\n  IExplainabilityService,\n} from './explainability/interfaces/IExplainability';\n\n// =============================================================================\n// METACOGNITION\n// =============================================================================\n\nexport type {\n  IMetacognitiveState,\n} from './metacognition/interfaces/IMetacognitiveState';\n\n// =============================================================================\n// MOTIVATION (MI)\n// =============================================================================\n\nexport type {\n  IMotivationalState,\n} from './motivation/interfaces/IMotivationalState';\n\n// =============================================================================\n// PIPELINE\n// =============================================================================\n\nexport type {\n  IIncomingMessage,\n  IMessageAnalysis,\n  IPipelineResult,\n  MessageIntent,\n  AgeGroup as PipelineAgeGroup,\n} from './pipeline/IMessagePipeline';\n\n// =============================================================================\n// DIGITAL TWIN\n// =============================================================================\n\nexport type {\n  IDigitalTwinState,\n  ITwinStateVariable,\n  IStateTrajectory,\n  IScenario,\n  IScenarioResult,\n  ITippingPoint,\n  IDigitalTwinService,\n} from './twin/interfaces/IDigitalTwin';\n\n// =============================================================================\n// UTILITY TYPES\n// =============================================================================\n\n/**\n * Language supported by the engine\n */\nexport type SupportedLanguage = 'en' | 'ru';\n\n/**\n * Domain vertical type (for extension)\n */\nexport type DomainVertical =\n  | 'addiction'    //  - digital addiction\n  | 'sleep'        // SleepCore - insomnia/CBT-I\n  | 'pain'         // PainCore - chronic pain\n  | 'anxiety'      // AnxietyCore - GAD\n  | 'depression'   // DepressionCore - MDD\n  | 'custom';      // Custom domain\n\n// =============================================================================\n// PHASE 1: NONLINEAR DYNAMICS ENGINE (2025)\n// =============================================================================\n\n// PLRNN Engine - Piecewise Linear RNN for nonlinear psychological dynamics\nexport type {\n  IPLRNNEngine,\n  IPLRNNConfig,\n  IPLRNNState,\n  IPLRNNPrediction,\n  IPLRNNWeights,\n  IPLRNNTrainingSample,\n  IPLRNNTrainingResult,\n  ICausalNetwork,\n  ICausalNode as IPLRNNCausalNode,\n  ICausalEdge as IPLRNNCausalEdge,\n  IEarlyWarningSignal,\n  IInterventionSimulation,\n  PLRNNEngineFactory,\n} from './temporal/interfaces/IPLRNNEngine';\n\nexport {\n  PLRNNEngine,\n  createPLRNNEngine,\n  DEFAULT_PLRNN_CONFIG,\n} from './temporal/engines/PLRNNEngine';\n\n// KalmanFormer Engine - Hybrid Kalman + Transformer architecture\nexport type {\n  IKalmanFormerEngine,\n  IKalmanFormerConfig,\n  IKalmanFormerState,\n  IKalmanFormerPrediction,\n  IKalmanFormerWeights,\n  IKalmanFormerTrainingSample,\n  IAttentionWeights,\n  KalmanFormerEngineFactory,\n} from './temporal/interfaces/IKalmanFormer';\n\nexport {\n  KalmanFormerEngine,\n  createKalmanFormerEngine,\n  DEFAULT_KALMANFORMER_CONFIG,\n} from './temporal/engines/KalmanFormerEngine';\n\n// Voice Input Adapter - Acoustic analysis & multimodal fusion\nexport type {\n  IVoiceInputAdapter,\n  IVoiceAdapterConfig,\n  IVoiceProcessingResult,\n  IAcousticFeatures,\n  IProsodyFeatures,\n  IVoiceEmotionEstimate,\n  ITextAnalysis,\n  IMultimodalFusion,\n  VoiceInputAdapterFactory,\n} from './voice/interfaces/IVoiceAdapter';\n\nexport {\n  VoiceInputAdapter,\n  createVoiceInputAdapter,\n  DEFAULT_VOICE_CONFIG,\n} from './voice/VoiceInputAdapter';\n\n// =============================================================================\n// PHASE 1: CRISIS DETECTION (2025)\n// =============================================================================\n\n// Crisis Detector - Multi-layer crisis detection for mental health safety\nexport {\n  CrisisDetector,\n  createCrisisDetector,\n  defaultCrisisDetector,\n  DEFAULT_CRISIS_CONFIG,\n} from './crisis';\n\nexport type {\n  CrisisSeverity,\n  CrisisType,\n  LayerResult,\n  CrisisDetectionResult,\n  CrisisDetectorConfig,\n  StateRiskData,\n} from './crisis';\n"]}